var Chartx=function(){"use strict";var t,e={},i={},n=Array.prototype,a=Object.prototype,r=Function.prototype,s=n.push,o=n.slice,l=n.concat,d=a.toString,u=a.hasOwnProperty,c=n.forEach,f=n.map,p=n.filter,g=n.every,y=n.some,v=n.indexOf,x=Array.isArray,m=Object.keys,b=(r.bind,Math.pow(2,53)-1),w=(t="length",function(e){return null==e?void 0:e[t]}),S=function(t){var e=w(t);return"number"==typeof e&&e>=0&&e<=b};e.values=function(t){for(var i=e.keys(t),n=i.length,a=new Array(n),r=0;r<n;r++)a[r]=t[i[r]];return a},e.keys=m||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var i=[];for(var n in t)e.has(t,n)&&i.push(n);return i},e.has=function(t,e){return u.call(t,e)};var A=e.each=e.forEach=function(t,n,a){if(null!=t)if(c&&t.forEach===c)t.forEach(n,a);else if(t.length===+t.length){for(var r=0,s=t.length;r<s;r++)if(n.call(a,t[r],r,t)===i)return}else{var o=e.keys(t);for(r=0,s=o.length;r<s;r++)if(n.call(a,t[o[r]],o[r],t)===i)return}};e.compact=function(t){return e.filter(t,e.identity)},e.filter=e.select=function(t,e,i){var n=[];return null==t?n:p&&t.filter===p?t.filter(e,i):(A(t,function(t,a,r){e.call(i,t,a,r)&&n.push(t)}),n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(t){e["is"+t]=function(e){return d.call(e)=="[object "+t+"]"}}),e.isArguments=function(t){return!(!t||!e.has(t,"callee"))},e.isFunction=function(t){return"function"==typeof t},e.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},e.isNaN=function(t){return e.isNumber(t)&&t!=+t},e.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==d.call(t)},e.isNull=function(t){return null===t},e.isEmpty=function(t){if(null==t)return!0;if(e.isArray(t)||e.isString(t))return 0===t.length;for(var i in t)if(e.has(t,i))return!1;return!0},e.isElement=function(t){return!(!t||1!==t.nodeType)},e.isArray=x||function(t){return"[object Array]"==d.call(t)},e.isObject=function(t){return t===Object(t)},e.identity=function(t){return t},e.indexOf=function(t,i,n){if(null==t)return-1;var a=0,r=t.length;if(n){if("number"!=typeof n)return t[a=e.sortedIndex(t,i)]===i?a:-1;a=n<0?Math.max(0,r+n):n}if(v&&t.indexOf===v)return t.indexOf(i,n);for(;a<r;a++)if(t[a]===i)return a;return-1},e.isWindow=function(t){return null!=t&&t==t.window};var k=function(t,i,n){return i&&e.every(t,e.isArray)?l.apply(n,t):(A(t,function(t){e.isArray(t)||e.isArguments(t)?i?s.apply(n,t):k(t,i,n):n.push(t)}),n)};e.flatten=function(t,e){return k(t,e,[])},e.every=e.all=function(t,n,a){n||(n=e.identity);var r=!0;return null==t?r:g&&t.every===g?t.every(n,a):(A(t,function(t,e,s){if(!(r=r&&n.call(a,t,e,s)))return i}),!!r)},e.min=function(t,i,n){if(!i&&e.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!i&&e.isEmpty(t))return 1/0;var a={computed:1/0,value:1/0};return A(t,function(t,e,r){var s=i?i.call(n,t,e,r):t;s<a.computed&&(a={value:t,computed:s})}),a.value},e.max=function(t,i,n){if(!i&&e.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!i&&e.isEmpty(t))return-1/0;var a={computed:-1/0,value:-1/0};return A(t,function(t,e,r){var s=i?i.call(n,t,e,r):t;s>a.computed&&(a={value:t,computed:s})}),a.value},e.find=e.detect=function(t,e,i){var n;return C(t,function(t,a,r){if(e.call(i,t,a,r))return n=t,!0}),n};var C=e.some=e.any=function(t,n,a){n||(n=e.identity);var r=!1;return null==t?r:y&&t.some===y?t.some(n,a):(A(t,function(t,e,s){if(r||(r=n.call(a,t,e,s)))return i}),!!r)};function T(t){return parseFloat(t.toPrecision(14))}e.without=function(t){return e.difference(t,o.call(arguments,1))},e.difference=function(t){var i=l.apply(n,o.call(arguments,1));return e.filter(t,function(t){return!e.contains(i,t)})},e.uniq=e.unique=function(t,i,n,a){e.isFunction(i)&&(a=n,n=i,i=!1);var r=n?e.map(t,n,a):t,s=[],o=[];return A(r,function(n,a){(i?a&&o[o.length-1]===n:e.contains(o,n))||(o.push(n),s.push(t[a]))}),s},e.map=e.collect=function(t,e,i){var n=[];return null==t?n:f&&t.map===f?t.map(e,i):(A(t,function(t,a,r){n.push(e.call(i,t,a,r))}),n)},e.contains=e.include=function(t,e){return null!=t&&(v&&t.indexOf===v?-1!=t.indexOf(e):C(t,function(t){return t===e}))},e.pluck=function(t,i){return e.map(t,function(t){return t[i]})},e.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},e.shuffle=function(t){return e.sample(t,1/0)},e.sample=function(t,i,n){if(null==i||n)return S(t)||(t=e.values(t)),t[e.random(t.length-1)];var a=S(t)?e.clone(t):e.values(t),r=w(a);i=Math.max(Math.min(i,r),0);for(var s=r-1,o=0;o<i;o++){var l=e.random(o,s),h=a[o];a[o]=a[l],a[l]=h}return a.slice(0,i)},e.extend=function(){var t,i,n,a,r=arguments[0]||{},s=1,o=arguments.length,l=!1;for("boolean"==typeof r&&(l=r,r=arguments[1]||{},s=2),"object"==typeof r||e.isFunction(r)||(r={}),o===s&&(r=this,--s);s<o;s++)if(null!=(t=arguments[s]))for(i in t)n=r[i],r!==(a=t[i])&&(l&&a&&e.isObject(a)&&a.constructor===Object?r[i]=e.extend(l,n,a):r[i]=a);return r},e.clone=function(t){return e.isObject(t)?e.isArray(t)?t.slice():e.extend(!0,{},t):t},e.euclideanModulo=((t,e)=>(t%e+e)%e),e.DEG2RAD=Math.PI/180,e.RAD2DEG=180/Math.PI,e.degToRad=(t=>t*e.DEG2RAD),e.radToDeg=(t=>t*e.RAD2DEG);var P={section:function(t,i,n){return e.uniq(function(t,i,n){t=e.without(t,void 0,null,"");var a=n&&n.scale?parseFloat(n.scale):1,r=n&&n.isInt?1:0;isNaN(a)&&(a=1);var s=e.max(t),o=s;s*=a;var l=e.min(t);if(l==s)return s>0?[l=0,s]:s<0?[s,0]:[0,s=1];var h=s-l;if(h){var d=l;(l-=.05*h)<0&&d>=0&&(l=0),s+=.05*h}var u=.3*(s-l);u=function(t,e){var i,n=[1,2,5,10];i=t/e;for(var a=0;a<n.length&&(t=n[a],!(i<=(n[a]+(n[a+1]||n[a]))/2));a++);return t*=e}(u,Math.pow(10,Math.floor(Math.log(u)/Math.LN10))),r&&(u=Math.ceil(u));var c,f,p=T(Math.floor(l/u)*u),g=T(Math.ceil(s/u)*u),y=[];for(c=p;c<=g&&(y.push(c),(c=T(c+u))!==f);)f=c;return y.length>=3&&y[y.length-2]>=o&&y.pop(),y}(t,0,n))}};class L{constructor(t,i){this.layoutType=t.layoutType||"proportion",this._opt=e.clone(t),this.dataOrg=i||[],this.sectionHandler=null,this.dataSection=[],this.dataSectionLayout=[],this.axisLength=1,this._cellCount=null,this._cellLength=null,this.waterLine=null,this.dataSectionGroup=[],this.middleweight=null,this.symmetric=!1,this.origin=null,this.originPos=0,this._originTrans=0,this._min=null,this._max=null,this.sort=null,this.posParseToInt=!1}resetDataOrg(t){this.dataSection=[],this.dataSectionGroup=[],this.dataOrg=t,this._cellCount=null,this._cellLength=null}setAxisLength(t){this.axisLength=t,this.calculateProps()}calculateProps(){var t=this;"proportion"==this.layoutType&&(null==this._min&&(this._min=e.min(this.dataSection)),null==this._max&&(this._max=e.max(this.dataSection)),"origin"in this._opt||(this.origin=0,e.max(this.dataSection)<0&&(this.origin=e.max(this.dataSection)),e.min(this.dataSection)>0&&(this.origin=e.min(this.dataSection))),this._originTrans=this._getOriginTrans(this.origin),this.originPos=this.getPosOfVal(this.origin)),this.dataSectionLayout=[],e.each(this.dataSection,function(e,i){var n=i;"proportion"==t.layoutType&&(n=t.getIndexOfVal(e));var a=parseInt(t.getPosOf({ind:i,val:e}),10);t.dataSectionLayout.push({val:e,ind:n,pos:a})})}getDataSection(){return this.dataSection}setDataSection(t){if(e.isEmpty(t)&&e.isEmpty(this._opt.dataSection))if("proportion"==this.layoutType){var i=this._getDataSection();if("origin"in this._opt&&i.push(this._opt.origin),1==i.length&&i.push(2*i[0]),this.waterLine&&i.push(this.waterLine),this.symmetric){var n=e.min(i),a=e.max(i);Math.abs(n)>Math.abs(a)?i.push(Math.abs(n)):i.push(-Math.abs(a))}for(var r=0,s=i.length;r<s;r++)i[r]=Number(i[r]),isNaN(i[r])&&(i.splice(r,1),r--,s--);if(e.isFunction(this.sectionHandler)&&(this.dataSection=this.sectionHandler(i)),this.dataSection&&this.dataSection.length||(this.dataSection=P.section(i,3)),this.symmetric){n=e.min(this.dataSection),a=e.max(this.dataSection);Math.abs(n)>Math.abs(a)?this.dataSection.push(Math.abs(n)):this.dataSection.unshift(-Math.abs(a))}0==this.dataSection.length&&(this.dataSection=[0]),this.dataSectionGroup=[e.clone(this.dataSection)],this._middleweight(),this._sort()}else this.dataSection=e.flatten(this.dataOrg),this.dataSectionGroup=[this.dataSection];else this.dataSection=t||this._opt.dataSection,this.dataSectionGroup=[this.dataSection]}_getDataSection(){var t=1;return e.each(this.dataOrg,function(e){t=Math.max(e.length,t)}),1==t?this._oneDimensional():t>1?this._twoDimensional():void 0}_oneDimensional(){for(var t=e.flatten(this.dataOrg),i=0,n=t.length;i<n;i++)t[i]=t[i]||0;return t}_twoDimensional(){var t,i=this.dataOrg,n=[];return e.each(i,function(i,a){if(i.length)if(e.isArray(i[0])){var r=[],s=i[0].length,o=i.length;for(a=0;a<s;a++){for(var l=0,h=0,d=0,u=0,c=0;c<o;c++){var f=i[c][a];(f||0===f)&&(void 0==t&&(t=f),t=Math.min(t,f),f>=0?(l+=f,h++):(d+=f,u++))}h&&r.push(l),u&&r.push(d)}n.push(r)}else n.push(i)}),n.push(t),e.flatten(n)}setWaterLine(t){t<=this.waterLine||(this.waterLine=t,(t<e.min(this.dataSection)||t>e.max(this.dataSection))&&(this.setDataSection(),this.calculateProps()))}_sort(){this.sort&&("desc"==this._getSortType()&&(this.dataSection.reverse(),e.each(this.dataSectionGroup,function(t,e){t.reverse()}),this.dataSectionGroup.reverse()))}_getSortType(){var t;return e.isString(this.sort)&&(t=this.sort),t||(t="asc"),t}_middleweight(){if(this.middleweight){e.isArray(this.middleweight)||(this.middleweight=[this.middleweight]);for(var t=e.min(this.dataSection),i=e.max(this.dataSection),n=[t],a=[],r=0,s=this.middleweight.length;r<s;r++){var o=t;r>0&&(o=this.middleweight[r-1]);var l=o+parseInt((this.middleweight[r]-o)/2);n.push(l),n.push(this.middleweight[r]),a.push([o,l,this.middleweight[r]])}var h=this.middleweight.slice(-1)[0];i>h&&(n.push(h+(i-h)/2),n.push(i),a.push([h,h+(i-h)/2,i])),this.dataSection=n,this.dataSectionGroup=a}}_getOriginTrans(t){for(var i=0,n=this.dataSectionGroup.length,a=this.axisLength/n,r=0,s=n;r<s;r++){var o=this.dataSectionGroup[r];if("proportion"==this.layoutType){var l=e.min(o),h=e.max(o),d=Math.abs(h-l);if(t>=l&&t<=h){i=(t-l)/d*a+r*a;break}}}return"desc"==this.sort&&(i=-(a-i)),parseInt(i)}_getLayoutDataOf(t){var i,n;return e.each(["val","ind","pos"],function(e){e in t&&(i=e)}),e.each(this.dataSectionLayout,function(e){e[i]===t[i]&&(n=e)}),n||{}}getPosOfVal(t){return this.getPosOf({val:t})}getPosOfInd(t){var e=this._getLayoutDataOf({ind:t}).pos;return void 0!=e?e:this.getPosOf({ind:t})}getPosOf(t){var i,n=this._getCellCount();if("proportion"==this.layoutType)for(var a=this.dataSectionGroup.length,r=this.axisLength/a,s=0,o=a;s<o;s++){var l=this.dataSectionGroup[s],h=e.min(l),d=e.max(l),u="val"in t?t.val:this.getValOfInd(t.ind);if(u>=h&&u<=d){var c=this.origin;(c<h||c>d)&&(c=h);var f=Math.max(Math.abs(d-c),Math.abs(c-h));i=(u-c)/f*(f/Math.abs(d-h)*r)+s*r,isNaN(i)&&(i=parseInt(s*r));break}}else if(1==n)i=this.axisLength/2;else{var p="ind"in t?t.ind:this.getIndexOfVal(t.val);if(-1!=p&&("rule"==this.layoutType&&(i=p/(n-1)*this.axisLength),"peak"==this.layoutType)){var g=this.getCellLength();i=g*(p+1)-g/2}}return!i&&(i=0),i=Number(i.toFixed(1))+this._originTrans,Math.abs(i)}getValOfPos(t){var e=this._getLayoutDataOf({pos:t}).val;return void 0!=e?e:this._getValOfInd(this.getIndexOfPos(t))}getValOfInd(t){var e=this._getLayoutDataOf({ind:t}).val;return void 0!=e?e:this._getValOfInd(t)}_getValOfInd(t,i){var n,a=this,r=e.flatten(this.dataOrg);if("proportion"==this.layoutType){var s=this.axisLength/this.dataSectionGroup.length;e.each(this.dataSectionGroup,function(i,r){if(parseInt(t/s)==r||r==a.dataSectionGroup.length-1){var o=e.min(i),l=e.max(i);return n=o+(l-o)/s*(t-s*r),!1}})}else n=r[t];return n}getIndexOfPos(t){var e=this._getLayoutDataOf({pos:t}).ind;if(void 0!=e)return e;var i=0,n=this.getCellLengthOfPos(t),a=this._getCellCount();return"proportion"==this.layoutType?t:("peak"==this.layoutType&&(i=parseInt(t/n))==a&&(i=a-1),"rule"==this.layoutType&&(i=parseInt((t+n/2)/n),1==a&&(i=0)),i)}getIndexOfVal(t){var i=-1;if("proportion"==this.layoutType){var n=this._getLayoutDataOf({val:t}).ind;if(void 0!=n)return n;i=this.getPosOfVal(t)}else e.each(this.dataOrg,function(n){e.each(n,function(n){var a=e.indexOf(n,t);-1!=a&&(i=a)})});return i}getCellLength(){if(null!==this._cellLength)return this._cellLength;var t=this.axisLength,e=t,i=this._getCellCount();return i&&("proportion"==this.layoutType?e=1:(e=t/i,"rule"==this.layoutType&&(e=1==i?t/2:t/(i-1)),this.posParseToInt&&(e=parseInt(e)))),this._cellLength=e,e}getCellLengthOfPos(t){return this.getCellLength()}getCellLengthOfInd(t){return this.getCellLength()}_getCellCount(){if(null!==this._cellCount)return this._cellCount;var t=0;return"proportion"==this.layoutType?t=this.axisLength:this.dataOrg.length&&this.dataOrg[0].length&&this.dataOrg[0][0].length&&(t=this.dataOrg[0][0].length),this._cellCount=t,t}}function D(t,i){var n={length:0,org:[],data:[],getRowDataAt:f,getRowDataOf:function(t){!t&&(t={});var i=[],a=0;for(var r in t)a++;if(a)for(var s=n.range.start;s<n.range.end;s++){var o=0;e.each(n.data,function(e){e.field in t&&e.data[s]==t[e.field]&&o++}),o==a&&i.push(f(s))}return i},getFieldData:function(t){var i;return e.each(n.data,function(e){e.field==t&&(i=e)}),i?i.data.slice(n.range.start,n.range.end+1):[]},getDataOrg:function t(i,a,r,o){o||(o=0);var l=r||s;if(!l)return;a||(a=function(t){return t});function h(t){for(var e=0,i=t.length;e<i;e++)t[e]=a(t[e]);return t}e.isArray(i)||(i=[i]);var d=[];for(var u=0,c=i.length;u<c;u++)if(e.isArray(i[u]))d.push(t(i[u],a,r,o+1));else{var f=d;o||(f=[]);for(var p=0,g=l.length;p<g;p++)if(i[u]==l[p].field){f.push(h(l[p].data.slice(n.range.start,n.range.end+1)));break}o||d.push(f)}return d},fields:[],range:{start:0,end:0}};if(!(t=JSON.parse(JSON.stringify(t)))||0==t.length)return n;if(t.length>0&&!e.isArray(t[0])&&(t=function(t){if(void 0!==t&&null!==t||(t=[]),t.length>0&&!e.isArray(t[0])){for(var i=[],n=[],a=0,r=0,s=t.length;r<s;r++){var o=t[r];if(0==r){for(var l in o)n.push(l);i.push(n),a=n.length}for(var h=[],d=0;d<a;d++)h.push(o[n[d]]);i.push(h)}return i}return t}(t)),n.length=t.length-1,n.range.end=n.length-1,i&&i.dataZoom&&i.dataZoom.range&&e.extend(n.range,i.dataZoom.range),t.length&&t[0].length&&!~t[0].indexOf("__index__"))for(var a=0,r=t.length;a<r;a++)a?t[a].push(a-1):t[0].push("__index__");n.org=t,n.fields=t[0]?t[0]:[];for(var s=[],o=0,l=n.fields.length;o<l;o++){var h={};h.field=n.fields[o],h.index=o,h.data=[],s.push(h)}n.data=s;for(o=1,l=t.length;o<l;o++)for(var d=0,u=t[o].length;d<u;d++){var c=t[o][d];isNaN(c)||""===c||null===c||(c=Number(c)),s[d].data.push(c)}function f(t){for(var e={},i=n.data,a=0;a<i.length;a++)e[i[a].field]=i[a].data[n.range.start+t];return e}return n}const M=window.devicePixelRatio||1;var O=function(t,e){if(document[t]){return function e(i,n,a){if(i.length)for(var r=0;r<i.length;r++)e(i[r],n,a);else i[t](n,a,!1)}}return function t(i,n,a){if(i.length)for(var r=0;r<i.length;r++)t(i[r],n,a);else i[e]("on"+n,function(){return a.call(i,window.event)})}},I={query:function(t){return e.isString(t)?document.getElementById(t):1==t.nodeType?t:t.length?t[0]:null},offset:function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,n=i.body,a=i.documentElement,r=a.clientTop||n.clientTop||0,s=a.clientLeft||n.clientLeft||0,o=1;if(n.getBoundingClientRect){var l=n.getBoundingClientRect();o=(l.right-l.left)/n.clientWidth}return o>1&&(r=0,s=0),{top:e.top/o+(window.pageYOffset||a&&a.scrollTop/o||n.scrollTop/o)-r,left:e.left/o+(window.pageXOffset||a&&a.scrollLeft/o||n.scrollLeft/o)-s}},addEvent:O("addEventListener","attachEvent"),removeEvent:O("removeEventListener","detachEvent"),pageX:function(t){return t.pageX?t.pageX:t.clientX?t.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft):null},pageY:function(t){return t.pageY?t.pageY:t.clientY?t.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop):null},createCanvas:function(t,e,i){var n=document.createElement("canvas");return n.style.position="absolute",n.style.width=t+"px",n.style.height=e+"px",n.style.left=0,n.style.top=0,n.setAttribute("width",t*M),n.setAttribute("height",e*M),n.setAttribute("id",i),n},createView:function(t,e,i){var n=document.createElement("div");n.className="canvax-view",n.style.cssText+="position:relative;width:100%;height:100%;";var a=document.createElement("div");a.style.cssText+="position:absolute;width:"+t+"px;height:"+e+"px;";var r=document.createElement("div");return r.style.cssText+="position:absolute;width:"+t+"px;height:"+e+"px;",n.appendChild(a),n.appendChild(r),{view:n,stageView:a,domView:r}}};var E={colors:["#ff8533","#73ace6","#82d982","#e673ac","#cd6bed","#8282d9","#c0e650","#e6ac73","#6bcded","#73e6ac","#ed6bcd","#9966cc"],set:function(t){return this.colors=t,this.colors},get:function(){return this.colors}};var R={create:function(t,i,n){var a=null,r=this,s=(t=>JSON.parse(JSON.stringify(t)))(i),o=(t=>e.clone(t))(n),l=function(){r.instances[a.id]=null,delete r.instances[a.id]},h=I.query(t).getAttribute("chart_id");if(void 0!=h){var d=r.instances[h];d&&(d.destroy(),d.off&&d.off("destroy",l)),delete r.instances[h]}var u=2;(t=>{return t.coord&&t.coord.type&&["box","polar3d"].indexOf(t.coord.type)>-1})(n)&&(u=3);var c=r.getComponentModules(u),f=r.getComponentModule("chart",u);return(a=new f(t,s,o,c))&&(a.draw(),r.instances[a.id]=a,a.on("destroy",l)),a},setGlobalTheme:function(t){E.set(t)},getGlobalTheme:function(){return E.get()},instances:{},getChart:function(t){return this.instances[t]},resize:function(){for(var t in this.instances)this.instances[t].resize()},getOptions:function(t,i){if(!this.options[t])return i||{};var n,a="[[JSON_FUN_PREFIX_",r="_JSON_FUN_SUFFIX]]",s=(n=decodeURIComponent(this.options[t]||{}),JSON.parse(n,function(t,e){return"string"==typeof e&&e.indexOf(r)>0&&0==e.indexOf(a)?new Function("return "+e.replace(a,"").replace(r,""))():e})||{});return i&&(s=e.extend(!0,s,i)),s},components:{c_2d:{},c_3d:{}},getComponentModules(t){var e=this.components.c_2d;return 3==t&&(e=this.components.c_3d),e.modules||(e.modules={}),e.get||(e.get=function(t,i){i||(i="empty");var n=e.modules[t];if(n&&n[i])return n[i]}),e},registerComponent(t,i){var n=2,a="empty";if(3==arguments.length){var r=arguments[2];e.isNumber(r)&&3==r&&(n=3),e.isString(r)&&(a=r)}4==arguments.length&&(a=arguments[2],3==arguments[3]&&(n=3));var s=this.getComponentModules(n).modules,o=s[i];return o||(o=s[i]={}),o[a]||(o[a]=t),s},getComponentModule(t){var i=2,n="empty";if(2==arguments.length){var a=arguments[1];e.isNumber(a)&&3==a&&(i=3),e.isString(a)&&(n=a)}3==arguments.length&&(n=arguments[1],3==arguments[2]&&(i=3));var r=this.getComponentModules(i).modules[t];return r?r[n]:void 0}},F=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;var W=function(t){var i="CanvaxEvent";e.isString(t)&&(i=t),e.isObject(t)&&t.type&&(i=t.type),this.target=null,this.currentTarget=null,this.type=i,this.point=null,this._stopPropagation=!1};W.prototype={stopPropagation:function(){this._stopPropagation=!0}};const N="mousedown mouseup mouseover mousemove mouseout click dblclick";var z={_types:N.split(/,| /),register:function(t){t&&(e.isString(t)&&(t=t.split(/,| /)),this._types=N.split(/,| /).concat(t))},get:function(){return this._types}},G=function(){this._eventMap={}};G.prototype={_setEventEnable:function(){var t=!1;for(var i in this._eventMap)e.indexOf(z.get(),i)>-1&&(t=!0);this._eventEnabled=t},_addEventListener:function(t,i){if("function"!=typeof i)return!1;var n=!0,a=this,r=t;return e.isString(t)&&(r=t.split(/,| /)),e.each(r,function(t){var r=a._eventMap[t];return r?-1==e.indexOf(r,i)?(r.push(i),a._setEventEnable(),!0):void(n=!1):((r=a._eventMap[t]=[]).push(i),a._setEventEnable(),!0)}),n},_removeEventListener:function(t,e){if(1==arguments.length)return this.removeEventListenerByType(t);var i=this._eventMap[t];if(!i)return!1;for(var n=0;n<i.length;n++){if(i[n]===e)return i.splice(n,1),0==i.length&&(delete this._eventMap[t],this._setEventEnable()),!0}return!1},_removeEventListenerByType:function(t){return!this._eventMap[t]&&(delete this._eventMap[t],this._setEventEnable(),!0)},_removeAllEventListeners:function(){this._eventMap={},this._eventEnabled=!1},_dispatchEvent:function(t){var e=this._eventMap[t.type];if(e){t.target||(t.target=this),e=e.slice();for(var i=0;i<e.length;i++){var n=e[i];"function"==typeof n&&n.call(this,t)}}return t._stopPropagation||this.parent&&(t.currentTarget=this.parent,this.parent._dispatchEvent(t)),!0},_hasEventListener:function(t){var e=this._eventMap[t];return null!=e&&e.length>0}};class B extends G{constructor(){super()}on(t,e){return this._addEventListener(t,e),this}addEventListener(t,e){return this._addEventListener(t,e),this}un(t,e){return this._removeEventListener(t,e),this}removeEventListener(t,e){return this._removeEventListener(t,e),this}removeEventListenerByType(t){return this._removeEventListenerByType(t),this}removeAllEventListeners(){return this._removeAllEventListeners(),this}fire(t,i){var n=new W(t);if(i)for(var a in i)"type"!=a&&(n[a]=i[a]),n.currentTarget=this;var r=this;return e.each(t.split(" "),function(t){n.currentTarget=r,r.dispatchEvent(n)}),this}dispatchEvent(t){if(this.children&&t.point){var e=this.getObjectsUnderPoint(t.point,1)[0];e&&e.dispatchEvent(t)}else{if(!this.context||"mouseover"!=t.type){if(this._dispatchEvent(t),this.context&&"mouseout"==t.type&&this._hoverClass&&this.hoverClone){a=this.getStage().parent;this._hoverClass=!1,a._bufferStage.removeChildById(this.id),this._globalAlpha&&(this.context.globalAlpha=this._globalAlpha,delete this._globalAlpha)}return this}var i=this._heartBeatNum,n=this.context.$model.globalAlpha;if(this._dispatchEvent(t),i!=this._heartBeatNum&&(this._hoverClass=!0,this.hoverClone)){var a=this.getStage().parent,r=this.clone(!0);r._transform=this.getConcatenatedMatrix(),a._bufferStage.addChildAt(r,0),this._globalAlpha=n,this.context.globalAlpha=0}}}hasEvent(t){return this._hasEventListener(t)}hasEventListener(t){return this._hasEventListener(t)}hover(t,e){return this.on("mouseover",t),this.on("mouseout",e),this}once(t,e){var i=this,n=function(){e.apply(i,arguments),this.un(t,n)};return this.on(t,n),this}}document.compareDocumentPosition;var H={},j={},V=Array.prototype,Y=Object.prototype,$=Function.prototype,q=V.push,X=V.slice,U=V.concat,Z=Y.toString,Q=Y.hasOwnProperty,J=V.forEach,K=V.map,tt=V.filter,et=V.every,it=V.some,nt=V.indexOf,at=Array.isArray,rt=Object.keys,st=($.bind,Math.pow(2,53)-1),ot=function(t){return function(e){return null==e?void 0:e[t]}}("length"),lt=function(t){var e=ot(t);return"number"==typeof e&&e>=0&&e<=st};H.values=function(t){for(var e=H.keys(t),i=e.length,n=new Array(i),a=0;a<i;a++)n[a]=t[e[a]];return n},H.keys=rt||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)H.has(t,i)&&e.push(i);return e},H.has=function(t,e){return Q.call(t,e)};var ht=H.each=H.forEach=function(t,e,i){if(null!=t)if(J&&t.forEach===J)t.forEach(e,i);else if(t.length===+t.length){for(var n=0,a=t.length;n<a;n++)if(e.call(i,t[n],n,t)===j)return}else{var r=H.keys(t);for(n=0,a=r.length;n<a;n++)if(e.call(i,t[r[n]],r[n],t)===j)return}};H.compact=function(t){return H.filter(t,H.identity)},H.filter=H.select=function(t,e,i){var n=[];return null==t?n:tt&&t.filter===tt?t.filter(e,i):(ht(t,function(t,a,r){e.call(i,t,a,r)&&n.push(t)}),n)},ht(["Arguments","Function","String","Number","Date","RegExp"],function(t){H["is"+t]=function(e){return Z.call(e)=="[object "+t+"]"}}),H.isArguments=function(t){return!(!t||!H.has(t,"callee"))},H.isFunction=function(t){return"function"==typeof t},H.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},H.isNaN=function(t){return H.isNumber(t)&&t!=+t},H.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==Z.call(t)},H.isNull=function(t){return null===t},H.isEmpty=function(t){if(null==t)return!0;if(H.isArray(t)||H.isString(t))return 0===t.length;for(var e in t)if(H.has(t,e))return!1;return!0},H.isElement=function(t){return!(!t||1!==t.nodeType)},H.isArray=at||function(t){return"[object Array]"==Z.call(t)},H.isObject=function(t){return t===Object(t)},H.identity=function(t){return t},H.indexOf=function(t,e,i){if(null==t)return-1;var n=0,a=t.length;if(i){if("number"!=typeof i)return t[n=H.sortedIndex(t,e)]===e?n:-1;n=i<0?Math.max(0,a+i):i}if(nt&&t.indexOf===nt)return t.indexOf(e,i);for(;n<a;n++)if(t[n]===e)return n;return-1},H.isWindow=function(t){return null!=t&&t==t.window};var dt=function(t,e,i){return e&&H.every(t,H.isArray)?U.apply(i,t):(ht(t,function(t){H.isArray(t)||H.isArguments(t)?e?q.apply(i,t):dt(t,e,i):i.push(t)}),i)};H.flatten=function(t,e){return dt(t,e,[])},H.every=H.all=function(t,e,i){e||(e=H.identity);var n=!0;return null==t?n:et&&t.every===et?t.every(e,i):(ht(t,function(t,a,r){if(!(n=n&&e.call(i,t,a,r)))return j}),!!n)},H.min=function(t,e,i){if(!e&&H.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&H.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return ht(t,function(t,a,r){var s=e?e.call(i,t,a,r):t;s<n.computed&&(n={value:t,computed:s})}),n.value},H.max=function(t,e,i){if(!e&&H.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&H.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return ht(t,function(t,a,r){var s=e?e.call(i,t,a,r):t;s>n.computed&&(n={value:t,computed:s})}),n.value},H.find=H.detect=function(t,e,i){var n;return ut(t,function(t,a,r){if(e.call(i,t,a,r))return n=t,!0}),n};var ut=H.some=H.any=function(t,e,i){e||(e=H.identity);var n=!1;return null==t?n:it&&t.some===it?t.some(e,i):(ht(t,function(t,a,r){if(n||(n=e.call(i,t,a,r)))return j}),!!n)};H.without=function(t){return H.difference(t,X.call(arguments,1))},H.difference=function(t){var e=U.apply(V,X.call(arguments,1));return H.filter(t,function(t){return!H.contains(e,t)})},H.uniq=H.unique=function(t,e,i,n){H.isFunction(e)&&(n=i,i=e,e=!1);var a=i?H.map(t,i,n):t,r=[],s=[];return ht(a,function(i,n){(e?n&&s[s.length-1]===i:H.contains(s,i))||(s.push(i),r.push(t[n]))}),r},H.map=H.collect=function(t,e,i){var n=[];return null==t?n:K&&t.map===K?t.map(e,i):(ht(t,function(t,a,r){n.push(e.call(i,t,a,r))}),n)},H.contains=H.include=function(t,e){return null!=t&&(nt&&t.indexOf===nt?-1!=t.indexOf(e):ut(t,function(t){return t===e}))},H.pluck=function(t,e){return H.map(t,function(t){return t[e]})},H.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},H.shuffle=function(t){return H.sample(t,1/0)},H.sample=function(t,e,i){if(null==e||i)return lt(t)||(t=H.values(t)),t[H.random(t.length-1)];var n=lt(t)?H.clone(t):H.values(t),a=ot(n);e=Math.max(Math.min(e,a),0);for(var r=a-1,s=0;s<e;s++){var o=H.random(s,r),l=n[s];n[s]=n[o],n[o]=l}return n.slice(0,e)},H.extend=function(){var t,e,i,n,a=arguments[0]||{},r=1,s=arguments.length,o=!1;for("boolean"==typeof a&&(o=a,a=arguments[1]||{},r=2),"object"==typeof a||H.isFunction(a)||(a={}),s===r&&(a=this,--r);r<s;r++)if(null!=(t=arguments[r]))for(e in t)i=a[e],a!==(n=t[e])&&(o&&n&&H.isObject(n)&&n.constructor===Object?a[e]=H.extend(o,i,n):a[e]=n);return a},H.clone=function(t){return H.isObject(t)?H.isArray(t)?t.slice():H.extend(!0,{},t):t},H.euclideanModulo=((t,e)=>(t%e+e)%e),H.DEG2RAD=Math.PI/180,H.RAD2DEG=180/Math.PI,H.degToRad=(t=>t*H.DEG2RAD),H.radToDeg=(t=>t*H.RAD2DEG);const ct=window.devicePixelRatio||1;var ft=function(t,e){if(document[t]){return function e(i,n,a){if(i.length)for(var r=0;r<i.length;r++)e(i[r],n,a);else i[t](n,a,!1)}}return function t(i,n,a){if(i.length)for(var r=0;r<i.length;r++)t(i[r],n,a);else i[e]("on"+n,function(){return a.call(i,window.event)})}},pt={query:function(t){return H.isString(t)?document.getElementById(t):1==t.nodeType?t:t.length?t[0]:null},offset:function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,n=i.body,a=i.documentElement,r=a.clientTop||n.clientTop||0,s=a.clientLeft||n.clientLeft||0,o=1;if(n.getBoundingClientRect){var l=n.getBoundingClientRect();o=(l.right-l.left)/n.clientWidth}return o>1&&(r=0,s=0),{top:e.top/o+(window.pageYOffset||a&&a.scrollTop/o||n.scrollTop/o)-r,left:e.left/o+(window.pageXOffset||a&&a.scrollLeft/o||n.scrollLeft/o)-s}},addEvent:ft("addEventListener","attachEvent"),removeEvent:ft("removeEventListener","detachEvent"),pageX:function(t){return t.pageX?t.pageX:t.clientX?t.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft):null},pageY:function(t){return t.pageY?t.pageY:t.clientY?t.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop):null},createCanvas:function(t,e,i){var n=document.createElement("canvas");return n.style.position="absolute",n.style.width=t+"px",n.style.height=e+"px",n.style.left=0,n.style.top=0,n.setAttribute("width",t*ct),n.setAttribute("height",e*ct),n.setAttribute("id",i),n},createView:function(t,e,i){var n=document.createElement("div");n.className="canvax-view",n.style.cssText+="position:relative;width:100%;height:100%;";var a=document.createElement("div");a.style.cssText+="position:absolute;width:"+t+"px;height:"+e+"px;";var r=document.createElement("div");return r.style.cssText+="position:absolute;width:"+t+"px;height:"+e+"px;",n.appendChild(a),n.appendChild(r),{view:n,stageView:a,domView:r}}},gt=function(t){var e="CanvaxEvent";H.isString(t)&&(e=t),H.isObject(t)&&t.type&&(e=t.type),this.target=null,this.currentTarget=null,this.type=e,this.point=null,this._stopPropagation=!1};gt.prototype={stopPropagation:function(){this._stopPropagation=!0}};const yt="mousedown mouseup mouseover mousemove mouseout click dblclick";var vt={_types:yt.split(/,| /),register:function(t){t&&(H.isString(t)&&(t=t.split(/,| /)),this._types=yt.split(/,| /).concat(t))},get:function(){return this._types}},xt=function(){this._eventMap={}};xt.prototype={_setEventEnable:function(){var t=!1;for(var e in this._eventMap)H.indexOf(vt.get(),e)>-1&&(t=!0);this._eventEnabled=t},_addEventListener:function(t,e){if("function"!=typeof e)return!1;var i=!0,n=this,a=t;return H.isString(t)&&(a=t.split(/,| /)),H.each(a,function(t){var a=n._eventMap[t];return a?-1==H.indexOf(a,e)?(a.push(e),n._setEventEnable(),!0):void(i=!1):((a=n._eventMap[t]=[]).push(e),n._setEventEnable(),!0)}),i},_removeEventListener:function(t,e){if(1==arguments.length)return this.removeEventListenerByType(t);var i=this._eventMap[t];if(!i)return!1;for(var n=0;n<i.length;n++){if(i[n]===e)return i.splice(n,1),0==i.length&&(delete this._eventMap[t],this._setEventEnable()),!0}return!1},_removeEventListenerByType:function(t){return!this._eventMap[t]&&(delete this._eventMap[t],this._setEventEnable(),!0)},_removeAllEventListeners:function(){this._eventMap={},this._eventEnabled=!1},_dispatchEvent:function(t){var e=this._eventMap[t.type];if(e){t.target||(t.target=this),e=e.slice();for(var i=0;i<e.length;i++){var n=e[i];"function"==typeof n&&n.call(this,t)}}return t._stopPropagation||this.parent&&(t.currentTarget=this.parent,this.parent._dispatchEvent(t)),!0},_hasEventListener:function(t){var e=this._eventMap[t];return null!=e&&e.length>0}};class _t extends xt{constructor(){super()}on(t,e){return this._addEventListener(t,e),this}addEventListener(t,e){return this._addEventListener(t,e),this}un(t,e){return this._removeEventListener(t,e),this}removeEventListener(t,e){return this._removeEventListener(t,e),this}removeEventListenerByType(t){return this._removeEventListenerByType(t),this}removeAllEventListeners(){return this._removeAllEventListeners(),this}fire(t,e){var i=new gt(t);if(e)for(var n in e)"type"!=n&&(i[n]=e[n]),i.currentTarget=this;var a=this;return H.each(t.split(" "),function(t){i.currentTarget=a,a.dispatchEvent(i)}),this}dispatchEvent(t){if(this.children&&t.point){var e=this.getObjectsUnderPoint(t.point,1)[0];e&&e.dispatchEvent(t)}else{if(!this.context||"mouseover"!=t.type){if(this._dispatchEvent(t),this.context&&"mouseout"==t.type&&this._hoverClass&&this.hoverClone){a=this.getStage().parent;this._hoverClass=!1,a._bufferStage.removeChildById(this.id),this._globalAlpha&&(this.context.globalAlpha=this._globalAlpha,delete this._globalAlpha)}return this}var i=this._heartBeatNum,n=this.context.$model.globalAlpha;if(this._dispatchEvent(t),i!=this._heartBeatNum&&(this._hoverClass=!0,this.hoverClone)){var a=this.getStage().parent,r=this.clone(!0);r._transform=this.getConcatenatedMatrix(),a._bufferStage.addChildAt(r,0),this._globalAlpha=n,this.context.globalAlpha=0}}}hasEvent(t){return this._hasEventListener(t)}hasEventListener(t){return this._hasEventListener(t)}hover(t,e){return this.on("mouseover",t),this.on("mouseout",e),this}once(t,e){var i=this,n=function(){e.apply(i,arguments),this.un(t,n)};return this.on(t,n),this}}var mt=["pan","panstart","panmove","panend","pancancel","panleft","panright","panup","pandown","press","pressup","swipe","swipeleft","swiperight","swipeup","swipedown","tap"],bt=function(t,e){this.canvax=t,this.curPoints=[{x:0,y:0}],this.curPointsTarget=[],this._touching=!1,this._draging=!1,this._cursor="default",this.target=this.canvax.view,this.drag={start:"panstart",move:"panmove",end:"panend"},H.extend(!0,this,e)},wt=document.compareDocumentPosition?function(t,e){return!!e&&!!(16&t.compareDocumentPosition(e))}:function(t,e){return!!e&&(e!=e&&(!t.contains||t.contains(e)))};bt.prototype={init:function(){var t=this;void 0==t.target.nodeType&&vt.register(mt),H.each(vt.get(),function(e){1==t.target.nodeType?pt.addEvent(t.target,e,function(e){t.__mouseHandler(e)}):t.target.on(e,function(e){t.__libHandler(e)})})},__mouseHandler:function(t){var e=this,i=e.canvax;i.updateViewOffset(),e.curPoints=[{x:pt.pageX(t)-i.viewOffset.left,y:pt.pageY(t)-i.viewOffset.top}];var n=e.curPoints[0],a=e.curPointsTarget[0];if("mousedown"==t.type){if(!a){var r=i.getObjectsUnderPoint(n,1)[0];r&&(e.curPointsTarget=[r])}(a=e.curPointsTarget[0])&&a.dragEnabled&&(e._touching=!0)}if(("mouseup"==t.type||"mouseout"==t.type&&!wt(i.view,t.toElement||t.relatedTarget))&&(1==e._draging&&(e._dragEnd(t,a,0),a.fire("dragend")),e._draging=!1,e._touching=!1),"mouseout"==t.type)wt(i.view,t.toElement||t.relatedTarget)||e.__getcurPointsTarget(t,n,!0);else if("mousemove"==t.type)if(e._touching&&"mousemove"==t.type&&a){if(e._draging)e._dragIngHander(t,a,0);else a.fire("dragstart"),a._globalAlpha||(a._globalAlpha=a.context.$model.globalAlpha),a.context.globalAlpha=0,e._clone2hoverStage(a,0).context.globalAlpha=a._globalAlpha;e._draging=!0}else e.__getcurPointsTarget(t,n);else{var s=a;s||(s=i),e.__dispatchEventInChilds(t,[s]),e._cursorHander(s)}i.preventDefault&&(t&&t.preventDefault?t.preventDefault():window.event.returnValue=!1)},__getcurPointsTarget:function(t,e,i){var n=this,a=n.canvax,r=n.curPointsTarget[0];if(r&&!r.context&&(r=null),"mousemove"==(t=new gt(t)).type&&r&&r._hoverClass&&r.hoverClone&&r.pointChkPriority&&r.getChildInPoint(e))return t.target=t.currentTarget=r,t.point=r.globalToLocal(e),void r.dispatchEvent(t);var s=i?null:a.getObjectsUnderPoint(e,1)[0];(r&&r!=s||"mouseout"==t.type)&&r&&r.context&&(n.curPointsTarget[0]=null,t.type="mouseout",t.toTarget=s,t.target=t.currentTarget=r,t.point=r.globalToLocal(e),r.dispatchEvent(t)),s&&r!=s&&(n.curPointsTarget[0]=s,t.type="mouseover",t.fromTarget=r,t.target=t.currentTarget=s,t.point=s.globalToLocal(e),s.dispatchEvent(t)),"mousemove"==t.type&&s&&(t.target=t.currentTarget=r,t.point=r.globalToLocal(e),r.dispatchEvent(t)),n._cursorHander(s,r)},_cursorHander:function(t,e){t||e||this._setCursor("default"),t&&e!=t&&t.context&&this._setCursor(t.context.$model.cursor)},_setCursor:function(t){this._cursor!=t&&(this.canvax.view.style.cursor=t,this._cursor=t)},__libHandler:function(t){var e=this,i=e.canvax;i.updateViewOffset(),e.curPoints=e.__getCanvaxPointInTouchs(t),e._draging||(e.curPointsTarget=e.__getChildInTouchs(e.curPoints)),e.curPointsTarget.length>0?(t.type==e.drag.start&&H.each(e.curPointsTarget,function(t,i){if(t&&t.dragEnabled)return e._draging=!0,t._globalAlpha||(t._globalAlpha=t.context.$model.globalAlpha),e._clone2hoverStage(t,i),t.context.globalAlpha=0,t.fire("dragstart"),!1}),t.type==e.drag.move&&e._draging&&H.each(e.curPointsTarget,function(i,n){i&&i.dragEnabled&&e._dragIngHander(t,i,n)}),t.type==e.drag.end&&e._draging&&(H.each(e.curPointsTarget,function(i,n){i&&i.dragEnabled&&(e._dragEnd(t,i,0),i.fire("dragend"))}),e._draging=!1),e.__dispatchEventInChilds(t,e.curPointsTarget)):e.__dispatchEventInChilds(t,[i])},__getCanvaxPointInTouchs:function(t){var e=this.canvax,i=[];return H.each(t.point,function(t){i.push({x:pt.pageX(t)-e.viewOffset.left,y:pt.pageY(t)-e.viewOffset.top})}),i},__getChildInTouchs:function(t){var e=this.canvax,i=[];return H.each(t,function(t){i.push(e.getObjectsUnderPoint(t,1)[0])}),i},__dispatchEventInChilds:function(t,e){if(!(e||"length"in e))return!1;var i=this,n=!1;return H.each(e,function(e,a){if(e){n=!0;var r=new gt(t);r.target=r.currentTarget=e||this,r.stagePoint=i.curPoints[a],r.point=r.target.globalToLocal(r.stagePoint),e.dispatchEvent(r)}}),n},_clone2hoverStage:function(t,e){var i=this.canvax,n=i._bufferStage.getChildById(t.id);return n||((n=t.clone(!0))._transform=t.getConcatenatedMatrix(),i._bufferStage.addChildAt(n,0)),n.context.globalAlpha=t._globalAlpha,t._dragPoint=t.globalToLocal(this.curPoints[e]),n},_dragIngHander:function(t,e,i){var n=this.canvax,a=e.globalToLocal(this.curPoints[i]);e._noHeart=!0;var r=e.moveing;e.moveing=!0,e.context.x+=a.x-e._dragPoint.x,e.context.y+=a.y-e._dragPoint.y,e.fire("draging"),e.moveing=r,e._noHeart=!1;var s=n._bufferStage.getChildById(e.id);s._transform=e.getConcatenatedMatrix(),s.worldTransform=null,s.heartBeat()},_dragEnd:function(t,e,i){var n=this.canvax._bufferStage.getChildById(e.id);n&&n.destroy(),e.context.globalAlpha=e._globalAlpha}};var St={mainFrameRate:60,now:0,_pixelCtx:null,__emptyFunc:function(){},_devicePixelRatio:window.devicePixelRatio||1,_UID:0,getUID:function(){return this._UID++},createId:function(t){var e=t.charCodeAt(t.length-1);return e>=48&&e<=57&&(t+="_"),t+St.getUID()},canvasSupport:function(){return!!document.createElement("canvas").getContext},initElement:function(t){return window.FlashCanvas&&FlashCanvas.initElement&&FlashCanvas.initElement(t),t},getCssOrderArr:function(t){var e,i,n,a;return"number"==typeof t?e=i=n=a=t:t instanceof Array?1===t.length?e=i=n=a=t[0]:2===t.length?(e=n=t[0],i=a=t[1]):3===t.length?(e=t[0],i=a=t[1],n=t[2]):(e=t[0],i=t[1],n=t[2],a=t[3]):e=i=n=a=0,[e,i,n,a]},isWebGLSupported:function(){var t={stencil:!0};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);return!(!i||!i.getContextAttributes().stencil)}catch(t){return!1}},checkOpt:function(t){return t?t.context||(t.context={}):t={context:{}},t}};St._pixelCtx=St.initElement(pt.createCanvas(1,1,"_pixelCanvas")).getContext("2d");var At=function(t,e,i,n,a,r){this.a=void 0!=t?t:1,this.b=void 0!=e?e:0,this.c=void 0!=i?i:0,this.d=void 0!=n?n:1,this.tx=void 0!=a?a:0,this.ty=void 0!=r?r:0,this.array=null};At.prototype={concat:function(t){var e=this.a,i=this.c,n=this.tx;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=n*t.a+this.ty*t.c+t.tx,this.ty=n*t.b+this.ty*t.d+t.ty,this},concatTransform:function(t,e,i,n,a){var r=1,s=0;if(a%360){var o=a*Math.PI/180;r=Math.cos(o),s=Math.sin(o)}return this.concat(new At(r*i,s*i,-s*n,r*n,t,e)),this},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,a=this.c,r=this.tx;if(t>0)this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=a*e-this.d*i,this.d=a*i+this.d*e,this.tx=r*e-this.ty*i,this.ty=r*i+this.ty*e;else{var s=Math.sin(Math.abs(t)),o=Math.cos(Math.abs(t));this.a=n*o+this.b*s,this.b=-n*s+this.b*o,this.c=a*o+this.d*s,this.d=-a*s+o*this.d,this.tx=o*r+s*this.ty,this.ty=o*this.ty-s*r}return this},scale:function(t,e){return this.a*=t,this.d*=e,this.tx*=t,this.ty*=e,this},translate:function(t,e){return this.tx+=t,this.ty+=e,this},identity:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},invert:function(){var t=this.a,e=this.b,i=this.c,n=this.d,a=this.tx,r=t*n-e*i;return this.a=n/r,this.b=-e/r,this.c=-i/r,this.d=t/r,this.tx=(i*this.ty-n*a)/r,this.ty=-(t*this.ty-e*a)/r,this},clone:function(){return new At(this.a,this.b,this.c,this.d,this.tx,this.ty)},toArray:function(t,e){if(0==arguments.length)return[this.a,this.b,this.c,this.d,this.tx,this.ty];this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},mulVector:function(t){var e=this.a,i=this.c,n=this.tx,a=this.b,r=this.d,s=this.ty,o=[0,0];return o[0]=t[0]*e+t[1]*i+n,o[1]=t[0]*a+t[1]*r+s,o}};class kt{constructor(t=0,e=0){if(1==arguments.length&&"object"==typeof arguments[0]){var i=arguments[0];if("x"in i&&"y"in i)this.x=1*i.x,this.y=1*i.y;else{var n=0;for(var a in i){if(0!=n){this.y=1*i[a];break}this.x=1*i[a],n++}}}else this.x=1*t,this.y=1*e}toArray(){return[this.x,this.y]}}"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;for(var Ct,Tt=(function(t,e){var i=function(){this._tweens={},this._tweensAddedDuringUpdate={}};i.prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},remove:function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},update:function(t,e){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(t=void 0!==t?t:a.now();i.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<i.length;n++)!1===this._tweens[i[n]].update(t)&&(this._tweens[i[n]]._isPlaying=!1,e||delete this._tweens[i[n]]);i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var n,a=new i;a.Group=i,a._nextId=0,a.nextId=function(){return a._nextId++},"undefined"==typeof window&&"undefined"!=typeof process?a.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?a.now=window.performance.now.bind(window.performance):void 0!==Date.now?a.now=Date.now:a.now=function(){return(new Date).getTime()},a.Tween=function(t,e){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=a.Easing.Linear.None,this._interpolationFunction=a.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=e||a,this._id=a.nextId()},a.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(t,e){return this._valuesEnd=t,void 0!==e&&(this._duration=e),this},start:function(t){for(var e in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==t?"string"==typeof t?a.now()+parseFloat(t):t:a.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}void 0!==this._object[e]&&(this._valuesStart[e]=this._object[e],this._valuesStart[e]instanceof Array==!1&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop()},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function(t){return this._yoyo=t,this},easing:function(t){return this._easingFunction=t,this},interpolation:function(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var e,i,n;if(t<this._startTime)return!0;for(e in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(i=(t-this._startTime)/this._duration)>1?1:i,n=this._easingFunction(i),this._valuesEnd)if(void 0!==this._valuesStart[e]){var a=this._valuesStart[e]||0,r=this._valuesEnd[e];r instanceof Array?this._object[e]=this._interpolationFunction(r,n):("string"==typeof r&&(r="+"===r.charAt(0)||"-"===r.charAt(0)?a+parseFloat(r):parseFloat(r)),"number"==typeof r&&(this._object[e]=a+(r-a)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===i){if(this._repeat>0){for(e in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo){var s=this._valuesStartRepeat[e];this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=s}this._valuesStart[e]=this._valuesStartRepeat[e]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,l=this._chainedTweens.length;o<l;o++)this._chainedTweens[o].start(this._startTime+this._duration);return!1}return!0}},a.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-a.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*a.Easing.Bounce.In(2*t):.5*a.Easing.Bounce.Out(2*t-1)+.5}}},a.Interpolation={Linear:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n),s=a.Interpolation.Utils.Linear;return e<0?s(t[0],t[1],n):e>1?s(t[i],t[i-1],i-n):s(t[r],t[r+1>i?i:r+1],n-r)},Bezier:function(t,e){for(var i=0,n=t.length-1,r=Math.pow,s=a.Interpolation.Utils.Bernstein,o=0;o<=n;o++)i+=r(1-e,n-o)*r(e,o)*t[o]*s(n,o);return i},CatmullRom:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n),s=a.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(r=Math.floor(n=i*(1+e))),s(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],n-r)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(s(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):s(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],n-r)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=a.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:(n=[1],function(t){var e=1;if(n[t])return n[t];for(var i=t;i>1;i--)e*=i;return n[t]=e,e}),CatmullRom:function(t,e,i,n,a){var r=.5*(i-t),s=.5*(n-e),o=a*a;return(2*e-2*i+r+s)*(a*o)+(-3*e+3*i-2*r-s)*o+r*a+e}}},t.exports=a}(Ct={exports:{}},Ct.exports),Ct.exports),Pt=0,Lt=["ms","moz","webkit","o"],Dt=0;Dt<Lt.length&&!window.requestAnimationFrame;++Dt)window.requestAnimationFrame=window[Lt[Dt]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[Lt[Dt]+"CancelAnimationFrame"]||window[Lt[Dt]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var i=(new Date).getTime(),n=Math.max(0,16-(i-Pt)),a=window.setTimeout(function(){t(i+n)},n);return Pt=i+n,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});var Mt=[],Ot=null;function It(t){if(t)return Mt.push(t),Ot||(Ot=requestAnimationFrame(function(){Tt.update();var t=Mt;for(Mt=[],Ot=null;t.length>0;)t.shift().task()})),Ot}function Et(t){for(var e=!1,i=0,n=Mt.length;i<n;i++)Mt[i].id===t.id&&(e=!0,Mt.splice(i,1),i--,n--);return 0==Mt.length&&(cancelAnimationFrame(Ot),Ot=null),e}var Rt={registFrame:It,destroyFrame:Et,registTween:function(t){var e=H.extend({from:null,to:null,duration:500,onStart:function(){},onUpdate:function(){},onComplete:function(){},onStop:function(){},repeat:0,delay:0,easing:"Linear.None",desc:""},t),i={},n="tween_"+St.getUID();e.id&&(n=n+"_"+e.id),e.from&&e.to&&((i=new Tt.Tween(e.from).to(e.to,e.duration).onStart(function(){e.onStart(e.from)}).onUpdate(function(){e.onUpdate(e.from)}).onComplete(function(){Et({id:n}),i._isCompleteed=!0,e.onComplete(e.from)}).onStop(function(){Et({id:n}),i._isStoped=!0,e.onStop(e.from)}).repeat(e.repeat).delay(e.delay).easing(Tt.Easing[e.easing.split(".")[0]][e.easing.split(".")[1]])).id=n,i.start(),function t(){i._isCompleteed||i._isStoped?i=null:It({id:n,task:t,desc:e.desc,tween:i})}());return i},destroyTween:function(t,e){t.stop()},Tween:Tt,taskList:Mt};var Ft=Object.defineProperty;try{Ft({},"_",{value:"x"});var Wt=Object.defineProperties}catch(t){"__defineGetter__"in Object&&(Ft=function(t,e,i){return"value"in i&&(t[e]=i.value),"get"in i&&t.__defineGetter__(e,i.get),"set"in i&&t.__defineSetter__(e,i.set),t},Wt=function(t,e){for(var i in e)e.hasOwnProperty(i)&&Ft(t,i,e[i]);return t})}Math.PI,Math.PI,Math.PI;const Nt={UNKNOWN:0,WEBGL:1,CANVAS:2},zt={POLY:0,RECT:1,CIRC:2,ELIP:3},Gt=["x","y","scaleX","scaleY","rotation","scaleOrigin","rotateOrigin"],Bt=["lineWidth","lineAlpha","strokeStyle","fillStyle","fillAlpha","globalAlpha"];var Ht=function(t,e,i,n){var a=t[0],r=t[1],s=t[2],o=t[3],l=Math.max(n,3),h=0,d=a;return!(i>r+l&&i>o+l||i<r-l&&i<o-l||e>a+l&&e>s+l||e<a-l&&e<s-l)&&(a===s?Math.abs(e-a)<=l/2:((h=(r-o)/(a-s))*e-i+(d=(a*o-s*r)/(a-s)))*(h*e-i+d)/(h*h+1)<=l/2*l/2)};function jt(t,e,i,n){var a=t.shape.points,r=t.lineWidth,s=!1;for(let t=0;t<a.length&&!(s=Ht(a.slice(t,t+4),e,i,r));++t)t+=1;return s}var Vt={RESOLUTION:window.devicePixelRatio||1,TARGET_FPMS:.06,MIPMAP_TEXTURES:!0,FILTER_RESOLUTION:1,SPRITE_BATCH_SIZE:4096,RETINA_PREFIX:/@(.+)x/,RENDER_OPTIONS:{view:null,antialias:!0,forceFXAA:!1,autoResize:!1,transparent:!0,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1},TRANSFORM_MODE:0,GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:0,SCALE_MODE:0,PRECISION:"mediump"};class Yt extends _t{constructor(t){super(t),this._transform=null,this.worldTransform=null,this._transformChange=!1,this._heartBeatNum=0,this.stage=null,this.parent=null,this.xyToInt=!("xyToInt"in t)||t.xyToInt,this.moveing=!1,this.clip=null,this.context=this._createContext(t),this.type=t.type||"DisplayObject",this.id=t.id||St.createId(this.type),this._trackList=[],this.init.apply(this,arguments),this._updateTransform(),this._tweens=[];var e=this;this.on("destory",function(){e.cleanAnimates()})}init(){}clipTo(t){this.clip=t,t.isClip=!0}_createContext(t){var e=this,i=t.context||{},n={width:i.width||0,height:i.height||0,x:i.x||0,y:i.y||0,scaleX:i.scaleX||1,scaleY:i.scaleY||1,scaleOrigin:i.scaleOrigin||{x:0,y:0},rotation:i.rotation||0,rotateOrigin:i.rotateOrigin||{x:0,y:0},visible:i.visible||!0,globalAlpha:i.globalAlpha||1};return H.extend(!0,n,t.context),e._notWatch=!1,e._noHeart=!1,n.$watch=function(t,i,n){var a=e;a.context&&("globalGalpha"==t&&(a._globalAlphaChange=!0),H.indexOf(Gt,t)>-1&&(a._updateTransform(),a._transformChange=!0),a._notWatch||(a.$watch&&(a._notWatch=!0,a.$watch(t,i,n),a._notWatch=!1),a._noHeart||a.heartBeat({convertType:"context",shape:a,name:t,value:i,preValue:n})))},function t(e){var i=!0,n={},a={},r=["$watch","$model"],s={},o=r;function l(e,l){-1===H.indexOf(r,e)&&(s[e]=l);var h=typeof l;if(!(H.indexOf(o,e)>-1))if("function"===h)o.push(e);else{var d=function(a){var r,o=s[e],l=o;if(!arguments.length)return!o||"object"!==h||o instanceof Array||o.$model||o.addColorStop||((o=t(o)).$watch=n.$watch,s[e]=o),o;var d=typeof a;i||o!==a&&(!a||"object"!==d||a instanceof Array||a.addColorStop?o=a:r=(o=a.$model?a:t(a)).$model,s[e]=r||o,h!=d&&(h=d),n.$watch&&n.$watch.call(n,e,o,l))};a[e]={set:d,get:d,enumerable:!0}}}for(var h in e)l(h,e[h]);return n=Wt(n,a,o),H.forEach(o,function(t){e[t]&&("function"==typeof e[t]?n[t]=function(){e[t].apply(this,arguments)}:n[t]=e[t])}),n.$model=s,n.hasOwnProperty=function(t){return t in n.$model},i=!1,n}(n)}track(t){-1==H.indexOf(this._trackList,t)&&this._trackList.push(t)}untrack(t){var e=H.indexOf(this._trackList,t);e>-1&&this._trackList.splice(e,1)}clone(t){var e,i={id:this.id,context:H.clone(this.context.$model),isClone:!0};return(e="text"==this.type?new this.constructor(this.text,i):new this.constructor(i)).id=i.id,this.children&&(e.children=this.children),this.graphics&&(e.graphics=this.graphics.clone()),t||(e.id=St.createId(e.type)),e}heartBeat(t){var e=this.getStage();e&&(this._heartBeatNum++,e.heartBeat&&e.heartBeat(t))}getCurrentWidth(){return Math.abs(this.context.$model.width*this.context.$model.scaleX)}getCurrentHeight(){return Math.abs(this.context.$model.height*this.context.$model.scaleY)}getStage(){if(this.stage)return this.stage;var t=this;if("stage"!=t.type){for(;t.parent&&"stage"!=(t=t.parent).type;);if("stage"!==t.type)return!1}return this.stage=t,t}localToGlobal(t,e){!t&&(t=new kt(0,0));var i=this.getConcatenatedMatrix(e);if(null==i)return kt(0,0);var n=new At(1,0,0,1,t.x,t.y);return n.concat(i),new kt(n.tx,n.ty)}globalToLocal(t,e){if(!t&&(t=new kt(0,0)),"stage"==this.type)return t;var i=this.getConcatenatedMatrix(e);if(null==i)return new kt(0,0);i.invert();var n=new At(1,0,0,1,t.x,t.y);return n.concat(i),new kt(n.tx,n.ty)}localToTarget(t,e){var i=localToGlobal(t);return e.globalToLocal(i)}getConcatenatedMatrix(t){for(var e=new At,i=this;null!=i;i=i.parent)if(e.concat(i._transform),!i.parent||t&&i.parent&&i.parent==t||i.parent&&"stage"==i.parent.type)return e;return e}setEventEnable(t){return!!H.isBoolean(t)&&(this._eventEnabled=t,!0)}getIndex(){if(this.parent)return H.indexOf(this.parent.children,this)}toBack(t){if(this.parent){var e=this.getIndex(),i=0;if(H.isNumber(t)){if(0==t)return;i=e-t}var n=this.parent.children.splice(e,1)[0];i<0&&(i=0),this.parent.addChildAt(n,i)}}toFront(t){if(this.parent){var e=this.getIndex(),i=this.parent.children.length,n=i;if(H.isNumber(t)){if(0==t)return;n=e+t+1}var a=this.parent.children.splice(e,1)[0];n>i&&(n=i),this.parent.addChildAt(a,n-1)}}_updateTransform(){var t=new At;t.identity();var e=this.context;1===e.scaleX&&1===e.scaleY||(((i=new kt(e.scaleOrigin)).x||i.y)&&t.translate(-i.x,-i.y),t.scale(e.scaleX,e.scaleY),(i.x||i.y)&&t.translate(i.x,i.y));var i,n=e.rotation;n&&(((i=new kt(e.rotateOrigin)).x||i.y)&&t.translate(-i.x,-i.y),t.rotate(n%360*Math.PI/180),(i.x||i.y)&&t.translate(i.x,i.y));if(this.xyToInt&&!this.moveing){var a=parseInt(e.x),r=parseInt(e.y);parseInt(e.lineWidth,10)%2==1&&e.strokeStyle&&(a+=.5,r+=.5)}else a=e.x,r=e.y;return 0==a&&0==r||t.translate(a,r),this._transform=t,t}setWorldTransform(){var t=new At;return t.concat(this._transform),this.parent&&t.concat(this.parent.worldTransform),this.worldTransform=t,this.worldTransform}getChildInPoint(t){var e=!1,i=t.x,n=t.y;if(this.worldTransform){var a=this.worldTransform.clone().invert(),r=[i*Vt.RESOLUTION,n*Vt.RESOLUTION];i=(r=a.mulVector(r))[0],n=r[1]}if(this.graphics&&(e=this.containsPoint({x:i,y:n})),"text"==this.type){var s=this.getRect();return!(!s.width||!s.height)&&(e=i>=s.x&&i<=s.x+s.width&&(s.height>=0&&n>=s.y&&n<=s.y+s.height||s.height<0&&n<=s.y&&n>=s.y+s.height))}return e}containsPoint(t){let e=!1;for(let i=0;i<this.graphics.graphicsData.length;++i){const n=this.graphics.graphicsData[i];if(n.shape){if(n.hasFill()&&n.shape.contains(t.x,t.y)&&(e=!0))break;if(n.hasLine()&&n.shape.points&&(e=jt(n,t.x,t.y)))break}}return e}animate(t,e,i){if(i||(i=this.context),i){var n=t,a=null;for(var r in n)H.isObject(n[r])?this.animate(n[r],H.extend({},e),i[r]):isNaN(n[r])&&""!==n[r]&&null!==n[r]?(i[r]=n[r],delete n[r]):(a||(a={}),a[r]=i[r]);if(a){!e&&(e={}),e.from=a,e.to=n;var s,o=this,l=function(){};e.onUpdate&&(l=e.onUpdate),e.onUpdate=function(t){if(!i&&s)return Rt.destroyTween(s),void(s=null);for(var e in t)i[e]=t[e];l.apply(o,[t])};var h=function(){};return e.onComplete&&(h=e.onComplete),e.onComplete=function(t){h.apply(o,arguments),o._removeTween(s)},e.onStop=function(){o._removeTween(s)},e.desc="tweenType:DisplayObject.animate__id:"+this.id+"__objectType:"+this.type,s=Rt.registTween(e),this._tweens.push(s),s}}}_removeTween(t){for(var e=0;e<this._tweens.length;e++)if(t==this._tweens[e]){this._tweens.splice(e,1);break}}removeAnimate(t){t.stop(),this._removeTween(t)}cleanAnimates(){this._cleanAnimates()}_cleanAnimates(){for(;this._tweens.length;)this._tweens.shift().stop()}remove(){this.parent&&(this.parent.removeChild(this),this.parent=null)}destroy(){this._destroy()}_destroy(){this.remove(),this.fire("destroy"),this.context=null,delete this.context}}class $t extends Yt{constructor(t){super(t),this.children=[],this.mouseChildren=[],this._eventEnabled=!0}addChild(t,e){if(t)return-1!=this.getChildIndex(t)?(t.parent=this,t):(t.parent&&t.parent.removeChild(t),void 0===e&&(e=this.children.length),this.children.splice(e,0,t),t.parent=this,this.heartBeat&&this.heartBeat({convertType:"children",target:t,src:this}),this._afterAddChild&&this._afterAddChild(t),t)}addChildAt(t,e){return this.addChild(t,e)}removeChild(t){return this.removeChildAt(H.indexOf(this.children,t))}removeChildAt(t){if(t<0||t>this.children.length-1)return!1;var e=this.children[t];return null!=e&&(e.parent=null),this.children.splice(t,1),this.heartBeat&&this.heartBeat({convertType:"children",target:e,src:this}),this._afterDelChild&&this._afterDelChild(e,t),e}removeChildById(t){for(var e=0,i=this.children.length;e<i;e++)if(this.children[e].id==t)return this.removeChildAt(e);return!1}removeAllChildren(){for(;this.children.length>0;)this.removeChildAt(0)}destroy(){for(var t=0,e=this.children.length;t<e;t++)this.getChildAt(t).destroy(),t--,e--;this._destroy()}cleanAnimates(){for(var t=0,e=this.children.length;t<e;t++)this.getChildAt(t).cleanAnimates();this._cleanAnimates()}getChildById(t,e){if(e)return null;for(var i=0,n=this.children.length;i<n;i++)if(this.children[i].id==t)return this.children[i];return null}getChildAt(t){return t<0||t>this.children.length-1?null:this.children[t]}getChildIndex(t){return H.indexOf(this.children,t)}setChildIndex(t,e){if(t.parent==this){var i=H.indexOf(this.children,t);e!=i&&(this.children.splice(i,1),this.children.splice(e,0,t))}}getNumChildren(){return this.children.length}getObjectsUnderPoint(t,e){for(var i=[],n=this.children.length-1;n>=0;n--){var a=this.children[n];if(null!=a&&(a._eventEnabled||a.dragEnabled)&&a.context.$model.visible)if(a instanceof $t){if(a.mouseChildren&&a.getNumChildren()>0){var r=a.getObjectsUnderPoint(t);r.length>0&&(i=i.concat(r))}}else if(a.getChildInPoint(t)&&(i.push(a),void 0!=e&&!isNaN(e)&&i.length==e))return i}return i}}class qt extends $t{constructor(t){t.type="stage",super(t),this.canvas=null,this.ctx=null,this.stageRending=!1,this._isReady=!1}initStage(t,e,i){this.canvas=t;var n=this.context;n.width=e,n.height=i,n.scaleX=St._devicePixelRatio,n.scaleY=St._devicePixelRatio,this._isReady=!0}heartBeat(t){this._isReady&&(t||(t={}),t.stage=this,this.parent&&this.parent.heartBeat(t))}}class Xt{constructor(t=Nt.UNKNOWN,e,i){if(this.type=t,this.app=e,i)for(const t in Vt.RENDER_OPTIONS)void 0===i[t]&&(i[t]=Vt.RENDER_OPTIONS[t]);else i=Vt.RENDER_OPTIONS;this.options=i,this.requestAid=null,this._heartBeat=!1,this._preRenderTime=0}startEnter(){var t=this;t.requestAid||(t.requestAid=Rt.registFrame({id:"enterFrame",task:function(){t.enterFrame.apply(t)}}))}enterFrame(){this.requestAid=null,St.now=(new Date).getTime(),this._heartBeat&&(this.app.children.length&&this.render(this.app),this._heartBeat=!1,this._preRenderTime=(new Date).getTime())}_convertCanvax(t){H.each(this.app.children,function(e){e.context[t.name]=t.value})}heartBeat(t){var e=this;if(t){if("context"==t.convertType){var i=t.stage,n=t.shape;t.name,t.value,t.preValue;if("canvax"==n.type)e._convertCanvax(t);else if(e.app.convertStages[i.id]||(e.app.convertStages[i.id]={stage:i,convertShapes:{}}),n){if(e.app.convertStages[i.id].convertShapes[n.id])return;e.app.convertStages[i.id].convertShapes[n.id]={shape:n,convertType:t.convertType}}}if("children"==t.convertType){var a=t.target;((i=t.src.getStage())||"stage"==a.type)&&(i=i||a,e.app.convertStages[i.id]||(e.app.convertStages[i.id]={stage:i,convertShapes:{}}))}if(!t.convertType){i=t.stage;e.app.convertStages[i.id]||(e.app.convertStages[i.id]={stage:i,convertShapes:{}})}}else H.each(e.app.children,function(t,i){e.app.convertStages[t.id]={stage:t,convertShapes:{}}});e._heartBeat?e._heartBeat=!0:(e._heartBeat=!0,e.startEnter())}}class Ut{constructor(t){this.renderer=t}render(t,e,i,n){this.renderer;const a=t.graphics.graphicsData,r=e.ctx;for(let t=0;t<a.length;t++){const e=a[t],s=e.shape,o=e.fillStyle,l=e.strokeStyle,h=e.hasFill()&&e.fillAlpha&&!n,d=e.hasLine()&&e.lineAlpha&&!n;if(r.lineWidth=e.lineWidth,e.type===zt.POLY)r.beginPath(),this.renderPolygon(s.points,s.closed,r,n),h&&(r.globalAlpha=e.fillAlpha*i,r.fillStyle=o,r.fill()),d&&(r.globalAlpha=e.lineAlpha*i,r.strokeStyle=l,r.stroke());else if(e.type===zt.RECT)n&&r.rect(s.x,s.y,s.width,s.height),h&&(r.globalAlpha=e.fillAlpha*i,r.fillStyle=o,r.fillRect(s.x,s.y,s.width,s.height)),d&&(r.globalAlpha=e.lineAlpha*i,r.strokeStyle=l,r.strokeRect(s.x,s.y,s.width,s.height));else if(e.type===zt.CIRC)r.beginPath(),r.arc(s.x,s.y,s.radius,0,2*Math.PI),r.closePath(),h&&(r.globalAlpha=e.fillAlpha*i,r.fillStyle=o,r.fill()),d&&(r.globalAlpha=e.lineAlpha*i,r.strokeStyle=l,r.stroke());else if(e.type===zt.ELIP){const t=2*s.width,n=2*s.height,a=s.x-t/2,u=s.y-n/2;r.beginPath();const c=.5522848,f=t/2*c,p=n/2*c,g=a+t,y=u+n,v=a+t/2,x=u+n/2;r.moveTo(a,x),r.bezierCurveTo(a,x-p,v-f,u,v,u),r.bezierCurveTo(v+f,u,g,x-p,g,x),r.bezierCurveTo(g,x+p,v+f,y,v,y),r.bezierCurveTo(v-f,y,a,x+p,a,x),r.closePath(),h&&(r.globalAlpha=e.fillAlpha*i,r.fillStyle=o,r.fill()),d&&(r.globalAlpha=e.lineAlpha*i,r.strokeStyle=l,r.stroke())}}}renderPolygon(t,e,i,n){i.moveTo(t[0],t[1]);for(let e=1;e<t.length/2;++e)i.lineTo(t[2*e],t[2*e+1]);(e||n)&&i.closePath()}}class Zt extends Xt{constructor(t,e={}){super(Nt.CANVAS,t,e),this.CGR=new Ut(this)}render(t){var e=this;e.app=t,H.each(H.values(t.convertStages),function(t){e.renderStage(t.stage)}),t.convertStages={}}renderStage(t){t.ctx||(t.ctx=t.canvas.getContext("2d")),t.stageRending=!0,t.setWorldTransform(),this._clear(t),this._render(t,t,t.context.globalAlpha),t.stageRending=!1}_render(t,e,i){var n=t.ctx;if(n){var a=e.context.$model;if((!e.worldTransform||e._transformChange||e.parent&&e.parent._transformChange)&&(e.setWorldTransform(),e._transformChange=!0),i*=a.globalAlpha,a.visible&&!e.isClip){n.setTransform.apply(n,e.worldTransform.toArray());var r=!1;if(e.clip&&e.clip.graphics){var s=e.clip;n.save(),r=!0,(!s.worldTransform||s._transformChange||s.parent._transformChange)&&(s.setWorldTransform(),s._transformChange=!0),n.setTransform.apply(n,s.worldTransform.toArray()),s.graphics.graphicsData.length||s._draw(s.graphics),this.CGR.render(s,t,i,r),s._transformChange=!1,n.clip()}if(e.graphics&&(e.graphics.graphicsData.length||e._draw(e.graphics),i&&this.CGR.render(e,t,i)),"text"==e.type&&e.render(n,i),e.children)for(var o=0,l=e.children.length;o<l;o++)this._render(t,e.children[o],i);e._transformChange=!1,r&&n.restore()}}}_clear(t){var e=t.ctx;e.setTransform.apply(e,t.worldTransform.toArray()),e.clearRect(0,0,this.app.width,this.app.height)}}class Qt{constructor(t,e,i,n,a,r){this.lineWidth=t,this.strokeStyle=e,this.lineAlpha=i,this.fillStyle=n,this.fillAlpha=a,this.shape=r,this.type=r.type,this.holes=[],this.fill=!0,this.line=!0}clone(){var t=new Qt(this.lineWidth,this.strokeStyle,this.lineAlpha,this.fillStyle,this.fillAlpha,this.shape);return t.fill=this.fill,t.line=this.line,t}addHole(t){this.holes.push(t)}synsStyle(t){this.line&&(this.lineWidth=t.lineWidth,this.strokeStyle=t.strokeStyle,this.lineAlpha=t.lineAlpha),this.fill&&(this.fillStyle=t.fillStyle,this.fillAlpha=t.fillAlpha)}hasFill(){return this.fillStyle&&this.fill&&void 0!==this.shape.closed&&this.shape.closed}hasLine(){return this.strokeStyle&&this.lineWidth&&this.line}destroy(){this.shape=null,this.holes=null}}var Jt={},Kt={},te={},ee=Array.prototype.join;function ie(t,e,i,n,a,r,s){var o=ee.call(arguments);if(Jt[o])return Jt[o];var l=Math.PI,h=s*l/180,d=Math.sin(h),u=Math.cos(h),c=0,f=0,p=-u*t*.5-d*e*.5,g=-u*e*.5+d*t*.5,y=(i=Math.abs(i))*i,v=(n=Math.abs(n))*n,x=g*g,_=p*p,m=y*v-y*x-v*_,b=0;if(m<0){var w=Math.sqrt(1-m/(y*v));i*=w,n*=w}else b=(a===r?-1:1)*Math.sqrt(m/(y*x+v*_));var S=b*i*g/n,A=-b*n*p/i,k=u*S-d*A+.5*t,C=d*S+u*A+.5*e,T=ae(1,0,(p-S)/i,(g-A)/n),P=ae((p-S)/i,(g-A)/n,(-p-S)/i,(-g-A)/n);0===r&&P>0?P-=2*l:1===r&&P<0&&(P+=2*l);for(var L=Math.ceil(Math.abs(P/l*2)),D=[],M=P/L,O=8/3*Math.sin(M/4)*Math.sin(M/4)/Math.sin(M/2),I=T+M,E=0;E<L;E++)D[E]=ne(T,I,u,d,i,n,k,C,O,c,f),c=D[E][4],f=D[E][5],T=I,I+=M;return Jt[o]=D,D}function ne(t,e,i,n,a,r,s,o,l,h,d){var u=ee.call(arguments);if(Kt[u])return Kt[u];var c=Math.cos(t),f=Math.sin(t),p=Math.cos(e),g=Math.sin(e),y=i*a*p-n*r*g+s,v=n*a*p+i*r*g+o,x=h+l*(-i*a*f-n*r*c),_=d+l*(-n*a*f+i*r*c),m=y+l*(i*a*g+n*r*p),b=v+l*(n*a*g-i*r*p);return Kt[u]=[x,_,m,b,y,v],Kt[u]}function ae(t,e,i,n){var a=Math.atan2(e,t),r=Math.atan2(n,i);return r>=a?r-a:2*Math.PI-(a-r)}function re(t,e,i,n,a,r,s,o){var l=ee.call(arguments);if(te[l])return te[l];var h,d,u,c,f,p,g,y,v=Math.sqrt,x=Math.min,_=Math.max,m=Math.abs,b=[],w=[[],[]];d=6*t-12*i+6*a,h=-3*t+9*i-9*a+3*s,u=3*i-3*t;for(var S=0;S<2;++S)if(S>0&&(d=6*e-12*n+6*r,h=-3*e+9*n-9*r+3*o,u=3*n-3*e),m(h)<1e-12){if(m(d)<1e-12)continue;0<(c=-u/d)&&c<1&&b.push(c)}else(g=d*d-4*u*h)<0||(0<(f=(-d+(y=v(g)))/(2*h))&&f<1&&b.push(f),0<(p=(-d-y)/(2*h))&&p<1&&b.push(p));for(var A,k,C,T=b.length,P=T;T--;)A=(C=1-(c=b[T]))*C*C*t+3*C*C*c*i+3*C*c*c*a+c*c*c*s,w[0][T]=A,k=C*C*C*e+3*C*C*c*n+3*C*c*c*r+c*c*c*o,w[1][T]=k;w[0][P]=t,w[1][P]=e,w[0][P+1]=s,w[1][P+1]=o;var L=[{x:x.apply(null,w[0]),y:x.apply(null,w[1])},{x:_.apply(null,w[0]),y:_.apply(null,w[1])}];return te[l]=L,L}var se={drawArc:function(t,e,i,n){for(var a=n[0],r=n[1],s=n[2],o=n[3],l=n[4],h=[[],[],[],[]],d=ie(n[5]-e,n[6]-i,a,r,o,l,s),u=0,c=d.length;u<c;u++)h[u][0]=d[u][0]+e,h[u][1]=d[u][1]+i,h[u][2]=d[u][2]+e,h[u][3]=d[u][3]+i,h[u][4]=d[u][4]+e,h[u][5]=d[u][5]+i,t.bezierCurveTo.apply(t,h[u])},getBoundsOfCurve:re,getBoundsOfArc:function(t,e,i,n,a,r,s,o,l){for(var h,d=0,u=0,c=[],f=ie(o-t,l-e,i,n,r,s,a),p=0,g=f.length;p<g;p++)h=re(d,u,f[p][0],f[p][1],f[p][2],f[p][3],f[p][4],f[p][5]),c.push({x:h[0].x+t,y:h[0].y+e}),c.push({x:h[1].x+t,y:h[1].y+e}),d=f[p][4],u=f[p][5];return c}};class oe{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n,this.type=zt.RECT,this.closed=!0}clone(){return new oe(this.x,this.y,this.width,this.height)}copy(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}contains(t,e){return!(this.height*e<0||this.width*t<0)&&(t>=this.x&&t<=this.x+this.width&&(this.height>=0&&e>=this.y&&e<=this.y+this.height||this.height<0&&e<=this.y&&e>=this.y+this.height))}}class le{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=zt.CIRC,this.closed=!0}clone(){return new le(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,a=this.y-e;return(n*=n)+(a*=a)<=i}getBounds(){return new oe(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}class he{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n,this.type=zt.ELIP,this.closed=!0}clone(){return new he(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,n=(e-this.y)/this.height;return(i*=i)+(n*=n)<=1}getBounds(){return new oe(this.x-this.width,this.y-this.height,this.width,this.height)}}class de{constructor(...t){const e=t[0];if(Array.isArray(e)&&(t=e),e&&"x"in e&&"y"in e){const e=[];for(let i=0,n=t.length;i<n;i++)e.push(t[i].x,t[i].y);t=e}this.closed=!0,this.points=t,this.type=zt.POLY}clone(){return new de(this.points.slice())}close(){const t=this.points;t[0]===t[t.length-2]&&t[1]===t[t.length-1]||t.push(t[0],t[1]),this.closed=!0}contains(t,e){return this._isInsidePolygon_WindingNumber(t,e)}_isInsidePolygon_WindingNumber(t,e){for(var i,n=this.points,a=0,r=n[1]>e,s=3;s<n.length;s+=2)if((i=r)!=(r=n[s]>e)){var o=(i?1:0)-(r?1:0);o*((n[s-3]-t)*(n[s-0]-e)-(n[s-2]-e)*(n[s-1]-t))>0&&(a+=o)}return a}}class ue{constructor(t){this.lineWidth=1,this.strokeStyle=null,this.lineAlpha=1,this.fillStyle=null,this.fillAlpha=1,this.graphicsData=[],this.currentPath=null,this.dirty=0,this.clearDirty=0,this._webGL={},this.worldAlpha=1,this.tint=16777215,this.Bound={x:0,y:0,width:0,height:0}}setStyle(t){const e=t.$model;this.lineWidth=e.lineWidth,this.strokeStyle=e.strokeStyle,this.lineAlpha=e.lineAlpha*e.globalAlpha,this.fillStyle=e.fillStyle,this.fillAlpha=e.fillAlpha*e.globalAlpha;var i=this;this.graphicsData.length&&H.each(this.graphicsData,function(t,e){t.synsStyle(i)})}clone(){const t=new ue;t.dirty=0;for(let e=0;e<this.graphicsData.length;++e)t.graphicsData.push(this.graphicsData[e].clone());return t.currentPath=t.graphicsData[t.graphicsData.length-1],t}moveTo(t,e){const i=new de([t,e]);return i.closed=!1,this.drawShape(i),this}lineTo(t,e){return this.currentPath?(this.currentPath.shape.points.push(t,e),this.dirty++):this.moveTo(0,0),this}quadraticCurveTo(t,e,i,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);const a=this.currentPath.shape.points;let r=0,s=0;0===a.length&&this.moveTo(0,0);const o=a[a.length-2],l=a[a.length-1];for(let h=1;h<=20;++h){const d=h/20;r=o+(t-o)*d,s=l+(e-l)*d,a.push(r+(t+(i-t)*d-r)*d,s+(e+(n-e)*d-s)*d)}return this.dirty++,this}bezierCurveTo(t,e,i,n,a,r){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);const s=this.currentPath.shape.points,o=s[s.length-2],l=s[s.length-1];return s.length-=2,function(t,e,i,n,a,r,s,o,l=[]){let h=0,d=0,u=0,c=0,f=0;l.push(t,e);for(let p=1,g=0;p<=20;++p)u=(d=(h=1-(g=p/20))*h)*h,f=(c=g*g)*g,l.push(u*t+3*d*g*i+3*h*c*a+f*s,u*e+3*d*g*n+3*h*c*r+f*o)}(o,l,t,e,i,n,a,r,s),this.dirty++,this}arcTo(t,e,i,n,a){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);const r=this.currentPath.shape.points,s=r[r.length-2],o=r[r.length-1]-e,l=s-t,h=n-e,d=i-t,u=Math.abs(o*d-l*h);if(u<1e-8||0===a)r[r.length-2]===t&&r[r.length-1]===e||r.push(t,e);else{const i=o*o+l*l,n=h*h+d*d,r=o*h+l*d,s=a*Math.sqrt(i)/u,c=a*Math.sqrt(n)/u,f=s*r/i,p=c*r/n,g=s*d+c*l,y=s*h+c*o,v=l*(c+f),x=o*(c+f),_=d*(s+p),m=h*(s+p),b=Math.atan2(x-y,v-g),w=Math.atan2(m-y,_-g);this.arc(g+t,y+e,a,b,w,l*h>d*o)}return this.dirty++,this}arc(t,e,i,n,a,r=!1){if(n===a)return this;!r&&a<=n?a+=2*Math.PI:r&&n<=a&&(n+=2*Math.PI);const s=a-n,o=48*Math.ceil(Math.abs(s)/(2*Math.PI));if(0===s)return this;const l=t+Math.cos(n)*i,h=e+Math.sin(n)*i;let d=this.currentPath?this.currentPath.shape.points:null;d?d[d.length-2]===l&&d[d.length-1]===h||d.push(l,h):(this.moveTo(l,h),d=this.currentPath.shape.points);const u=s/(2*o),c=2*u,f=Math.cos(u),p=Math.sin(u),g=o-1,y=g%1/g;for(let a=0;a<=g;++a){const r=u+n+c*(a+y*a),s=Math.cos(r),o=-Math.sin(r);d.push((f*s+p*o)*i+t,(f*-o+p*s)*i+e)}return this.dirty++,this}drawRect(t,e,i,n){return this.drawShape(new oe(t,e,i,n)),this}drawCircle(t,e,i){return this.drawShape(new le(t,e,i)),this}drawEllipse(t,e,i,n){return this.drawShape(new he(t,e,i,n)),this}drawPolygon(t){let e=t,i=!0;if(e instanceof de&&(i=e.closed,e=e.points),!Array.isArray(e)){e=new Array(arguments.length);for(let t=0;t<e.length;++t)e[t]=arguments[t]}const n=new de(e);return n.closed=i,this.drawShape(n),this}clear(){return this.graphicsData.length>0&&(this.dirty++,this.clearDirty++,this.graphicsData.length=0),this.currentPath=null,this}drawShape(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.beginPath();const e=new Qt(this.lineWidth,this.strokeStyle,this.lineAlpha,this.fillStyle,this.fillAlpha,t);return this.graphicsData.push(e),e.type===zt.POLY&&(e.shape.closed=e.shape.closed,this.currentPath=e),this.dirty++,e}beginPath(){this.currentPath=null}closePath(){const t=this.currentPath;return t&&t.shape&&t.shape.close(),this}updateLocalBounds(){let t=1/0,e=-1/0,i=1/0,n=-1/0;if(this.graphicsData.length){let a=0,r=0,s=0,o=0,l=0;for(let h=0;h<this.graphicsData.length;h++){const d=this.graphicsData[h],u=d.type,c=d.lineWidth;if(a=d.shape,u===zt.RECT||u===zt.RREC)r=a.x-c/2,s=a.y-c/2,o=a.width+c,l=a.height+c,t=r<t?r:t,e=r+o>e?r+o:e,i=s<i?s:i,n=s+l>n?s+l:n;else if(u===zt.CIRC)r=a.x,s=a.y,o=a.radius+c/2,l=a.radius+c/2,t=r-o<t?r-o:t,e=r+o>e?r+o:e,i=s-l<i?s-l:i,n=s+l>n?s+l:n;else if(u===zt.ELIP)r=a.x,s=a.y,o=a.width+c/2,l=a.height+c/2,t=r-o<t?r-o:t,e=r+o>e?r+o:e,i=s-l<i?s-l:i,n=s+l>n?s+l:n;else{const h=a.points;let d=0,u=0,f=0,p=0,g=0,y=0,v=0,x=0;for(let a=0;a+2<h.length;a+=2)r=h[a],s=h[a+1],d=h[a+2],u=h[a+3],f=Math.abs(d-r),p=Math.abs(u-s),l=c,(o=Math.sqrt(f*f+p*p))<1e-9||(y=(l/o*f+p)/2,x=(u+s)/2,t=(v=(d+r)/2)-(g=(l/o*p+f)/2)<t?v-g:t,e=v+g>e?v+g:e,i=x-y<i?x-y:i,n=x+y>n?x+y:n)}}}else t=0,e=0,i=0,n=0;return this.Bound={x:t,y:i,width:e-t,height:n-i},this}getBound(){return this.updateLocalBounds().Bound}destroy(t){for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();for(const t in this._webGL)for(let e=0;e<this._webGL[t].data.length;++e)this._webGL[t].data[e].destroy();this.graphicsData=null,this.currentPath=null,this._webGL=null}}class ce extends Yt{constructor(t){var e={cursor:(t=St.checkOpt(t)).context.cursor||"default",fillAlpha:t.context.fillAlpha||1,fillStyle:t.context.fillStyle||null,lineCap:t.context.lineCap||"round",lineJoin:t.context.lineJoin||"round",miterLimit:t.context.miterLimit||null,lineAlpha:t.context.lineAlpha||1,strokeStyle:t.context.strokeStyle||null,lineType:t.context.lineType||"solid",lineWidth:t.context.lineWidth||null},i=H.extend(!0,e,t.context);t.context=i,void 0===t.id&&void 0!==t.type&&(t.id=St.createId(t.type)),super(t),this._hoverClass=!1,this.hoverClone=!0,this.pointChkPriority=!0,this._eventEnabled=!1,this.dragEnabled=t.dragEnabled||!1,this._dragDuplicate=null,this.type=this.type||"shape",this.initCompProperty(t),this.isClone?this.graphics=null:(this.graphics=new ue,this._draw(this.graphics))}_draw(t){0==t.graphicsData.length&&(t.setStyle(this.context),this.draw(t))}draw(){}clearGraphicsData(){this.graphics.clear()}$watch(t,e,i){H.indexOf(Bt,t)>-1&&this.graphics.setStyle(this.context),this.watch(t,e,i)}initCompProperty(t){for(var e in t)"id"!=e&&"context"!=e&&(this[e]=t[e])}getBound(){return this.graphics.updateLocalBounds().Bound}dashedLineTo(t,e,i,n,a,r){r=void 0===r?3:r,r=Math.max(r,this.context.$model.lineWidth);for(var s=n-e,o=a-i,l=Math.floor(Math.sqrt(s*s+o*o)/r),h=0;h<l;++h){var d=parseInt(e+s/l*h),u=parseInt(i+o/l*h);t[h%2==0?"moveTo":"lineTo"](d,u),h==l-1&&h%2==0&&t.lineTo(n,a)}}}function fe(t,e){var i=0,n=0;if(1==arguments.length&&H.isObject(t)){var a=arguments[0];H.isArray(a)?(i=a[0],n=a[1]):a.hasOwnProperty("x")&&a.hasOwnProperty("y")&&(i=a.x,n=a.y)}this._axes=[i,n]}function pe(t,e,i,n,a,r,s){var o=.25*(i-t),l=.25*(n-e);return(2*(e-i)+o+l)*s+(-3*(e-i)-2*o-l)*r+o*a+e}fe.prototype={distance:function(t){var e=this._axes[0]-t._axes[0],i=this._axes[1]-t._axes[1];return Math.sqrt(e*e+i*i)}};var ge={sin:{},cos:{}},ye=Math.PI/180;function ve(t,e){var i={points:t};H.isFunction(e)&&(i.smoothFilter=e);var n=function(t){var e=t.points,i=t.isLoop,n=t.smoothFilter,a=e.length;if(1==a)return e;for(var r=[],s=0,o=new fe(e[0]),l=null,h=1;h<a;h++)l=new fe(e[h]),s+=o.distance(l),o=l;o=null,l=null;var d=s/6;for(d=d<a?a:d,h=0;h<d;h++){var u,c,f,p=h/(d-1)*(i?a:a-1),g=Math.floor(p),y=p-g,v=e[g%a];i?(u=e[(g-1+a)%a],c=e[(g+1)%a],f=e[(g+2)%a]):(u=e[0===g?g:g-1],c=e[g>a-2?a-1:g+1],f=e[g>a-3?a-1:g+2]);var x=y*y,_=y*x,m=[pe(u[0],v[0],c[0],f[0],y,x,_),pe(u[1],v[1],c[1],f[1],y,x,_)];H.isFunction(n)&&n(m),r.push(m)}return r}(i);return t&&t.length>0&&n.push(t[t.length-1]),n}function xe(t){return!t||H.isArray(t)&&t.length>=2&&(!H.isNumber(t[0])||!H.isNumber(t[1]))||"x"in t&&!H.isNumber(t.x)||"y"in t&&!H.isNumber(t.y)}var _e={PI:Math.PI,sin:function(t,e){return t=(e?t*ye:t).toFixed(4),void 0===ge.sin[t]&&(ge.sin[t]=Math.sin(t)),ge.sin[t]},cos:function(t,e){return t=(e?t*ye:t).toFixed(4),void 0===ge.cos[t]&&(ge.cos[t]=Math.cos(t)),ge.cos[t]},degreeToRadian:function(t){return t*ye},radianToDegree:function(t){return t/ye},degreeTo360:function(t){var e=(360+t%360)%360;return 0==e&&0!==t&&(e=360),e},getIsgonPointList:function(t,e){for(var i=[],n=2*Math.PI/t,a=-Math.PI/2,r=0,s=t;r<s;r++)i.push([e*Math.cos(a),e*Math.sin(a)]),a+=n;return i},getSmoothPointList:function(t,e){var i=[],n=t.length,a=[];return H.each(t,function(t,r){xe(t)?(a.length&&(i=i.concat(ve(a,e)),a=[]),i.push(t)):a.push(t),r==n-1&&a.length&&(i=i.concat(ve(a,e)),a=[])}),i},isNotValibPoint:xe,isValibPoint:function(t){return!xe(t)}};class me extends ce{constructor(t){var e=H.extend({pointList:[],path:""},t.context);t.context=e,t.__parsePathData=null,t.type="path",super(t)}watch(t,e,i){"path"==t&&this.graphics.clear()}_parsePathData(t){if(this.__parsePathData)return this.__parsePathData;if(!t)return[];this.__parsePathData=[];var e=H.compact(t.replace(/[Mm]/g,"\\r$&").split("\\r")),i=this;return H.each(e,function(t){i.__parsePathData.push(i._parseChildPathData(t))}),this.__parsePathData}_parseChildPathData(t){var e,i=t,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];for(i=(i=(i=(i=i.replace(/  /g," ")).replace(/ /g,",")).replace(/(\d)-/g,"$1,-")).replace(/,,/g,","),e=0;e<n.length;e++)i=i.replace(new RegExp(n[e],"g"),"|"+n[e]);var a=i.split("|"),r=[],s=0,o=0;for(e=1;e<a.length;e++){var l=a[e],h=l.charAt(0),d=(l=(l=l.slice(1)).replace(new RegExp("e,-","g"),"e-")).split(",");d.length>0&&""===d[0]&&d.shift();for(var u=0;u<d.length;u++)d[u]=parseFloat(d[u]);for(;d.length>0&&!isNaN(d[0]);){var c,f,p,g=null,y=[],v=s,x=o;switch(h){case"l":s+=d.shift(),o+=d.shift(),g="L",y.push(s,o);break;case"L":s=d.shift(),o=d.shift(),y.push(s,o);break;case"m":s+=d.shift(),o+=d.shift(),g="M",y.push(s,o),h="l";break;case"M":s=d.shift(),o=d.shift(),g="M",y.push(s,o),h="L";break;case"h":s+=d.shift(),g="L",y.push(s,o);break;case"H":s=d.shift(),g="L",y.push(s,o);break;case"v":o+=d.shift(),g="L",y.push(s,o);break;case"V":o=d.shift(),g="L",y.push(s,o);break;case"C":y.push(d.shift(),d.shift(),d.shift(),d.shift()),s=d.shift(),o=d.shift(),y.push(s,o);break;case"c":y.push(s+d.shift(),o+d.shift(),s+d.shift(),o+d.shift()),s+=d.shift(),o+=d.shift(),g="C",y.push(s,o);break;case"S":c=s,f=o,"C"===(p=r[r.length-1]).command&&(c=s+(s-p.points[2]),f=o+(o-p.points[3])),y.push(c,f,d.shift(),d.shift()),s=d.shift(),o=d.shift(),g="C",y.push(s,o);break;case"s":c=s,f=o,"C"===(p=r[r.length-1]).command&&(c=s+(s-p.points[2]),f=o+(o-p.points[3])),y.push(c,f,s+d.shift(),o+d.shift()),s+=d.shift(),o+=d.shift(),g="C",y.push(s,o);break;case"Q":y.push(d.shift(),d.shift()),s=d.shift(),o=d.shift(),y.push(s,o);break;case"q":y.push(s+d.shift(),o+d.shift()),s+=d.shift(),o+=d.shift(),g="Q",y.push(s,o);break;case"T":c=s,f=o,"Q"===(p=r[r.length-1]).command&&(c=s+(s-p.points[0]),f=o+(o-p.points[1])),s=d.shift(),o=d.shift(),g="Q",y.push(c,f,s,o);break;case"t":c=s,f=o,"Q"===(p=r[r.length-1]).command&&(c=s+(s-p.points[0]),f=o+(o-p.points[1])),s+=d.shift(),o+=d.shift(),g="Q",y.push(c,f,s,o);break;case"A":v=s,x=o,g="A",y=[d.shift(),d.shift(),d.shift(),d.shift(),d.shift(),s=d.shift(),o=d.shift(),v,x];break;case"a":v=s,x=o,g="A",y=[d.shift(),d.shift(),d.shift(),d.shift(),d.shift(),s+=d.shift(),o+=d.shift(),v,x]}r.push({command:g||h,points:y})}"z"!==h&&"Z"!==h||r.push({command:"z",points:[]})}return r}draw(t){this.__parsePathData=null,this.context.$model.pointList=[];for(var e=this._parsePathData(this.context.$model.path),i=0,n=e.length;i<n;i++)for(var a=0,r=e[i].length;a<r;a++){var s=e[i][a].command,o=e[i][a].points;switch(s){case"L":t.lineTo(o[0],o[1]);break;case"M":t.moveTo(o[0],o[1]);break;case"C":t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":t.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":se.drawArc(t,o[7],o[8],o);break;case"z":t.closePath()}}return this}}class be extends ce{constructor(t){var e=H.extend({lineType:null,smooth:!1,pointList:[],smoothFilter:St.__emptyFunc},t.context);if(!t.isClone){e.pointList[0];var i=e.pointList.slice(-1)[0];e.smooth&&(e.pointList.unshift(i),e.pointList=_e.getSmoothPointList(e.pointList))}t.context=e,t.type="polygon",super(t)}watch(t,e,i){"pointList"!=t&&"smooth"!=t&&"lineType"!=t||this.graphics.clear()}draw(t){const e=this.context,i=e.pointList;if(!(i.length<2)){t.moveTo(i[0][0],i[0][1]);for(var n=1,a=i.length;n<a;n++)t.lineTo(i[n][0],i[n][1]);if(t.closePath(),"dashed"==e.lineType||"dotted"==e.lineType)if(t.currentPath.line=!1,e.smooth)for(var r=0,s=i.length;r<s&&r!=s-1;r++)t.moveTo(i[r][0],i[r][1]),t.lineTo(i[r+1][0],i[r+1][1]),r+=1;else{t.moveTo(i[0][0],i[0][1]);for(n=1,a=i.length;n<a;n++){var o=i[n-1][0],l=i[n][0],h=i[n-1][1],d=i[n][1];this.dashedLineTo(t,o,h,l,d,5)}}t.closePath()}}}var we={App:class extends $t{constructor(t,e={}){t.type="canvax",super(t),this._cid=(new Date).getTime()+"_"+Math.floor(100*Math.random()),this.el=pt.query(t.el),this.width=parseInt("width"in t||this.el.offsetWidth,10),this.height=parseInt("height"in t||this.el.offsetHeight,10);var i=pt.createView(this.width,this.height,this._cid);this.view=i.view,this.stageView=i.stageView,this.domView=i.domView,this.el.innerHTML="",this.el.appendChild(this.view),this.viewOffset=pt.offset(this.view),this.lastGetRO=0,this.webGL=t.webGL,this.renderer=function(t,e){return new Zt(t,e)}(this,e),this.event=null,this.preventDefault=!0,!1===t.preventDefault&&(this.preventDefault=!1),this.convertStages={},this.context.$model.width=this.width,this.context.$model.height=this.height,this._bufferStage=null,this._creatHoverStage(),this.worldTransform=(new At).identity()}registEvent(t){return this.event=new bt(this,t),this.event.init(),this.event}destroy(){for(var t=0,e=this.children.length;t<e;t++){var i=this.children[t];i.destroy(),i.canvas=null,i.ctx=null,i=null,t--,e--}this.view.removeChild(this.stageView),this.view.removeChild(this.domView),this.el.removeChild(this.view),this.el.innerHTML="",this.event=null,this._bufferStage=null}resize(t){this.width=parseInt(t&&"width"in t||this.el.offsetWidth,10),this.height=parseInt(t&&"height"in t||this.el.offsetHeight,10),this.viewOffset=pt.offset(this.view),this.context.$model.width=this.width,this.context.$model.height=this.height;var e=this;H.each(this.children,function(t,i){var n;t.context.$model.width=e.width,t.context.$model.height=e.height,(n=t.canvas).style.width=e.width+"px",n.style.height=e.height+"px",n.setAttribute("width",e.width*St._devicePixelRatio),n.setAttribute("height",e.height*St._devicePixelRatio)}),this.stageView.style.width=this.width+"px",this.stageView.style.height=this.height+"px",this.domView.style.width=this.width+"px",this.domView.style.height=this.height+"px",this.heartBeat()}getHoverStage(){return this._bufferStage}_creatHoverStage(){this._bufferStage=new qt({id:"activCanvas"+(new Date).getTime(),context:{width:this.context.$model.width,height:this.context.$model.height}}),this._bufferStage._eventEnabled=!1,this.addChild(this._bufferStage)}updateViewOffset(){var t=(new Date).getTime();t-this.lastGetRO>1e3&&(this.viewOffset=pt.offset(this.view),this.lastGetRO=t)}_afterAddChild(t,e){var i;i=t.canvas?t.canvas:pt.createCanvas(this.context.$model.width,this.context.$model.height,t.id),1==this.children.length?this.stageView.appendChild(i):this.children.length>1&&(void 0===e?this.stageView.insertBefore(i,this._bufferStage.canvas):e>=this.children.length-1?this.stageView.appendChild(i):this.stageView.insertBefore(i,this.children[e].canvas)),St.initElement(i),t.initStage(i,this.context.$model.width,this.context.$model.height)}_afterDelChild(t){this.stageView.removeChild(t.canvas)}heartBeat(t){this.children.length>0&&this.renderer.heartBeat(t)}toDataURL(){var t=pt.createCanvas(this.width,this.height,"curr_base64_canvas"),e=t.getContext("2d");return H.each(this.children,function(t){e.drawImage(t.canvas,0,0)}),t.toDataURL()}}};we.Display={DisplayObject:Yt,DisplayObjectContainer:$t,Stage:qt,Sprite:class extends $t{constructor(t){(t=St.checkOpt(t)).type="sprite",super(t)}},Shape:ce,Point:kt,Text:class extends Yt{constructor(t,e){e.type="text",null!==t&&void 0!==t||(t=""),e.context=H.extend({font:"",fontSize:13,fontWeight:"normal",fontFamily:",sans-serif",textBaseline:"top",textAlign:"left",textDecoration:null,fillStyle:"blank",strokeStyle:null,lineWidth:0,lineHeight:1.2,backgroundColor:null,textBackgroundColor:null},e.context),super(e),this._reNewline=/\r?\n/,this.fontProperts=["fontStyle","fontVariant","fontWeight","fontSize","fontFamily"],this.context.font=this._getFontDeclaration(),this.text=t.toString(),this.context.width=this.getTextWidth(),this.context.height=this.getTextHeight()}$watch(t,e,i){H.indexOf(this.fontProperts,t)>=0&&(this.context[t]=e,this.context.font=this._getFontDeclaration(),this.context.width=this.getTextWidth(),this.context.height=this.getTextHeight())}_setContextStyle(t,e,i){for(var n in e)"textBaseline"!=n&&n in t&&(e[n]||H.isNumber(e[n]))&&("globalAlpha"==n?t.globalAlpha=i:t[n]=e[n])}render(t,e){this._renderText(t,this._getTextLines(),e)}resetText(t){this.text=t.toString(),this.heartBeat()}getTextWidth(){var t=0;return St._pixelCtx&&(St._pixelCtx.save(),St._pixelCtx.font=this.context.$model.font,t=this._getTextWidth(St._pixelCtx,this._getTextLines()),St._pixelCtx.restore()),t}getTextHeight(){return this._getTextHeight(St._pixelCtx,this._getTextLines())}_getTextLines(){return this.text.split(this._reNewline)}_renderText(t,e,i){t&&(t.save(),this._setContextStyle(t,this.context.$model,i),this._renderTextStroke(t,e),this._renderTextFill(t,e),t.restore())}_getFontDeclaration(){var t=this,e=[];return H.each(this.fontProperts,function(i){var n=t.context[i];"fontSize"==i&&(n=parseFloat(n)+"px"),n&&e.push(n)}),e.join(" ")}_renderTextFill(t,e){if(this.context.$model.fillStyle){this._boundaries=[];for(var i=0,n=0,a=e.length;n<a;n++)i+=this._getHeightOfLine(t,n,e),this._renderTextLine("fillText",t,e[n],0,this._getTopOffset()+i,n)}}_renderTextStroke(t,e){if(t&&this.context.$model.strokeStyle&&this.context.$model.lineWidth){var i=0;t.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),supportsLineDash&&t.setLineDash(this.strokeDashArray)),t.beginPath();for(var n=0,a=e.length;n<a;n++)i+=this._getHeightOfLine(t,n,e),this._renderTextLine("strokeText",t,e[n],0,this._getTopOffset()+i,n);t.closePath(),t.restore()}}_renderTextLine(t,e,i,n,a,r){if(a-=this._getHeightOfLine()/4,"justify"===this.context.$model.textAlign){var s=e.measureText(i).width,o=this.context.$model.width;if(o>s)for(var l=i.split(/\s+/),h=(o-e.measureText(i.replace(/\s+/g,"")).width)/(l.length-1),d=0,u=0,c=l.length;u<c;u++)this._renderChars(t,e,l[u],n+d,a,r),d+=e.measureText(l[u]).width+h;else this._renderChars(t,e,i,n,a,r)}else this._renderChars(t,e,i,n,a,r)}_renderChars(t,e,i,n,a){e[t](i,0,a)}_getHeightOfLine(){return this.context.$model.fontSize*this.context.$model.lineHeight}_getTextWidth(t,e){for(var i=t.measureText(e[0]||"|").width,n=1,a=e.length;n<a;n++){var r=t.measureText(e[n]).width;r>i&&(i=r)}return i}_getTextHeight(t,e){return this.context.$model.fontSize*e.length*this.context.$model.lineHeight}_getTopOffset(){var t=0;switch(this.context.$model.textBaseline){case"top":t=0;break;case"middle":t=-this.context.$model.height/2;break;case"bottom":t=-this.context.$model.height}return t}getRect(){var t=this.context,e=0,i=0;return"center"==t.textAlign&&(e=-t.width/2),"right"==t.textAlign&&(e=-t.width),"middle"==t.textBaseline&&(i=-t.height/2),"bottom"==t.textBaseline&&(i=-t.height),{x:e,y:i,width:t.width,height:t.height}}}},we.Shapes={BrokenLine:class extends ce{constructor(t){t=St.checkOpt(t);var e=H.extend({lineType:null,smooth:!1,pointList:[],smoothFilter:St.__emptyFunc},t.context);!t.isClone&&e.smooth&&(e.pointList=_e.getSmoothPointList(e.pointList,e.smoothFilter)),t.context=e,t.type="brokenline",super(t),this._pointList=e.pointList}watch(t,e,i){"pointList"!=t&&"smooth"!=t&&"lineType"!=t||("pointList"==t&&this.context.smooth&&(this.context.pointList=_e.getSmoothPointList(e,this.context.smoothFilter),this._pointList=e),"smooth"==t&&(this.context.pointList=e?_e.getSmoothPointList(this._pointList,this.context.smoothFilter):this._pointList),this.graphics.clear())}draw(t){let e=this.context,i=e.pointList,n=!1;for(var a=0,r=i.length;a<r;a++){var s=i[a],o=i[a+1];if(_e.isValibPoint(s)){if(e.lineType&&"solid"!=e.lineType){if("dashed"==e.lineType||"dotted"==e.lineType)if(e.smooth){if(n){t.lineTo(s[0],s[1]),n=!1,a++;continue}t.moveTo(s[0],s[1])}else _e.isValibPoint(o)&&this.dashedLineTo(t,s[0],s[1],o[0],o[1],5)}else n?t.lineTo(s[0],s[1]):t.moveTo(s[0],s[1]);n=!0}else n=!1}return this}},Circle:class extends ce{constructor(t){super(t=H.extend(!0,{type:"circle",xyToInt:!1,context:{r:0}},St.checkOpt(t)))}watch(t,e,i){"r"==t&&this.graphics.clear()}draw(t){var e=this.context.$model.r;e<0&&(e=0),t.drawCircle(0,0,e)}},Droplet:class extends me{constructor(t){super(t=H.extend({type:"droplet",context:{hr:0,vr:0}},St.checkOpt(t))),this.context.$model.path=this.createPath()}watch(t,e,i){"hr"!=t&&"vr"!=t||(this.context.$model.path=this.createPath())}createPath(){var t=this.context.$model,e="M 0 "+t.hr+" C "+t.hr+" "+t.hr+" "+3*t.hr/2+" "+-t.hr/3+" 0 "+-t.vr;return e+=" C "+3*-t.hr/2+" "+-t.hr/3+" "+-t.hr+" "+t.hr+" 0 "+t.hr+"z"}},Ellipse:class extends ce{constructor(t){super(t=H.extend({type:"ellipse",context:{hr:0,vr:0}},St.checkOpt(t)))}watch(t,e,i){"hr"!=t&&"vr"!=t||this.graphics.clear()}draw(t){t.drawEllipse(0,0,2*this.context.$model.hr,2*this.context.$model.vr)}},Isogon:class extends be{constructor(t){var e=H.extend({pointList:[],r:0,n:0},t.context);e.pointList=_e.getIsgonPointList(e.n,e.r),t.context=e,t.type="isogon",super(t)}watch(t,e,i){"r"!=t&&"n"!=t||(this.context.$model.pointList=_e.getIsgonPointList(this.context.$model.n,this.context.$model.r)),"pointList"!=t&&"smooth"!=t&&"lineType"!=t||this.graphics.clear()}},Line:class extends ce{constructor(t){var e=H.extend({lineType:null,start:{x:0,y:0},end:{x:0,y:0},dashLength:3},t.context);t.context=e,t.type="line",super(t)}watch(t,e,i){"x"!=t&&"y"!=t||this.graphics.clear()}draw(t){const e=this.context.$model;return e.lineType&&"solid"!=e.lineType?"dashed"!=e.lineType&&"dotted"!=e.lineType||this.dashedLineTo(t,e.start.x,e.start.y,e.end.x,e.end.y,e.dashLength):(t.moveTo(e.start.x,e.start.y),t.lineTo(e.end.x,e.end.y)),this}},Path:me,Polygon:be,Rect:class extends ce{constructor(t){var e=H.extend({width:0,height:0,radius:[]},t.context);t.context=e,t.type="rect",super(t)}watch(t,e,i){"width"!=t&&"height"!=t&&"radius"!=t||this.graphics.clear()}_buildRadiusPath(t){var e=this.context.$model,i=e.width,n=e.height,a=St.getCssOrderArr(e.radius),r=t,s=1;n>=0&&(s=-1),r.moveTo(parseInt(0+a[0]),parseInt(n)),r.lineTo(parseInt(0+i-a[1]),parseInt(n)),0!==a[1]&&r.quadraticCurveTo(0+i,n,parseInt(0+i),parseInt(n+a[1]*s)),r.lineTo(parseInt(0+i),parseInt(0-a[2]*s)),0!==a[2]&&r.quadraticCurveTo(0+i,0,parseInt(0+i-a[2]),parseInt(0)),r.lineTo(parseInt(0+a[3]),parseInt(0)),0!==a[3]&&r.quadraticCurveTo(0,0,parseInt(0),parseInt(0-a[3]*s)),r.lineTo(parseInt(0),parseInt(0+n+a[0]*s)),0!==a[0]&&r.quadraticCurveTo(0,0+n,parseInt(0+a[0]),parseInt(0+n))}draw(t){var e=this.context.$model;e.radius.length?this._buildRadiusPath(t):t.drawRect(0,0,e.width,e.height),t.closePath()}},Sector:class extends ce{constructor(t){var e=H.extend({pointList:[],r0:0,r:0,startAngle:0,endAngle:0,clockwise:!1},t.context);t.context=e,t.regAngle=[],t.isRing=!1,t.type="sector",super(t)}watch(t,e,i){"r0"!=t&&"r"!=t&&"startAngle"!=t&&"endAngle"!=t&&"clockwise"!=t||(this.isRing=!1,this.graphics.clear())}draw(t){var e=this.context.$model,i=void 0===e.r0?0:e.r0,n=e.r,a=_e.degreeTo360(e.startAngle),r=_e.degreeTo360(e.endAngle);e.startAngle!=e.endAngle&&Math.abs(e.startAngle-e.endAngle)%360==0&&(this.isRing=!0,a=0,r=360),a=_e.degreeToRadian(a),r=_e.degreeToRadian(r);var s=t;this.isRing?0==e.r0?s.drawCircle(0,0,e.r):(e.fillStyle&&e.fillAlpha&&(s.beginPath(),s.arc(0,0,n,a,r,e.clockwise),0==e.r0?s.lineTo(0,0):s.arc(0,0,i,r,a,!e.clockwise),s.closePath(),s.currentPath.lineWidth=0,s.currentPath.strokeStyle=null,s.currentPath.lineAlpha=0,s.currentPath.line=!1),e.lineWidth&&e.strokeStyle&&e.lineAlpha&&(s.beginPath(),s.arc(0,0,n,a,r,e.clockwise),s.closePath(),s.currentPath.fillStyle=null,s.currentPath.fill=!1,s.beginPath(),s.arc(0,0,i,r,a,!e.clockwise),s.closePath(),s.currentPath.fillStyle=null,s.currentPath.fill=!1)):(s.beginPath(),s.arc(0,0,n,a,r,e.clockwise),0==e.r0?s.lineTo(0,0):s.arc(0,0,i,r,a,!e.clockwise),s.closePath())}}},we.AnimationFrame=Rt,we.utils=St;var Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ae=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},ke=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Ce=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t},Te=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Pe=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};R.Canvax=we;var Le=function(t){function i(t,e,n,a){Ae(this,i);var r=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return r.componentModules=a,r._node=t,r._data=e,r._opt=n,r.dataFrame=r.initData(e,n),r.el=I.query(t),r.width=parseInt(r.el.offsetWidth),r.height=parseInt(r.el.offsetHeight),r.padding=null,r.canvax=new we.App({el:r.el,webGL:!1}),r.canvax.registEvent(),r.id="chartx_"+r.canvax.id,r.el.setAttribute("chart_id",r.id),r.el.setAttribute("chartx_version","2.0"),r.stage=new we.Display.Stage({id:"main-chart-stage"}),r.canvax.addChild(r.stage),r.setCoord_Graphs_Sp(),r.__highModules=["theme","coord","graphs"],r.components=[],r.inited=!1,r.init(),r}return Te(i,B),ke(i,[{key:"init",value:function(){var t=this,i=this._opt;for(var n in this.padding=this._getPadding(),e.each(this.__highModules,function(n){if(i[n]){var a=e.flatten([i[n]]);e.each(a,function(e){if(("coord"!=n||e.type)&&("graphs"!=n||e.field||e.keyField)){var i=t.componentModules.get(n,e.type);if(i){var a=new i(e,t);t.components.push(a)}}})}}),this._opt)if(-1==e.indexOf(this.__highModules,n)){var a=this._opt[n];e.isArray(a)||(a=[a]),e.each(a,function(e){var i=t.componentModules.get(n,e.type);if(i){var a=new i(e,t);t.components.push(a)}})}}},{key:"draw",value:function(t){var i=this;!t&&(t={});var n=this.getComponent({name:"coord"});n&&n.horizontal&&this._drawBeginHorizontal();var a=this.width-this.padding.left-this.padding.right,r=this.height-this.padding.top-this.padding.bottom,s={x:this.padding.left,y:this.padding.top};if(n&&(n.draw(t),a=n.width,r=n.height,s=n.origin),0!=this.dataFrame.length){var o=this.getComponents({name:"graphs"}),l=o.length,h=0;t=e.extend(t,{width:a,height:r,origin:s}),e.each(o,function(e){e.on("complete",function(t){++h==l&&i.fire("complete"),e.inited=!0}),e.draw(t)});for(var d=0,u=this.components.length;d<u;d++){var c=this.components[d];-1==e.indexOf(this.__highModules,c.name)&&c.draw()}this._bindEvent(),n&&n.horizontal&&this._drawEndHorizontal()}else i.fire("complete")}},{key:"_drawBeginHorizontal",value:function(){var t=this.padding,e=t.top;t.top=t.right,t.right=t.bottom,t.bottom=t.left,t.left=e}},{key:"_drawEndHorizontal",value:function(){var t=this.graphsSprite.context;t.x+=(this.width-this.height)/2,t.y+=(this.height-this.width)/2,t.rotation=90,t.rotateOrigin={x:this.height/2,y:this.width/2},this._horizontalGraphsText()}},{key:"_horizontalGraphsText",value:function(){e.each(this.getComponents({name:"graphs"}),function(t){!function t(i){if(i.children&&e.each(i.children,function(e){t(e)}),"text"==i.type&&!i.__horizontal){var n=i.context;n.width,n.height,n.rotation=n.rotation-90,i.__horizontal=!0}}(t.sprite)})}},{key:"_getPadding",value:function(){var t=20;this._opt.coord&&"padding"in this._opt.coord&&(e.isObject(this._opt.coord.padding)||(t=this._opt.coord.padding));var i={top:t,right:t,bottom:t,left:t};return this._opt.coord&&"padding"in this._opt.coord&&e.isObject(this._opt.coord.padding)&&(i=e.extend(i,this._opt.coord.padding)),i}},{key:"getTheme",value:function(t){var e=R.getGlobalTheme(),i=this.getComponent({name:"theme"});return i&&(e=i.get()),void 0!=t?e[t%e.length]||"#ccc":e}},{key:"setCoord_Graphs_Sp",value:function(){this.coordSprite=new we.Display.Sprite({id:"coordSprite"}),this.stage.addChild(this.coordSprite),this.graphsSprite=new we.Display.Sprite({id:"graphsSprite"}),this.stage.addChild(this.graphsSprite)}},{key:"destroy",value:function(){this.clean(),this.el&&(this.el.removeAttribute("chart_id"),this.el.removeAttribute("chartx_version"),this.canvax.destroy(),this.el=null),this._destroy&&this._destroy(),this.fire("destroy")}},{key:"clean",value:function(){for(var t=0,e=this.canvax.children.length;t<e;t++)for(var i=this.canvax.getChildAt(t),n=0,a=i.children.length;n<a;n++)i.getChildAt(n).destroy(),n--,a--;this.setCoord_Graphs_Sp(),this.components=[],this.canvax.domView.innerHTML=""}},{key:"resize",value:function(){var t=parseInt(this.el.offsetWidth),e=parseInt(this.el.offsetHeight);t==this.width&&e==this.height||(this.width=t,this.height=e,this.canvax.resize(),this.inited=!1,this.clean(),this.init(),this.draw({resize:!0}),this.inited=!0)}},{key:"reset",value:function(t,i){!t&&(t={}),e.extend(!0,this._opt,t),i&&(this._data=i),this.dataFrame=this.initData(this._data,t),this.clean(),this.init(),this.draw()}},{key:"resetData",value:function(t,i){var n=this,a=this.dataFrame.length;if(t&&(this._data=t,this.dataFrame=this.initData(this._data)),!a)return this.clean(),this.init(),void this.draw(this._opt);var r=this.getComponent({name:"coord"});r&&r.resetData(this.dataFrame,i),e.each(this.getComponents({name:"graphs"}),function(t){t.resetData(n.dataFrame,i)}),this.componentsReset(i),r&&r.horizontal&&this._horizontalGraphsText(),this.fire("resetData")}},{key:"initData",value:function(){return D.apply(this,arguments)}},{key:"componentsReset",value:function(t){var i=this;e.each(this.components,function(n,a){-1==e.indexOf(i.__highModules,n.name)&&(t&&t.comp&&t.comp.__cid==n.__cid||n.reset&&n.reset(i[n.type]||{},i.dataFrame))})}},{key:"getComponentById",value:function(t){var i;return e.each(this.components,function(e){if(e.id&&e.id==t)return i=e,!1}),i}},{key:"getComponent",value:function(t){return this.getComponents(t)[0]}},{key:"getComponents",value:function(t,i){var n=[],a=0;for(var r in t)a++;return a?(i||(i=this.components),e.each(i,function(e){var i=0;for(var r in t)JSON.stringify(e[r])==JSON.stringify(t[r])&&i++;a==i&&n.push(e)}),n):n}},{key:"getGraph",value:function(t){return this.getGraphs(t)[0]}},{key:"getGraphs",value:function(t){return this.getComponents(t,this.getComponents({name:"graphs"}))}},{key:"getGraphById",value:function(t){var i;return e.each(this.getComponents({name:"graphs"}),function(e){if(e.id==t)return i=e,!1}),i}},{key:"getCoord",value:function(t){return this.getComponent(e.extend(!0,{name:"coord"},t))}},{key:"getLegendData",value:function(){var t=this,i=[];if(e.each(this.getComponents({name:"graphs"}),function(t){e.each(t.getLegendData(),function(t){if(!e.find(i,function(e){return e.name==t.name})){var n=e.extend(!0,{},t);n.color=t.fillStyle||t.color||t.style,i.push(n)}})}),i.length)return i;var n=t.getComponent({name:"coord"});return e.each(e.flatten(n.fieldsMap),function(n,a){var r=!1;e.each(t._opt.graphs,function(t){if(e.indexOf(e.flatten([t.field]),n.field)>-1)return r=!0,!1}),r&&i.push({enabled:n.enabled,name:n.field,field:n.field,ind:n.ind,color:n.color,yAxis:n.yAxis})}),i}},{key:"show",value:function(t,i){var n=this.getComponent({name:"coord"});n&&n.show(t,i),e.each(this.getComponents({name:"graphs"}),function(e){e.show(t,i)}),this.componentsReset(i)}},{key:"hide",value:function(t,i){var n=this.getComponent({name:"coord"});n&&n.hide(t,i),e.each(this.getComponents({name:"graphs"}),function(e){e.hide(t,i)}),this.componentsReset(i)}},{key:"_bindEvent",value:function(){var t=this;this.on("panstart mouseover",function(e){var i=t.getComponent({name:"tips"});i&&(t._setTipsInfo.apply(t,[e]),i.show(e),t._tipsPointerAtAllGraphs(e))}),this.on("panmove mousemove",function(e){var i=t.getComponent({name:"tips"});i&&(t._setTipsInfo.apply(t,[e]),i.move(e),t._tipsPointerAtAllGraphs(e))}),this.on("panend mouseout",function(e){var i=t.getComponent({name:"tips"}),n=t.getComponent({name:"coord"});!i||e.toTarget&&n&&n.induce&&n.induce.containsPoint(n.induce.globalToLocal(e.target.localToGlobal(e.point)))||(i.hide(e),t._tipsPointerHideAtAllGraphs(e))}),this.on("tap",function(e){var i=t.getComponent({name:"tips"});i&&(i.hide(e),t._setTipsInfo.apply(t,[e]),i.show(e),t._tipsPointerAtAllGraphs(e))})}},{key:"_setTipsInfo",value:function(t){t.eventInfo||(t.eventInfo={});var i=this.getComponent({name:"coord"});if(i&&(t.eventInfo=i.getTipsInfoHandler(t)),!t.eventInfo.nodes||!t.eventInfo.nodes.length){var n=[],a=t.eventInfo.iNode;e.each(this.getComponents({name:"graphs"}),function(t){n=n.concat(t.getNodesAt(a))}),t.eventInfo.nodes=n}}},{key:"_tipsPointerAtAllGraphs",value:function(t){e.each(this.getComponents({name:"graphs"}),function(e){e.tipsPointerOf(t)})}},{key:"_tipsPointerHideAtAllGraphs",value:function(t){e.each(this.getComponents({name:"graphs"}),function(e){e.tipsPointerHideOf(t)})}}]),i}(),De=function(t){function e(t,i){Ae(this,e);var n=Pe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return n.name="component",n.type=null,n.enabled=!1,n._opt=t,n.app=i,n.width=0,n.height=0,n.pos={x:0,y:0},n.margin={top:0,right:0,bottom:0,left:0},n.__cid=we.utils.createId("comp_"),n}return Te(e,B),ke(e,[{key:"init",value:function(t,e){}},{key:"draw",value:function(){}},{key:"destroy",value:function(){}},{key:"reset",value:function(){}},{key:"setPosition",value:function(t){!t&&(t=this.pos),t.x&&(this.sprite.context.x=t.x),t.y&&(this.sprite.context.y=t.y)}},{key:"layout",value:function(){}}]),e}(),Me=function(t){function i(t,e){Ae(this,i);var n=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e));return n.name="coord",n._opt=t,n.app=e,n.dataFrame=n.app.dataFrame,n.width=0,n.height=0,n.origin={x:0,y:0},n.sprite=new we.Display.Sprite({name:"coord_"+t.type}),n.app.coordSprite.addChild(n.sprite),n.fieldsMap=null,n.induce=null,n._axiss=[],n}return Te(i,De),ke(i,[{key:"setFieldsMap",value:function(t){var i=this,n=0,a=t.type||"yAxis",r=[];return e.each(this.getAxiss(t),function(t){t.field&&(r=r.concat(t.field))}),function t(r){e.isString(r)&&(r=[r]);for(var s=e.clone(r),o=0,l=r.length;o<l;o++)e.isString(r[o])&&(s[o]={field:r[o],enabled:!0,color:i.app.getTheme(n),ind:n++},s[o][a]=i.getAxis({type:a,field:r[o]})),e.isArray(r[o])&&(s[o]=t(r[o]));return s}(r)}},{key:"setFieldEnabled",value:function(t){!function i(n){e.each(n,function(n,a){e.isArray(n)?i(n):n.field&&n.field==t&&(n.enabled=!n.enabled)})}(this.fieldsMap)}},{key:"getFieldMapOf",value:function(t){var i=null;return function n(a){e.each(a,function(a,r){if(e.isArray(a))n(a);else if(a.field&&a.field==t)return i=a,!1})}(this.fieldsMap),i}},{key:"getEnabledFieldsOf",value:function(t){var i=[],n=t?t.type:"yAxis";return e.each(this.fieldsMap,function(a,r){if(e.isArray(a)){var s=[];e.each(a,function(e,i){e[n]===t&&e.field&&e.enabled&&s.push(e.field)}),s.length&&i.push(s)}else a[n]===t&&a.field&&a.enabled&&i.push(a.field)}),i}},{key:"filterEnabledFields",value:function(t){var i=this,n=[];return e.isArray(t)||(t=[t]),e.each(t,function(t){if(e.isArray(t)){var a=[];e.each(t,function(t){i.getFieldMapOf(t).enabled&&a.push(t)}),a.length&&n.push(a)}else i.getFieldMapOf(t).enabled&&n.push(t)}),n}},{key:"getAxisDataFrame",value:function(t){return{field:t,org:this.dataFrame.getDataOrg(t,function(t){return void 0===t||null===t||""==t?t:isNaN(Number(t))?t:Number(t)})}}},{key:"hide",value:function(t){this.changeFieldEnabled(t)}},{key:"show",value:function(t){this.changeFieldEnabled(t)}},{key:"getSizeAndOrigin",value:function(){return{width:this.width,height:this.height,origin:this.origin}}},{key:"getPoint",value:function(t){}},{key:"getAxisOriginPoint",value:function(t){}},{key:"getOriginPos",value:function(t){}},{key:"getAxis",value:function(t){return this.getAxiss(t)[0]}},{key:"getAxiss",value:function(t){var i=[],n=0;for(var a in t)n++;return e.each(this._axiss,function(a){var r=0;for(var s in t)if("field"==s){var o=e.flatten([a[s]]),l=e.flatten([t[s]]),h=!0;e.each(l,function(t){-1==e.indexOf(o,t)&&(h=!1)}),h&&r++}else JSON.stringify(a[s])==JSON.stringify(t[s])&&r++;n==r&&i.push(a)}),i}}]),i}();function Oe(t,e){var i=Number(t),n=e||",";if(!i)return String(t);if(i>=1e3){var a=parseInt(i/1e3);return String(t.toString().replace(a,a+n))}return String(t)}var Ie=we.Shapes.Line,Ee=function(t){function i(t,e,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e.org));return a.type="xAxis",a._opt=t,a._coord=n||{},a.width=0,a.height=0,a.title={text:"",shapeType:"text",fontColor:"#999",fontSize:12,offset:2,textAlign:"center",textBaseline:"middle",strokeStyle:null,lineHeight:0},a._title=null,a.enabled=!0,a.tickLine={enabled:1,lineWidth:1,lineLength:4,offset:2,strokeStyle:"#cccccc"},a.axisLine={position:"default",enabled:1,lineWidth:1,strokeStyle:"#cccccc"},a.label={enabled:1,fontColor:"#999",fontSize:12,rotation:0,format:null,offset:2,textAlign:"center",lineHeight:1,evade:!0},!t.isH||t.label&&void 0!==t.label.rotaion||(a.label.rotation=90),a.pos={x:0,y:0},a._formatTextSection=[],a._textElements=[],a.layoutData=[],a.sprite=null,a.filter=null,a.isH=!1,a.animation=!0,a.layoutType="rule",a.trimLayout=null,a.init(t,e),a._txts=[],a._axisLine=null,a}return Te(i,L),ke(i,[{key:"init",value:function(t,i){e.extend(!0,this,t),this._initHandle(),this.sprite=new we.Display.Sprite({id:"xAxisSprite_"+(new Date).getTime()}),this.rulesSprite=new we.Display.Sprite({id:"xRulesSprite_"+(new Date).getTime()}),this.sprite.addChild(this.rulesSprite)}},{key:"_initHandle",value:function(){var t=this;this.field=e.flatten([this.field])[0],this.setDataSection(),t._formatTextSection=[],t._textElements=[],e.each(t.dataSection,function(e,i){t._formatTextSection[i]=t._getFormatText(e,i);var n=new we.Display.Text(t._formatTextSection[i],{context:{fontSize:t.label.fontSize}});t._textElements[i]=n}),0!=this.label.rotation&&(this.label.textAlign="right"),this._getTitle(),this._setXAxisHeight()}},{key:"draw",value:function(t){t&&e.extend(!0,this,t),this.setAxisLength(this.width),this._trimXAxis(),this._widget(t),this.setX(this.pos.x),this.setY(this.pos.y)}},{key:"resetData",value:function(t){this.field=t.field,this.resetDataOrg(t.org),this._initHandle(t),this.draw()}},{key:"setX",value:function(t){this.sprite.context.x=t,this.pos.x=t}},{key:"setY",value:function(t){this.sprite.context.y=t,this.pos.y=t}},{key:"_getTitle",value:function(){this.title.text&&(this._title?this._title.resetText(this.title.text):this._title=new we.Display.Text(this.title.text,{context:{fontSize:this.title.fontSize,textAlign:this.title.textAlign,textBaseline:this.title.textBaseline,fillStyle:this.title.fontColor,strokeStyle:this.title.strokeStyle,lineWidth:this.title.lineWidth,rotation:this.isH?-180:0}}))}},{key:"_setXAxisHeight",value:function(){var t=this;if(t.enabled){var i=0;this.label.enabled&&e.each(t.dataSection,function(e,n){var a=t._textElements[n],r=a.getTextWidth(),s=a.getTextHeight();if(t.label.rotation)if(90==t.label.rotation)s=r;else{var o=Math.sin(Math.abs(t.label.rotation)*Math.PI/180);Math.cos(Math.abs(t.label.rotation)*Math.PI/180);s=parseInt(o*r)}i=Math.max(i,s)}),this.height=i+this.tickLine.lineLength+this.tickLine.offset+this.label.offset,this._title&&(this.height+=this._title.getTextHeight())}else t.height=0}},{key:"getNodeInfoOfX",value:function(t){var e=this.getIndexOfPos(t),i=this.getValOfInd(e),n=this.getPosOf({ind:e,val:i});return{ind:e,value:i,text:this._getFormatText(i,e),x:n,field:this.field}}},{key:"_trimXAxis",value:function(){for(var t=[],e=this.dataSection,i=0,n=e.length;i<n;i++){var a=this._formatTextSection[i],r=this._textElements[i],s={ind:i,value:e[i],text:a,x:this.getPosOf({val:e[i],ind:i}),textWidth:r.getTextWidth(),field:this.field,visible:null};t.push(s)}return this.layoutData=t,this._trimLayoutData(),t}},{key:"_getFormatText",value:function(t){var i=t;return e.isFunction(this.label.format)&&(i=this.label.format.apply(this,arguments)),e.isNumber(i)&&"proportion"==this.layoutType&&(i=Oe(i)),i}},{key:"_widget",value:function(t){if(this.enabled){!t&&(t={});var i=this,n=this.layoutData;this._title&&(this._title.context.y=this.height-this._title.getTextHeight()/2,this._title.context.x=this.width/2,this.sprite.addChild(this._title));for(var a=Math.min(1e3/n.length,25),r=0,s=0,o=n.length;s<o;s++){var l="xNode"+s,h=this.rulesSprite.getChildById(l);h||(h=new we.Display.Sprite({id:l}),this.rulesSprite.addChild(h));var d=n[s],u=d.x,c=this.tickLine.lineLength+this.tickLine.offset+this.label.offset;if(this.label.enabled&&n[s].visible){var f={x:d._text_x||d.x,y:c+20,fillStyle:this.label.fontColor,fontSize:this.label.fontSize,rotation:-Math.abs(this.label.rotation),textAlign:this.label.textAlign,lineHeight:this.label.lineHeight,textBaseline:this.label.rotation?"middle":"top",globalAlpha:0};this.label.rotation&&90!=this.label.rotation&&(f.x+=5,f.y+=3),r<i._txts.length?(h._txt=i._txts[r],h._txt.resetText(d.text+""),this.animation?h._txt.animate({x:f.x},{duration:300}):h._txt.context.x=f.x):(h._txt=new we.Display.Text(d.text,{id:"xAxis_txt_"+s,context:f}),h.addChild(h._txt),i._txts.push(h._txt),this.animation&&!t.resize?h._txt.animate({globalAlpha:1,y:h._txt.context.y-20},{duration:500,easing:"Back.Out",delay:s*a,id:h._txt.id}):(h._txt.context.y=h._txt.context.y-20,h._txt.context.globalAlpha=1)),r++}if(this.tickLine.enabled)if(n[s].visible){var p={x:u,y:this.tickLine.offset,end:{x:0,y:this.tickLine.lineLength},lineWidth:this.tickLine.lineWidth,strokeStyle:this.tickLine.strokeStyle};h._line?this.animation?h._line.animate({x:p.x},{duration:300}):h._line.context.x=p.x:(h._line=new Ie({context:p}),h.addChild(h._line))}else h._line&&(h._line.destroy(),h._line=null);e.isFunction(this.filter)&&this.filter({layoutData:n,index:s,txt:h._txt,line:h._line||null})}if(i._txts.length>r)for(var g=r;g<i._txts.length;g++)i._txts.splice(g--,1)[0].destroy();if(this.rulesSprite.children.length>n.length){o=n.length;for(var y=this.rulesSprite.children.length;o<y;o++)this.rulesSprite.getChildAt(o).remove(),o--,y--}if(this.axisLine.enabled){var v=new Ie({context:{start:{x:0,y:0},end:{x:this.width,y:0},lineWidth:this.axisLine.lineWidth,strokeStyle:this.axisLine.strokeStyle}});this.sprite.addChild(v),this._axisLine=v}}}},{key:"_trimLayoutData",value:function(){var t=this.layoutData.length;this.enabled&&t&&("proportion"==this.layoutType&&this._checkOver(),"peak"==this.layoutType&&this._checkOver(),"rule"==this.layoutType&&this._checkOver())}},{key:"_getRootPR",value:function(){var t=0;return this._coord.app&&(t=this._coord.app.padding.right),t}},{key:"_checkOver",value:function(){var t=this,i=t.layoutData;if(t.trimLayout)t.trimLayout(i);else if(this.label.evade){var n=i.length,a=t.label.textAlign;!function e(r){var s=i[r];if(void 0!==s){s.visible=!0;for(var o=r;o<n-1;o++){var l=i[o+1],h=l.textWidth,d=s.textWidth;t.label.rotation&&(h=Math.min(h,22),d=Math.min(d,22));var u=l.x,c=s.x+d;if("center"==a&&(u=l.x-h/2,c=s.x+d/2),"right"==a&&(u=l.x-h,c=s.x),o==n-2&&("center"==a&&l.x+h/2>t.width&&(u=t.width-h,l._text_x=t.width-h/2),"left"==a&&l.x+h>t.width&&(u=t.width-h,l._text_x=t.width-h)),!(u-c<-2)){e(o+1);break}if(o==n-2)return l.visible=!0,void(s.visible=!1);l.visible=!1}}}(0)}else e.each(i,function(t){t.visible=!0})}}]),i}(),Re=we.Shapes.Line,Fe=function(t){function i(t,e,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e.org));return a.type="yAxis",a._opt=t,a.width=null,a.yMaxHeight=0,a.height=0,a.maxW=0,a.field=[],a.title={text:"",shapeType:"text",fontColor:"#999",fontSize:12,offset:2,textAlign:"center",textBaseline:"middle",strokeStyle:null,lineHeight:0},a._title=null,a.enabled=!0,a.tickLine={enabled:1,lineWidth:1,lineLength:4,strokeStyle:"#cccccc",distance:2},a.axisLine={position:"default",enabled:1,lineWidth:1,strokeStyle:"#cccccc"},a.label={enabled:1,fontColor:"#999",fontSize:12,format:null,rotation:0,distance:3,textAlign:null,lineHeight:1},!t.isH||t.label&&void 0!==t.label.rotaion||(a.label.rotation=90),a.pos={x:0,y:0},a.align="left",a.layoutData=[],a.sprite=null,a.filter=null,a.isH=!1,a.animation=!0,a.layoutType="proportion",a._axisLine=null,a.init(t,e),a}return Te(i,L),ke(i,[{key:"init",value:function(t,i){e.extend(!0,this,t),this._initHandle(),this.sprite=new we.Display.Sprite({id:"yAxisSprite_"+(new Date).getTime()}),this.rulesSprite=new we.Display.Sprite({id:"yRulesSprite_"+(new Date).getTime()}),this.sprite.addChild(this.rulesSprite)}},{key:"_initHandle",value:function(){e.isArray(this.field)||(this.field=[this.field]),this.setDataSection(),this._getTitle(),this._setYaxisWidth()}},{key:"draw",value:function(t){e.extend(!0,this,t||{}),this.height=parseInt(this.yMaxHeight-this._getYAxisDisLine()),this.setAxisLength(this.height),this.sprite.cleanAnimates(),this._trimYAxis(),this._widget(t),this.setX(this.pos.x),this.setY(this.pos.y)}},{key:"resetData",value:function(t){this.field=t.field,this.resetDataOrg(t.org),this._initHandle(),this.draw()}},{key:"setX",value:function(t){this.sprite.context.x=t,this.pos.x=t}},{key:"setY",value:function(t){this.sprite.context.y=t,this.pos.y=t}},{key:"_getTitle",value:function(){if(this.title.text)if(this._title)this._title.resetText(this.title.text);else{var t=0;"left"==this.align?t=-90:(t=90,this.isH&&(t=270)),this._title=new we.Display.Text(this.title.text,{context:{fontSize:this.title.fontSize,textAlign:this.title.textAlign,textBaseline:this.title.textBaseline,fillStyle:this.title.fontColor,strokeStyle:this.title.strokeStyle,lineWidth:this.title.lineWidth,rotation:t}})}}},{key:"_setYaxisWidth",value:function(){}},{key:"_trimYAxis",value:function(){for(var t=[],i=0,n=this.dataSection.length;i<n;i++){var a={value:this.dataSection[i],y:-Math.abs(this.getPosOf({val:this.dataSection[i],ind:i})),visible:!0,text:""},r=a.value;e.isFunction(this.label.format)&&(r=this.label.format.apply(this,[r,i])),void 0!==r&&null!==r||"proportion"!=this.layoutType||(r=Oe(a.value)),a.text=r,t.push(a)}for(var s=0,o=0,l=t.length;o<l;o++)0!=o&&(0==s?t[o].text==t[s].text?t[o].visible=!1:s=o:(t[o].text==t[s].text&&(t[s].visible=!1),s=o));this.layoutData=t}},{key:"_getYAxisDisLine",value:function(){var t=0;return t=(t=0+this.yMaxHeight%this.dataSection.length)>0?0:t}},{key:"resetWidth",value:function(t){this.width=t,"left"==this.align&&(this.rulesSprite.context.x=this.width)}},{key:"_widget",value:function(t){var i=this;if(!t&&(t={}),i.enabled){var n=this.layoutData;i.maxW=0;for(var a=0,r=n.length;a<r;a++){var s=n[a];if(s.visible){var o=s.y,l=(s.value,i.label.textAlign||("left"==i.align?"right":"left")),h=o+(0==a?-3:0)+(a==n.length-1?3:0);90!=i.label.rotation&&-90!=i.label.rotation||(l="center",a==n.length-1&&(h=o-2,l="right"),0==a&&(h=o));var d=this.rulesSprite.getChildAt(a);if(d)d._txt&&this.label.enabled&&(i.animation&&!t.resize?d._txt.animate({y:h,globalAlpha:1},{duration:500,delay:80*a,id:d._txt.id}):d._txt.context.y=h,d._txt.resetText(s.text)),d._tickLine&&this.tickLine.enabled&&(i.animation&&!t.resize?d._tickLine.animate({y:o},{duration:500,delay:80*a,id:d._tickLine.id}):d._tickLine.context.y=o);else{d=new we.Display.Sprite({id:"yNode"+a});var u=20;s.value==i.origin&&(u=0),s.value<i.origin&&(u=-20);var c=0;if(i.tickLine.enabled){c="left"==i.align?-i.tickLine.lineLength-i.tickLine.distance:i.tickLine.distance;var f=new Re({context:{x:c,y:o,end:{x:i.tickLine.lineLength,y:0},lineWidth:i.tickLine.lineWidth,strokeStyle:i._getStyle(i.tickLine.strokeStyle)}});d.addChild(f),d._tickLine=f}if(i.label.enabled){var p="left"==i.align?c-i.label.distance:c+i.tickLine.lineLength+i.label.distance;this.isH&&(p+=4*("left"==i.align?-1:1));var g=new we.Display.Text(s.text,{id:"yAxis_txt_"+i.align+"_"+a,context:{x:p,y:h+u,fillStyle:i._getStyle(i.label.fontColor),fontSize:i.label.fontSize,rotation:-Math.abs(i.label.rotation),textAlign:l,textBaseline:"middle",lineHeight:i.label.lineHeight,globalAlpha:0}});d.addChild(g),d._txt=g,90==i.label.rotation||-90==i.label.rotation?i.maxW=Math.max(i.maxW,g.getTextHeight()):i.maxW=Math.max(i.maxW,g.getTextWidth()),e.isFunction(i.filter)&&i.filter({layoutData:i.layoutData,index:a,txt:g,line:f}),i.rulesSprite.addChild(d),i.animation&&!t.resize?g.animate({globalAlpha:1,y:g.context.y-u},{duration:500,easing:"Back.Out",delay:80*(a+1),id:g.id}):(g.context.y=g.context.y-u,g.context.globalAlpha=1)}}}}if(i.rulesSprite.children.length>n.length){r=n.length;for(var y=i.rulesSprite.children.length;r<y;r++)i.rulesSprite.getChildAt(r).remove(),r--,y--}null===i.width&&(i.width=parseInt(i.maxW+i.label.distance),i.tickLine.enabled&&(i.width+=parseInt(i.tickLine.lineLength+i.tickLine.distance)),i._title&&(i.width+=i._title.getTextHeight()));var v=0;if("left"==i.align&&(i.rulesSprite.context.x=i.width,v=i.width),i.axisLine.enabled){var x=new Re({context:{start:{x:v,y:0},end:{x:v,y:-i.height},lineWidth:i.axisLine.lineWidth,strokeStyle:i._getStyle(i.axisLine.strokeStyle)}});this.sprite.addChild(x),this._axisLine=x}this._title&&(this._title.context.y=-this.height/2,this._title.context.x=this._title.getTextHeight()/2,"right"==this.align&&(this._title.context.x=this.width-this._title.getTextHeight()/2),this.sprite.addChild(this._title))}else i.width=0}},{key:"_getStyle",value:function(t){var i=t;return e.isFunction(t)&&(i=t.call(this,this)),t||(i="#999"),i}}]),i}(),We=we.Shapes.Line,Ne=we.Shapes.Rect,ze=function(t){function i(t,e){Ae(this,i);var n=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e));return n.width=0,n.height=0,n.app=e,n.pos={x:0,y:0},n.enabled=1,n.xDirection={shapeType:"line",enabled:1,data:[],lineType:"solid",lineWidth:1,strokeStyle:"#f0f0f0",filter:null},n.yDirection={shapeType:"line",enabled:0,data:[],lineType:"solid",lineWidth:1,strokeStyle:"#f0f0f0",filter:null},n.fill={enabled:!0,fillStyle:null,alpha:null},n.sprite=null,n.xAxisSp=null,n.yAxisSp=null,n.init(t),n}return Te(i,B),ke(i,[{key:"init",value:function(t){e.extend(!0,this,t),this.sprite=new we.Display.Sprite}},{key:"setX",value:function(t){this.sprite.context.x=t}},{key:"setY",value:function(t){this.sprite.context.y=t}},{key:"draw",value:function(t){e.extend(!0,this,t),this._widget(),this.setX(this.pos.x),this.setY(this.pos.y)}},{key:"clean",value:function(){this.sprite.removeAllChildren()}},{key:"reset",value:function(t){this.sprite.removeAllChildren(),this.draw(t)}},{key:"_widget",value:function(){if(this.enabled){var t=this.app._yAxis[0];if(this.fill.enabled&&this.app&&t&&t.dataSectionGroup&&t.dataSectionGroup.length>1){this.yGroupSp=new we.Display.Sprite,this.sprite.addChild(this.yGroupSp);for(var i=0,n=t.dataSectionGroup.length;i<n;i++){var a=t.height/n,r=new Ne({context:{x:0,y:-a*i,width:this.width,height:-a,fillStyle:this.fill.fillStyle||"#000",fillAlpha:this.fill.alpha||i%2*.025}});this.yGroupSp.addChild(r)}}this.xAxisSp=new we.Display.Sprite,this.sprite.addChild(this.xAxisSp),this.yAxisSp=new we.Display.Sprite,this.sprite.addChild(this.yAxisSp);for(var s=0,o=(d=this.xDirection.data).length;s<o;s++){var l=d[s],h=new We({id:"back_line_"+s,context:{y:l.y,lineType:this.xDirection.lineType,lineWidth:this.xDirection.lineWidth,strokeStyle:this.xDirection.strokeStyle}});this.xDirection.enabled&&(e.isFunction(this.xDirection.filter)&&this.xDirection.filter.apply(h,[{layoutData:this.yDirection.data,index:s,line:h},this]),this.xAxisSp.addChild(h),h.context.start.x=0,h.context.end.x=this.width)}var d;for(s=0,o=(d=this.yDirection.data).length;s<o;s++){l=d[s],h=new We({context:{x:l.x,start:{x:0,y:0},end:{x:0,y:-this.height},lineType:this.yDirection.lineType,lineWidth:this.yDirection.lineWidth,strokeStyle:this.yDirection.strokeStyle,visible:!!l.x}});this.yDirection.enabled&&(e.isFunction(this.yDirection.filter)&&this.yDirection.filter.apply(h,[{layoutData:this.xDirection.data,index:s,line:h},this]),this.yAxisSp.addChild(h))}}}}]),i}(),Ge=we.Shapes.Rect,Be=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.type="rect",a._xAxis=null,a._yAxis=[],a._yAxisLeft=null,a._yAxisRight=null,a._grid=null,a.horizontal=!1,a.xAxis={field:a.dataFrame.fields[0]},a.yAxis=[{field:a.dataFrame.fields.slice(1)}],a.grid={},e.extend(!0,a,a.setDefaultOpt(t,n)),t.horizontal&&(a.xAxis.isH=!0,e.each(a.yAxis,function(t){t.isH=!0})),"enabled"in t&&(e.extend(!0,a.xAxis,{enabled:t.enabled}),e.each(a.yAxis,function(i){e.extend(!0,i,{enabled:t.enabled})}),a.grid.enabled=t.enabled),a.init(t),a}return Te(i,Me),ke(i,[{key:"setDefaultOpt",value:function(t,i){var n={xAxis:{layoutType:"rule",posParseToInt:!1}};if(e.extend(!0,n,t),n.yAxis){var a=[];e.each(e.flatten([n.yAxis]),function(t){a.push(e.clone(t))}),n.yAxis=a}else n.yAxis=[];for(var r=e.flatten([i._opt.graphs]),s=0;s<r.length;s++){var o=r[s];if("bar"==o.type&&(n.xAxis.layoutType="peak"),o.field){var l="left";"right"==o.yAxisAlign&&(l="right");var h=null;(h=e.find(n.yAxis,function(t,e){return t.align==l||!t.align&&e==("left"==l?0:1)}))?h.align||(h.align=l):(h={align:l,field:[]},n.yAxis.push(h)),h.field?e.isArray(h.field)||(h.field=[h.field]):h.field=[],e.isArray(o.field)?h.field=h.field.concat(o.field):h.field.push(o.field)}}var d=[],u=[];return e.each(n.yAxis,function(t,e){t.align||(t.align=e?"right":"left"),"left"==t.align?d.push(t):u.push(t)}),n.yAxis=d.concat(u),n}},{key:"init",value:function(t){this._initModules(),this.fieldsMap=this.setFieldsMap({type:"yAxis"})}},{key:"resetData",value:function(t,i){var n=this;this.dataFrame=t;var a=this.getAxisDataFrame(this.xAxis.field);this._xAxis.resetData(a),e.each(this._yAxis,function(t){var e=n.getAxisDataFrame(t.field);t.resetData(e)}),this._resetXY_axisLine_pos();var r=this._yAxisLeft||this._yAxisRight;this._grid.reset({animation:!1,xDirection:{data:r.layoutData}})}},{key:"draw",value:function(t){!t&&(t={});var e=this.app.padding,i=t.height||this.app.height,n=t.width||this.app.width;if(this.horizontal){var a=n;n=i,i=a}var r=i-this._xAxis.height-e.bottom,s=0,o=0;this._yAxisLeft&&(this._yAxisLeft.draw({pos:{x:e.left,y:r},yMaxHeight:r-e.top,resize:t.resize}),s=this._yAxisLeft.width),this._yAxisRight&&(this._yAxisRight.draw({pos:{x:0,y:r},yMaxHeight:r-e.top,resize:t.resize}),o=this._yAxisRight.width),this._xAxis.draw({pos:{x:e.left+s,y:r},width:n-s-e.left-o-e.right,resize:t.resize}),this._yAxisRight&&this._yAxisRight.setX(s+e.left+this._xAxis.width),this._grid.draw({width:this._xAxis.width,height:this._yAxis[0].height,xDirection:{data:this._yAxis[0].layoutData},yDirection:{data:this._xAxis.layoutData},pos:{x:s+e.left,y:r},resize:t.resize}),this.width=this._xAxis.width,this.height=this._yAxis[0].height,this.origin.x=s+e.left,this.origin.y=r,this._initInduce(),this._resetXY_axisLine_pos(),this.horizontal&&this._horizontal({w:n,h:i})}},{key:"_resetXY_axisLine_pos",value:function(){var t,i=this;"center"==this._xAxis.axisLine.position&&(t=-this._yAxis[0].height/2),"center"==this._xAxis.axisLine.position&&(t=-this._yAxis[0].height/2),e.isNumber(this._xAxis.axisLine.position)&&(t=-this._yAxis[0].getPosOfVal(this._xAxis.axisLine.position)),void 0!==t&&(this._xAxis._axisLine.context.y=t),e.each(this._yAxis,function(t){var n;"center"==t.axisLine.position&&(n=i._xAxis.width/2),e.isNumber(t.axisLine.position)&&(n=i._xAxis.getPosOfVal(t.axisLine.position)),void 0!==n&&(t._axisLine.context.x=n)})}},{key:"getSizeAndOrigin",value:function(){var t={width:this.width,height:this.height,origin:this.origin};if(this.horizontal){var e=this.app.padding,i=e.bottom,n=e.right;t={width:this._yAxis[0].height,height:this._xAxis.width,origin:{x:this._xAxis.height+i,y:this._yAxis[0].height+n}}}return t}},{key:"_initModules",value:function(){this._grid=new ze(this.grid,this),this.sprite.addChild(this._grid.sprite);var t=this.getAxisDataFrame(this.xAxis.field);this._xAxis=new Ee(this.xAxis,t,this),this._axiss.push(this._xAxis),this.sprite.addChild(this._xAxis.sprite);var i,n,a,r,s=this.yAxis;e.isArray(s)||(s=[s]),(i=e.find(s,function(t){return"left"==t.align}))&&(a=this.getAxisDataFrame(i.field),this._yAxisLeft=new Fe(i,a),this._yAxisLeft.axis=i,this.sprite.addChild(this._yAxisLeft.sprite),this._yAxis.push(this._yAxisLeft),this._axiss.push(this._yAxisLeft)),(n=e.find(s,function(t){return"right"==t.align}))&&(r=this.getAxisDataFrame(n.field),this._yAxisRight=new Fe(n,r),this._yAxisRight.axis=n,this.sprite.addChild(this._yAxisRight.sprite),this._yAxis.push(this._yAxisRight),this._axiss.push(this._yAxisRight))}},{key:"_horizontal",value:function(t){var i=t.h,n=t.w;e.each([this.sprite.context],function(t){t.x+=(i-n)/2,t.y+=(n-i)/2;var e={x:n/2,y:i/2};t.rotation=90,t.rotateOrigin=e})}},{key:"changeFieldEnabled",value:function(t){this.setFieldEnabled(t);var e=this.getFieldMapOf(t),i=e.yAxis||e.rAxis,n=this.getEnabledFieldsOf(i);i.resetData(this.getAxisDataFrame(n)),this._resetXY_axisLine_pos(),this._grid.reset({animation:!1,xDirection:{data:this._yAxisLeft?this._yAxisLeft.layoutData:this._yAxisRight.layoutData}})}},{key:"_initInduce",value:function(){var t=this;t.induce=new Ge({id:"induce",context:{x:t.origin.x,y:t.origin.y-t.height,width:t.width,height:t.height,fillStyle:"#000000",globalAlpha:0,cursor:"pointer"}}),t.sprite.getChildById("induce")||t.sprite.addChild(t.induce),t.induce.on("panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(e){t.fire(e.type,e),t.app.fire(e.type,e)})}},{key:"getTipsInfoHandler",value:function(t){var i=t.point.x;t.target!==this.induce&&(i=this.induce.globalToLocal(t.target.localToGlobal(t.point)).x);var n=this._xAxis.getNodeInfoOfX(i),a={xAxis:n,title:n.text,iNode:n.ind,nodes:[]};return t.eventInfo&&(a=e.extend(a,t.eventInfo)).xAxis&&(t.eventInfo.xAxis=n),a}},{key:"getPoint",value:function(t){var i={x:0,y:void 0},n={type:"yAxis",field:t.field},a=this.getAxis({type:"xAxis"}),r=this.getAxis(n),s=t.iNode||0,o=t.value;"x"in o||(o.x=e.flatten(a.dataOrg)[s]),i.x=a.getPosOf({ind:s,val:o.x});var l=o.y;return isNaN(l)||null===l||void 0===l||""===l?i.y=void 0:i.y=-r.getPosOfVal(l),{pos:i,value:o}}},{key:"getAxisOriginPoint",value:function(t){var e=this.getAxis(t);return{pos:-e.originPos,value:e.origin}}},{key:"getOriginPos",value:function(t){var e={type:"yAxis",field:t.field},i=this.getAxis({type:"xAxis"}),n=this.getAxis(e);return{x:i.originPos,y:-n.originPos}}}]),i}(),He=we.Shapes.Line,je=we.Shapes.Circle,Ve=we.Shapes.Polygon,Ye=function(t){function i(t,e){Ae(this,i);var n=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e));return n.width=0,n.height=0,n.app=e,n.pos={x:0,y:0},n.enabled=!1,n.ring={shapeType:"poly",lineType:"sold",lineWidth:1,strokeStyle:"#e5e5e5",fillStyle:null,fillAlpha:.5},n.ray={enabled:!0,lineWidth:1,strokeStyle:"#e5e5e5"},n.dataSection=[],n.sprite=null,n.animation=!0,n.induce=null,n.init(t),n}return Te(i,B),ke(i,[{key:"init",value:function(t){e.extend(!0,this,t),this.sprite=new we.Display.Sprite}},{key:"setX",value:function(t){this.sprite.context.x=t}},{key:"setY",value:function(t){this.sprite.context.y=t}},{key:"draw",value:function(t){e.extend(!0,this,t),this._widget(),this.setX(this.pos.x),this.setY(this.pos.y)}},{key:"clean",value:function(){this.sprite.removeAllChildren()}},{key:"reset",value:function(t){}},{key:"_widget",value:function(){var t=this;e.each(this.dataSection,function(i,n){if(i){var a,r=t.app.getROfNum(i),s=t.app.getPointsOfR(r),o={lineWidth:t.ring.lineWidth,strokeStyle:t._getStyle(t.ring.strokeStyle,n-1),fillStyle:t._getStyle(t.ring.fillStyle,n-1),fillAlpha:t.ring.fillAlpha},l=je;"circle"==t.ring.shapeType?(o.r=r,a=new l({context:o})):(o.pointList=[],e.each(s,function(t,e){e<s.length&&o.pointList.push([t.x,t.y])}),a=new(l=Ve)({context:o})),t.sprite.addChildAt(a,0),n==t.dataSection.length-1&&(o.fillAlpha=0,o.fillStyle="#ffffff",t.induce=new l({context:o}),t.sprite.addChild(t.induce)),e.each(s,function(e){var i=new He({context:{end:e,lineWidth:t.ring.lineWidth,strokeStyle:t.ring.strokeStyle}});t.sprite.addChild(i)})}})}},{key:"_getStyle",value:function(t,i){return e.isArray(t)?t[i%t.length]:t}}]),i}(),$e=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.type="polar",a.allAngle=360,a.aAxis={field:null,layoutType:"proportion",data:[],angleList:[],beginAngle:-90,layoutData:[],enabled:t.aAxis&&t.aAxis.field,label:{enabled:!0,format:function(t){return t},fontColor:"#666"}},a.rAxis={field:[],dataSection:null,enabled:!1},a.grid={enabled:!1},a.maxR=null,a.squareRange=!0,e.extend(!0,a,a.setDefaultOpt(t,n)),a.aAxis.field||(a.grid.enabled=!1),a.init(t),a}return Te(i,Me),ke(i,[{key:"setDefaultOpt",value:function(t,i){var n={rAxis:{field:[]}};e.extend(!0,n,t),e.isArray(n.rAxis.field)||(n.rAxis.field=[n.rAxis.field]);var a=e.flatten([i._opt.graphs]),r=[];return e.each(a,function(t){if(t.field){var i=t.field;e.isArray(i)||(i=[i]),r=r.concat(i)}}),n.rAxis.field=n.rAxis.field.concat(r),n}},{key:"init",value:function(t){this._initModules(),this.fieldsMap=this.setFieldsMap({type:"rAxis"})}},{key:"_initModules",value:function(){this.grid.enabled&&(this._grid=new Ye(this.grid,this),this.sprite.addChild(this._grid.sprite)),this.aAxis.enabled&&this.grid.enabled&&(this._aAxisScaleSp=new we.Display.Sprite({id:"aAxisScaleSp"}),this.sprite.addChild(this._aAxisScaleSp)),this._axiss.push({type:"rAxis",field:this.rAxis.field})}},{key:"draw",value:function(t){!t&&(t={}),this._computeAttr(),this.rAxis.dataSection=this._getRDataSection(),this.aAxis.data=this.app.dataFrame.getFieldData(this.aAxis.field),this._setAAxisAngleList(),this.grid.enabled&&(this._grid.draw({pos:this.origin,width:this.width,height:this.height,dataSection:this.rAxis.dataSection},this),this.aAxis.enabled&&this._drawAAxis(),this._initInduce())}},{key:"resetData",value:function(t,e){}},{key:"changeFieldEnabled",value:function(t){this.setFieldEnabled(t),this.rAxis.dataSection=this._getRDataSection(),this.aAxis.data=this.app.dataFrame.getFieldData(this.aAxis.field),this.grid.enabled&&this._grid.reset({dataSection:this.rAxis.dataSection},this)}},{key:"_getRDataSection",value:function(){var t=this;if(this._opt.rAxis&&this._opt.rAxis.dataSection)return this._opt.rAxis.dataSection;var i=[];return e.each(e.flatten([t.rAxis.field]),function(e){i=i.concat(t.app.dataFrame.getFieldData(e))}),P.section(i,3)}},{key:"_computeAttr",value:function(){var t=this.app.padding,i=this.app.width,n=this.app.height;if("width"in this._opt||(this.width=i-t.left-t.right),"height"in this._opt||(this.height=n-t.top-t.bottom),this.aAxis.enabled&&(this.width-=40,this.height-=40),this.squareRange){var a=Math.min(this.width,this.height);this.width=this.height=a}"origin"in this._opt||(this.origin={x:t.left+(i-t.left-t.right)/2,y:t.top+(n-t.top-t.bottom)/2});var r,s=this.origin;if(s.x!=this.width/2||s.y!=this.height/2){var o=[s.x,this.width-s.x,s.y,this.height-s.y];r=e.max(o)}else r=Math.max(this.width/2,this.height/2);null!=this.maxR&&this.maxR<=r||(this.maxR=r)}},{key:"getRadiansAtR",value:function(t,i,n){var a=this;void 0==i&&(i=this.width),void 0==n&&(n=this.height);var r=[];if(t>this.maxR)return[];var s,o,l=this.app.padding,h={x:this.origin.x-l.left-(this.width-i)/2,y:this.origin.y-l.top-(this.height-n)/2},d=h.y;d<t&&(s=Math.sqrt(Math.pow(t,2)-Math.pow(d,2)),r=r.concat(this._filterPointsInRect([{x:-s,y:-d},{x:s,y:-d}],h,i,n)));var u=i-h.x;u<t&&(o=Math.sqrt(Math.pow(t,2)-Math.pow(u,2)),r=r.concat(this._filterPointsInRect([{x:u,y:-o},{x:u,y:o}],h,i,n)));var c=n-h.y;c<t&&(s=Math.sqrt(Math.pow(t,2)-Math.pow(c,2)),r=r.concat(this._filterPointsInRect([{x:s,y:c},{x:-s,y:c}],h,i,n)));var f=h.x;f<t&&(o=Math.sqrt(Math.pow(t,2)-Math.pow(f,2)),r=r.concat(this._filterPointsInRect([{x:-f,y:o},{x:-f,y:-o}],h,i,n)));var p=[];0==r.length?p.push([{point:{x:t,y:0},radian:0},{point:{x:t,y:0},radian:2*Math.PI}]):e.each(r,function(t,e){var i=e==r.length-1?0:e+1,n=r.slice(i,i+1)[0];p.push([{point:t,radian:a.getRadianInPoint(t)},{point:n,radian:a.getRadianInPoint(n)}])});for(var g=0,y=p.length;g<y;g++)this._checkArcInRect(p[g],t,h,i,n)||(p.splice(g,1),g--,y--);return p}},{key:"_filterPointsInRect",value:function(t,e,i,n){for(var a=0,r=t.length;a<r;a++)this._checkPointInRect(t[a],e,i,n)||(t.splice(a,1),a--,r--);return t}},{key:"_checkPointInRect",value:function(t,e,i,n){var a=t.x+e.x,r=t.y+e.y;return!(a<0||a>i||r<0||r>n)}},{key:"_checkArcInRect",value:function(t,e,i,n,a){var r=t[0],s=t[1],o=s.radian-r.radian;s.radian<r.radian&&(o=2*Math.PI+s.radian-r.radian);var l=(r.radian+o/2)%(2*Math.PI);return this._checkPointInRect(this.getPointInRadianOfR(l,e),i,n,a)}},{key:"getRadianInPoint",value:function(t){var e=2*Math.PI;return(Math.atan2(t.y,t.x)+e)%e}},{key:"getPointInRadianOfR",value:function(t,e){var i=Math.PI,n=Math.cos(t)*e;t!=i/2&&t!=3*i/2||(n=0);var a=Math.sin(t)*e;return t%i==0&&(a=0),{x:n,y:a}}},{key:"getROfNum",value:function(t){var i=e.max(this.rAxis.dataSection);return parseInt(Math.max(this.width,this.height)/2)*((t-0)/(i-0))}},{key:"getPointsOfR",value:function(t){var i=this,n=[];return e.each(i.aAxis.angleList,function(e){var a=Math.PI*e/180,r=i.getPointInRadianOfR(a,t);n.push(r)}),n}},{key:"_setAAxisAngleList",value:function(){var t=this;t.aAxis.angleList=[];var i=this.aAxis.data;if("proportion"==this.aAxis.layoutType){i=[];for(var n=0,a=this.aAxis.data.length;n<a;n++)i.push(n)}var r=this.allAngle,s=e.max(i);"proportion"==this.aAxis.layoutType&&s++,e.each(i,function(e){var i=(r*((e-0)/(s-0))+t.aAxis.beginAngle+r)%r;t.aAxis.angleList.push(i)})}},{key:"_drawAAxis",value:function(){var t=this,i=t.getROfNum(e.max(this.rAxis.dataSection)),n=t.getPointsOfR(i+3);t._aAxisScaleSp.context.x=this.origin.x,t._aAxisScaleSp.context.y=this.origin.y,e.each(this.aAxis.data,function(i,a){if(t.aAxis.label.enabled){var r=n[a],s={x:r.x,y:r.y,fillStyle:t.aAxis.label.fontColor},o=t.aAxis.label.format(i);e.extend(s,t._getTextAlignForPoint(Math.atan2(r.y,r.x))),t._aAxisScaleSp.addChild(new we.Display.Text(o,{context:s})),t.aAxis.layoutData.push(o)}})}},{key:"_getTextAlignForPoint",value:function(t){var e="center",i="bottom";return t>-Math.PI/2&&t<0&&(e="left",i="bottom"),0==t&&(e="left",i="middle"),t>0&&t<Math.PI/2&&(e="left",i="top"),t==Math.PI/2&&(e="center",i="top"),t>Math.PI/2&&t<Math.PI&&(e="right",i="top"),t!=Math.PI&&t!=-Math.PI||(e="right",i="middle"),t>-Math.PI&&t<-Math.PI/2&&(e="right",i="bottom"),{textAlign:e,textBaseline:i}}},{key:"getAxisNodeOf",value:function(t){var e=this.getAAxisIndOf(t);if(void 0!==e)return{ind:e,value:this.aAxis.data[e],text:this.aAxis.layoutData[e],angle:this.aAxis.angleList[e]}}},{key:"getAAxisIndOf",value:function(t){var i=this;if(void 0!==t.aAxisInd)return t.aAxisInd;if(i.aAxis.angleList.length){var n=t.point,a=(180*i.getRadianInPoint(n)/Math.PI-i.aAxis.beginAngle)%i.allAngle,r=(Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2)),0),s=i.aAxis.angleList.length;return e.each(i.aAxis.angleList,function(t,e){t=(t-i.aAxis.beginAngle)%i.allAngle;var n=e+1,o=(i.aAxis.angleList[n]-i.aAxis.beginAngle)%i.allAngle;if(e==s-1&&(n=0,o=i.allAngle),a>=t&&a<=o)return r=a-t<o-a?e:n,!1}),r}}},{key:"_initInduce",value:function(){var t=this;t.induce=this._grid.induce,t.induce&&t.induce.on("panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(e){t.fire(e.type,e),t.app.fire(e.type,e)})}},{key:"getTipsInfoHandler",value:function(t){var i=this.getAxisNodeOf(t),n={nodes:[]};return i&&(n.aAxis=i,n.title=i.text,n.iNode=i.ind),t.eventInfo&&(n=e.extend(n,t.eventInfo)),n}},{key:"getPoint",value:function(t){}},{key:"getSizeAndOrigin",value:function(){}}]),i}(),qe=function(t){function i(t,e){Ae(this,i);var n=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e));return n.name="graphs",n._opt=t||{},n.app=e,n.ctx=e.stage.canvas.getContext("2d"),n.dataFrame=e.dataFrame,n.data=null,n.width=0,n.height=0,n.origin={x:0,y:0},n.animation=!0,n.inited=!1,n.sprite=new we.Display.Sprite({name:"graphs_"+t.type}),n.app.graphsSprite.addChild(n.sprite),n}return Te(i,De),ke(i,[{key:"tipsPointerOf",value:function(t){}},{key:"tipsPointerHideOf",value:function(t){}},{key:"focusAt",value:function(t,e){}},{key:"unfocusAt",value:function(t,e){}},{key:"selectAt",value:function(t,e){}},{key:"unselectAt",value:function(t,e){}},{key:"getSelectedList",value:function(){return[]}},{key:"getSelectedRowList",value:function(){return[]}},{key:"hide",value:function(t){}},{key:"show",value:function(t){}},{key:"getLegendData",value:function(){}},{key:"triggerEvent",value:function(t,i){var n=t["on"+i.type];if(n&&e.isFunction(n))if(i.eventInfo&&i.eventInfo.nodes&&i.eventInfo.nodes.length)1==i.eventInfo.nodes.length?n.apply(this,[i,i.eventInfo.nodes[0]]):n.apply(this,[i,i.eventInfo.nodes]);else{var a=[];e.each(arguments,function(t,e){e&&a.push(t)}),n.apply(this,a)}}}]),i}(),Xe=we.AnimationFrame,Ue=(we.Shapes.BrokenLine,we.Shapes.Rect),Ze=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.type="bar",a.field=null,a.enabledField=null,a.yAxisAlign="left",a.absolute=!1,a.proportion=!1,a.node={shapeType:"rect",width:0,_width:0,maxWidth:50,minWidth:1,minHeight:0,radius:3,fillStyle:null,fillAlpha:.95,_count:0,xDis:null,filter:null},a.label={enabled:!1,animation:!0,fontColor:null,fontSize:12,format:null,lineWidth:0,strokeStyle:null,rotation:0,align:"center",verticalAlign:"bottom",position:"top",offsetX:0,offsetY:0},a.select={enabled:!1,alpha:.2,fillStyle:null,_fillStyle:"#092848",triggerEventType:"click",width:1,inds:[]},a._barsLen=0,a.txtsSp=null,e.extend(!0,a,t),a.init(),a}return Te(i,qe),ke(i,[{key:"init",value:function(){this.barsSp=new we.Display.Sprite({id:"barsSp"}),this.txtsSp=new we.Display.Sprite({id:"txtsSp",context:{}})}},{key:"getNodesAt",value:function(t){var i=this.data,n=[];return e.each(this.enabledField,function(a,r){if(e.isArray(a))e.each(a,function(e,a){var r=i[e]?i[e][t]:null;r&&n.push(r)});else{var s=i[a]?i[a][t]:null;s&&n.push(s)}}),n}},{key:"_getTargetField",value:function(t,i,n,a){if(e.isString(a))return a;if(e.isArray(a)){var r=a[t];if(e.isString(r))return r;if(e.isArray(r))return r[i]}}},{key:"_getColor",value:function(t,i,n){i.value;var a,r=i.field,s=this.app.getComponent({name:"coord"}).getFieldMapOf(r);if(e.isString(t)&&(a=t),e.isArray(t)&&(a=e.flatten(t)[e.indexOf(n,r)]),e.isFunction(t)&&(a=t.apply(this,[i])),t&&t.lineargradient){var o=this.ctx.createLinearGradient(i.x,i.fromY+i.rectHeight,i.x,i.fromY);e.each(t.lineargradient,function(t,e){o.addColorStop(t.position,t.color)}),a=o}return void 0!==a&&null!==a||(a=s.color),a}},{key:"_getBarWidth",value:function(t,i){return this.node.width?e.isFunction(this.node.width)?this.node._width=this.node.width(t):this.node._width=this.node.width:(this.node._width=i-Math.max(1,.2*i),1==this.node._width&&t>3&&(this.node._width=t-2)),this.node._width<1&&(this.node._width=1),this.node._width=parseInt(this.node._width),this.node._width>this.node.maxWidth&&(this.node._width=this.node.maxWidth),this.node._width}},{key:"show",value:function(t){this.draw()}},{key:"hide",value:function(t){e.each(this.barsSp.children,function(e,i){var n=e.getChildById("bar_"+i+"_"+t);n&&n.destroy()}),e.each(this.txtsSp.children,function(e,i){var n=e.getChildById("text_"+i+"_"+t);n&&n.destroy()}),this.draw()}},{key:"resetData",value:function(t,e){this.dataFrame=t,this.draw()}},{key:"clean",value:function(){this.data={},this.barsSp.removeAllChildren(),this.label.enabled&&this.txtsSp.removeAllChildren()}},{key:"draw",value:function(t){!t&&(t={}),e.extend(!0,this,t);var i=this,n=i.animation&&!t.resize;if(this.data=this._trimGraphs(),0==this.enabledField.length||0==this._dataLen)return i._preDataLen=0,void this.clean();var a=i._preDataLen,r=this.enabledField.length,s=0;i.node._count=0;var o=e.flatten([this.field]);e.each(this.enabledField,function(t,l){var h=(t=e.flatten([t])).length;if(0!=h){s=i.width/i._dataLen,i._barsLen=i._dataLen*r;for(var d=0;d<i._dataLen;d++){var u=null;if(0==l){var c;d<=a-1?u=i.barsSp.getChildById("barGroup_"+d):(u=new we.Display.Sprite({id:"barGroup_"+d}),i.barsSp.addChild(u),u.iNode=d);var f=s*i.select.width;i.select.width>1&&(f=i.select.width),d<=a-1?((c=u.getChildById("group_region_"+d)).context.width=f,c.context.x=s*d+(s-f)/2):(c=new Ue({id:"group_region_"+d,pointChkPriority:!1,hoverClone:!1,xyToInt:!1,context:{x:s*d+(s-f)/2,y:-i.height,width:f,height:i.height,fillStyle:i._getGroupRegionStyle(d),globalAlpha:e.indexOf(i.select.inds,i.dataFrame.range.start+d)>-1?i.select.alpha:0}}),u.addChild(c),c.iNode=d,c.on(z.get(),function(t){if(t.eventInfo={iNode:this.iNode},i.app.fire(t.type,t),i.select.enabled&&t.type==i.select.triggerEventType){var n=i.dataFrame.range.start+this.iNode;e.indexOf(i.select.inds,n)>-1?i.unselectAt(n):i.selectAt(n)}i.triggerEvent(i,t)}))}else u=i.barsSp.getChildById("barGroup_"+d);var p=null;0==l?d<=a-1?p=i.txtsSp.getChildById("txtGroup_"+d):(p=new we.Display.Sprite({id:"txtGroup_"+d}),i.txtsSp.addChild(p),p.iGroup=l):p=i.txtsSp.getChildById("txtGroup_"+d);for(var g=0;g<h;g++){i.node._count++;var y=i.data[t[g]][d];y.iGroup=l,y.iNode=d,y.iLay=g;var v=y.y-y.fromY;isNaN(v)?v=0:Math.abs(v)<i.node.minHeight&&(v=i.node.minHeight),y.rectHeight=v;var x=i._getColor(i.node.fillStyle,y,o);if(y.color=x,x instanceof CanvasGradient&&i.node.fillStyle.lineargradient){var _=i.node.fillStyle.lineargradient[parseInt(i.node.fillStyle.lineargradient.length/2)];_&&(y.color=_.color)}var m={x:Math.round(y.x),y:y.fromY,width:i.node._width,height:v,fillStyle:x,fillAlpha:i.node.fillAlpha,scaleY:-1};y.width=m.width;var b={x:m.x,y:y.yOriginPoint.pos,width:m.width,height:m.height,fillStyle:m.fillStyle,fillAlpha:i.node.fillAlpha,scaleY:0};if(i.node.radius&&y.isLeaf&&!i.proportion){var w=Math.min(i.node._width/2,Math.abs(v));w=Math.min(w,i.node.radius),b.radius=[w,w,0,0]}n||(delete b.scaleY,b.y=m.y);var S=null,A="bar_"+d+"_"+y.field;if(d<=a-1&&(S=u.getChildById(A)),S?S.context.fillStyle=x:((S=new Ue({id:A,context:b})).field=y.field,u.addChild(S)),S.finalPos=m,S.iGroup=l,S.iNode=d,S.iLay=g,S.nodeData=y,y.nodeElement=S,i.node.filter&&i.node.filter.apply(S,[y,i]),i.label.enabled){var k=y.value;if(e.isFunction(i.label.format)){var C=i.label.format(k,y);void 0===C&&null===C||(k=C)}if(void 0===k||null===k||""===k)continue;e.isNumber(k)&&(k=Oe(k));var T={fillStyle:i.label.fontColor||m.fillStyle,fontSize:i.label.fontSize,lineWidth:i.label.lineWidth,strokeStyle:i.label.strokeStyle||m.fillStyle,textBaseline:i.label.verticalAlign,rotation:i.label.rotation},P=i._getTextPos(m,y);T.x=P.x,T.y=P.y,T.textAlign=i._getTextAlign(m,y);var L=null,D="text_"+d+"_"+y.field;d<=a-1&&(L=p.getChildById(D)),L?(L.resetText(k),L.context.x=T.x,L.context.y=T.y):((L=new we.Display.Text(k,{id:D,context:T})).field=y.field,p.addChild(L))}}}}}),this.sprite.addChild(this.barsSp),this.label.enabled&&this.sprite.addChild(this.txtsSp),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this.grow(function(){i.fire("complete")},{delay:0,duration:300,animate:n}),i._preDataLen=i._dataLen}},{key:"setEnabledField",value:function(){this.enabledField=this.app.getComponent({name:"coord"}).filterEnabledFields(this.field)}},{key:"_getGroupRegionStyle",value:function(t){var i=this,n=i.select.fillStyle;return e.isArray(i.select.fillStyle)&&(n=i.select.fillStyle[h]),e.isFunction(i.select.fillStyle)&&(n=i.select.fillStyle.apply(this,[{iNode:t,rowData:i.dataFrame.getRowDataAt(t)}])),void 0===n||null===n?i.select._fillStyle:n}},{key:"_trimGraphs",value:function(){var t=this,i=this.app.getComponent({name:"coord"});this.setEnabledField(),this.data={};var n=[],a=0,r=0,s=!1;this.absolute?(n=[this],a=this.enabledField.length):e.each(this.app.getComponents({name:"graphs"}),function(e){e.absolute||"bar"!=e.type||(e===t&&(s=!0),s?e.setEnabledField():r+=e.enabledField.length,a+=e.enabledField.length,n.push(e))});var o=i.getAxis({type:"xAxis"}).getCellLength(),l=o/(a+1),h=this._getBarWidth(o,l),d=l-h;null!=this.node.xDis&&(d=this.node.xDis);var u=(o-h*a-d*(a-1))/2;r&&(u+=(d+h)*r);var c=this.dataFrame.getDataOrg(this.enabledField);return e.each(c,function(n,a){var r=[];e.each(n,function(s,l){r[l]=[],t._dataLen=s.length,e.each(s,function(s,c){var f=s;t.proportion&&(f=0,e.each(n,function(t,e){f+=t[c]}));var p=t._getTargetField(a,l,c,t.enabledField),g=i.getPoint({iNode:c,field:p,value:{y:s}}),y=g.pos.x,v=y-o/2+u+(h+d)*a,x=0;x=t.proportion?-s/f*i.height:g.pos.y;var _=i.getAxisOriginPoint({field:p});var m=function t(e,i,n,a,r){var s=e[i-1];if(!s)return _.pos;var o=s[n].y,l=s[n].value,h=_.value;return a>=h?l>=h?(s[n].isLeaf=!1,o):t(e,i-1,n,a,r):l<h?(s[n].isLeaf=!1,o):t(e,i-1,n,a,r)}(r,l,c,s,x);x+=m-_.pos;var b={type:"bar",value:s,vInd:l,vCount:f,field:p,fromX:v,fromY:m,x:v,y:x,width:h,yOriginPoint:_,isLeaf:!0,xAxis:i.getAxis({type:"xAxis"}).getNodeInfoOfX(y),iNode:c,rowData:t.dataFrame.getRowDataAt(c),color:null};t.data[b.field]||(t.data[b.field]=r[l]),r[l].push(b)})})}),t.data}},{key:"_getTextAlign",value:function(t,e){var i=this.label.align;return e.value<e.yOriginPoint.value&&("left"==i?i="right":"right"==i&&(i="left")),i}},{key:"_getTextPos",value:function(t,e){var i={x:0,y:0},n=t.x,a=t.y,r=!0;switch(t.y>e.y&&(r=!1),this.label.position){case"top":n=t.x+t.width/2,a=t.y+t.height,r&&(a+=16);break;case"topRight":n=t.x+t.width,a=t.y+t.height,r&&(a+=16);break;case"right":n=t.x+t.width,a=t.y+t.height/2;break;case"rightBottom":n=t.x+t.width,a=t.y;break;case"bottom":n=t.x+t.width/2,a=t.y;break;case"bottomLeft":n=t.x,a=t.y;break;case"left":n=t.x,a=t.y+t.height/2;break;case"leftTop":n=t.x,a=t.y+t.height,r&&(a+=16);break;case"center":n=t.x+t.width/2,a=t.y+t.height/2}n-=this.label.offsetX;var s=1;return e.value<e.yOriginPoint.value&&(s=-1),a-=s*this.label.offsetY,i.x=n,i.y=a,i}},{key:"grow",value:function(t,i){var n=this;if(n._preDataLen>n._dataLen)for(var a=n._dataLen,r=n._preDataLen;a<r;a++)n.barsSp.getChildAt(a).destroy(),n.label.enabled&&n.txtsSp.getChildAt(a).destroy(),a--,r--;if(i.animate){var s=e.extend({delay:Math.min(1e3/this._barsLen,80),easing:"Linear.None",duration:500},i),o=0;e.each(n.enabledField,function(i,a){var r=(i=e.flatten([i])).length;if(0!=r)for(var l=0;l<n._dataLen;l++)for(var h=0;h<r;h++){var d=n.data[i[h]][l],u=n.barsSp.getChildById("barGroup_"+l).getChildById("bar_"+l+"_"+d.field);0==s.duration?(u.context.scaleY=1,u.context.y=1*u.finalPos.y,u.context.x=u.finalPos.x,u.context.width=u.finalPos.width,u.context.height=u.finalPos.height):(u._tweenObj&&Xe.destroyTween(u._tweenObj),u._tweenObj=u.animate({scaleY:1,y:1*u.finalPos.y,x:u.finalPos.x,width:u.finalPos.width,height:u.finalPos.height},{duration:s.duration,easing:s.easing,delay:l*s.delay,onUpdate:function(t){},onComplete:function(e){e.width<3&&this.context&&(this.context.radius=0),++o===n.node._count&&t&&t(n)},id:u.id}))}})}else t&&t(n)}},{key:"selectAt",value:function(t){if(!(e.indexOf(this.select.inds,t)>-1)){this.select.inds.push(t);var i=t-this.dataFrame.range.start,n=this.barsSp.getChildById("barGroup_"+i);if(n){var a=n.getChildById("group_region_"+i);a&&(a.context.globalAlpha=this.select.alpha)}}}},{key:"unselectAt",value:function(t){if(-1!=e.indexOf(this.select.inds,t)){var i=e.indexOf(this.select.inds,t);this.select.inds.splice(i,1);var n=t-this.dataFrame.range.start,a=this.barsSp.getChildById("barGroup_"+n);if(a){var r=a.getChildById("group_region_"+n);r&&(r.context.globalAlpha=0)}}}},{key:"getSelectedRowList",value:function(){var t=[],i=this;return e.each(i.select.inds,function(e){var n=e-i.dataFrame.range.start;t.push(i.dataFrame.getRowDataAt(n))}),t}}]),i}(),Qe=we.AnimationFrame,Je=we.Shapes.BrokenLine,Ke=(we.Shapes.Rect,we.Shapes.Circle),ti=we.Shapes.Path,ei=function(t){function i(t,n,a,r,s,o){Ae(this,i);var l=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return l._opt=a,l.fieldMap=t,l.field=null,l.iGroup=n,l._yAxis=t.yAxis,l.ctx=r,l.w=o,l.h=s,l.y=0,l.line={enabled:1,shapeType:"brokenLine",strokeStyle:t.color,lineWidth:2,lineType:"solid",smooth:!0},l.node={enabled:1,shapeType:"circle",corner:!1,radius:3,fillStyle:"#ffffff",strokeStyle:null,lineWidth:2},l.label={enabled:0,fontColor:null,strokeStyle:null,fontSize:12,format:null},l.area={shapeType:"path",enabled:1,fillStyle:null,alpha:.2},l.data=[],l.sprite=null,l._pointList=[],l._currPointList=[],l._bline=null,e.extend(!0,l,a),l.field=t.field,l.init(a),l}return Te(i,B),ke(i,[{key:"init",value:function(t){this.sprite=new we.Display.Sprite;var e=this;this.sprite.on("destroy",function(){e._growTween&&Qe.destroyTween(e._growTween)})}},{key:"draw",value:function(t,i){e.extend(!0,this,t),this.data=i,this._widget(t)}},{key:"destroy",value:function(){var t=this;t.sprite.animate({globalAlpha:0},{duration:300,onComplete:function(){t.sprite.remove()}})}},{key:"_getColor",value:function(t,i){var n=this._getProp(t,i);return void 0!==n&&null!==n||(n=this._getLineStrokeStyle())&&e.isString(n)||(n=this.fieldMap.color),n}},{key:"_getProp",value:function(t,i){if(e.isArray(t))return t[this.iGroup];if(e.isFunction(t)){var n=[];return void 0!=i&&n.push(this.getNodeInfoAt(i)),t.apply(this,n)}return t}},{key:"getNodeInfoAt",value:function(t){return this.data[t]}},{key:"resetData",value:function(t,i){var n=this;t&&(this.data=t),n._pointList=this._getPointList(this.data);var a={left:0,right:n._pointList.length-n._currPointList.length};i&&e.extend(a,i.params),a.left&&(a.left>0&&(this._currPointList=this._pointList.slice(0,a.left).concat(this._currPointList)),a.left<0&&this._currPointList.splice(0,Math.abs(a.left))),a.right&&(a.right>0&&(this._currPointList=this._currPointList.concat(this._pointList.slice(-a.right))),a.right<0&&this._currPointList.splice(this._currPointList.length-Math.abs(a.right))),n._createNodes(),n._createTexts(),n._grow()}},{key:"_grow",value:function(t,i){var n=this;function a(t){n._bline.context.pointList=e.clone(t),n._bline.context.strokeStyle=n._getLineStrokeStyle(t),n._area.context.path=n._fillLine(n._bline),n._area.context.fillStyle=n._getFillStyle();var i=0;e.each(t,function(t,a){if(e.isNumber(t[1])){if(n._circles){var r=n._circles.getChildAt(i);r&&(r.context.x=t[0],r.context.y=t[1])}if(n._labels){var s=n._labels.getChildAt(i);s&&(s.context.x=t[0],s.context.y=t[1]-3,n._checkTextPos(s,a))}i++}})}n.data.length?this._growTween=Qe.registTween({from:n._getPointPosStr(n._currPointList),to:n._getPointPosStr(n._pointList),desc:n.field,onUpdate:function(t){for(var e in t){var i=parseInt(e.split("_")[2]),r=parseInt(e.split("_")[1]);n._currPointList[i]&&(n._currPointList[i][r]=t[e])}a(n._currPointList)},onComplete:function(){n._growTween=null,a(n._pointList),t&&t(n)}}):t&&t(n)}},{key:"_getPointPosStr",value:function(t){var i={};return e.each(t,function(t,e){t&&(i["p_1_"+e]=t[1],i["p_0_"+e]=t[0])}),i}},{key:"_getPointList",value:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var a=t[i];e.push([a.x,a.y])}return e}},{key:"_widget",value:function(t){var i=this;if(!t&&(t={}),i._pointList=this._getPointList(i.data),0!=i._pointList.length){var n=[];if(t.animation)for(var a=this._getFirstNode(),r=a?a.y:void 0,s=0,o=i.data.length;s<o;s++){var l=i.data[s];n.push([l.x,e.isNumber(l.y)?r:l.y])}else n=i._pointList;i._currPointList=n;var h=new Je({context:{pointList:n,lineWidth:i.line.lineWidth,y:i.y,strokeStyle:i._getLineStrokeStyle(n),smooth:i.line.smooth,lineType:i._getProp(i.line.lineType),smoothFilter:function(t){t[1]>0?t[1]=0:Math.abs(t[1])>i.h&&(t[1]=-i.h)},lineCap:"round"}});this.line.enabled||(h.context.visible=!1),i.sprite.addChild(h),i._bline=h;var d=new ti({context:{path:i._fillLine(h),fillStyle:i._getFillStyle(),globalAlpha:e.isArray(i.area.alpha)?1:i.area.alpha}});this.area.enabled||(d.context.visible=!1),i.sprite.addChild(d),i._area=d,i._createNodes(),i._createTexts()}}},{key:"_getFirstNode",value:function(){for(var t=null,i=0,n=this.data.length;i<n;i++){var a=this.data[i];if(e.isNumber(a.y)&&(null!==t&&"right"!=this._yAxis.align||(t=a),"right"!==this._yAxis.align&&null!==t))break}return t}},{key:"_getFillStyle",value:function(){var t=this,i=null,n=t._getProp(t.area.fillStyle)||t._getLineStrokeStyle(null,"fillStyle");if(e.isArray(t.area.alpha)&&!(n instanceof CanvasGradient)){t.area.alpha.length=2,void 0==t.area.alpha[0]&&(t.area.alpha[0]=0),void 0==t.area.alpha[1]&&(t.area.alpha[1]=0);var a=e.min(t._bline.context.pointList,function(t){return t[1]});if(void 0===a[0]||void 0===a[1])return null;i=t.ctx.createLinearGradient(a[0],a[1],a[0],0);var r=function(t){var e=t.toLowerCase();if(e&&F.test(e)){if(4===e.length){for(var i="#",n=1;n<4;n+=1)i+=e.slice(n,n+1).concat(e.slice(n,n+1));e=i}var a=[];for(n=1;n<7;n+=2)a.push(parseInt("0x"+e.slice(n,n+2)));return"RGB("+a.join(",")+")"}return e}(n),s=r.replace(")",", "+t._getProp(t.area.alpha[0])+")").replace("RGB","RGBA");i.addColorStop(0,s);var o=r.replace(")",", "+t.area.alpha[1]+")").replace("RGB","RGBA");i.addColorStop(1,o),n=i}return n}},{key:"_getLineStrokeStyle",value:function(t,i){var n;if(!this._opt.line||!this._opt.line.strokeStyle)return this.line.strokeStyle;if(this._opt.line.strokeStyle.lineargradient){!t&&(t=this._bline.context.pointList);var a=e.min(t,function(t){return t[1]}),r=e.max(t,function(t){return t[1]});return"fillStyle"==i&&(r=[0,0]),void 0===a[0]||void 0===a[1]||void 0===r[1]?null:(n=this.ctx.createLinearGradient(a[0],a[1],a[0],r[1]),e.each(this._opt.line.strokeStyle.lineargradient,function(t,e){n.addColorStop(t.position,t.color)}),n)}return n=this._getColor(this._opt.line.strokeStyle)}},{key:"_createNodes",value:function(){var t=this,i=t._currPointList;if((t.node.enabled||1==i.length)&&t.line.lineWidth){this._circles||(this._circles=new we.Display.Sprite({}),this.sprite.addChild(this._circles));for(var n=0,a=0,r=i.length;a<r;a++){var s=t._currPointList[a];if(s&&e.isNumber(s[1])){var o={x:s[0],y:s[1],r:t._getProp(t.node.radius,a),lineWidth:t._getProp(t.node.lineWidth,a)||2,strokeStyle:t._getColor(t.node.strokeStyle,a),fillStyle:t.node.fillStyle},l=t._circles.children[n];if(l?e.extend(l.context,o):(l=new Ke({context:o}),t._circles.addChild(l)),t.node.corner){var h=t._pointList[a][1],d=t._pointList[a-1],u=t._pointList[a+1];d&&u&&h==d[1]&&h==u[1]&&(l.context.visible=!1)}n++}}if(t._circles.children.length>n)for(var c=n,f=t._circles.children.length;c<f;c++)t._circles.children[c].destroy(),c--,f--}}},{key:"_createTexts",value:function(){var t=this,i=t._currPointList;if(t.label.enabled){this._labels||(this._labels=new we.Display.Sprite({}),this.sprite.addChild(this._labels));for(var n=0,a=0,r=i.length;a<r;a++){var s=i[a];if(s&&e.isNumber(s[1])){var o={x:s[0],y:s[1]-3,fontSize:this.label.fontSize,textAlign:"center",textBaseline:"bottom",fillStyle:t._getColor(t.label.fontColor,a),lineWidth:1,strokeStyle:"#ffffff"},l=t.data[a].value;if(e.isFunction(t.label.format)&&(l=t.label.format(l,t.data[a])||l),void 0!=l&&null!=l){var h=this._labels.children[n];h?(h.resetText(l),e.extend(h.context,o)):(h=new we.Display.Text(l,{context:o}),t._labels.addChild(h),t._checkTextPos(h,a)),n++}}}if(t._labels.children.length>n)for(var d=n,u=t._labels.children.length;d<u;d++)t._labels.children[d].destroy(),d--,u--}}},{key:"_checkTextPos",value:function(t,e){var i=this._currPointList,n=i[e-1],a=i[e+1];n&&a&&n[1]<t.context.y&&a[1]<t.context.y&&(t.context.y+=7,t.context.textBaseline="top")}},{key:"_fillLine",value:function(t){var i=e.clone(t.context.pointList),n="",a=-this._yAxis.originPos,r=null;function s(){r.push([r[r.length-1][0],a],[r[0][0],a],[r[0][0],r[0][1]]),n+=function(t){var i="",n={x:0,y:0};e.isArray(t[0])?(n.x=t[0][0],n.y=t[0][1],i="M"+t[0][0]+" "+t[0][1]):(n=t[0],i="M"+t[0].x+" "+t[0].y);for(var a=1,r=t.length;a<r;a++){var s=0,o=0,l=t[a];e.isArray(l)?(s=l[0],o=l[1]):(s=l.x,o=l.y),s==n.x&&o==n.y?i+=" z":i+=" L"+s+" "+o}return i}(r),r=null}return e.each(i,function(t,n){e.isNumber(t[1])?(null===r&&(r=[]),r.push(t)):r&&r.length&&s(),n==i.length-1&&e.isNumber(t[1])&&s()}),n}}]),i}(),ii=(we.Shapes.Rect,function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.type="line",a.yAxisAlign="left",a.field=null,a.enabledField=null,a.groups=[],e.extend(!0,a,t),a.init(a._opt),a}return Te(i,qe),ke(i,[{key:"init",value:function(t){t.yAxisAlign&&(this.yAxisAlign=t.yAxisAlign)}},{key:"draw",value:function(t){return!t&&(t={}),this.width=t.width,this.height=t.height,e.extend(!0,this.origin,t.origin),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this.data=this._trimGraphs(),this._setGroupsForYfield(this.data,null,t),this.animation&&!t.resize?this.grow():this.fire("complete"),this}},{key:"resetData",value:function(t,i){var n=this;t&&(n.dataFrame=t,n.data=n._trimGraphs()),e.each(n.groups,function(t){t.resetData(n.data[t.field].data,i)})}},{key:"setEnabledField",value:function(){this.enabledField=this.app.getComponent({name:"coord"}).filterEnabledFields(this.field)}},{key:"_trimGraphs",value:function(){var t=this,i=this.app.getComponent({name:"coord"}),n={};return t.setEnabledField(),e.each(e.flatten(t.enabledField),function(e,a){var r=t.app.getComponent({name:"coord"}).getFieldMapOf(e),s=t.dataFrame.getFieldData(e);if(s){for(var o=[],l=0,h=s.length;l<h;l++){var d=i.getPoint({iNode:l,field:e,value:{y:s[l]}}),u={type:"line",iGroup:a,iNode:l,field:e,value:s[l],x:d.pos.x,y:d.pos.y,rowData:t.dataFrame.getRowDataAt(l),color:r.color};o.push(u)}n[e]={yAxis:r.yAxis,field:e,data:o}}}),n}},{key:"grow",value:function(t){var i=0,n=this.groups.length,a=this;return e.each(this.groups,function(e,r){e._grow(function(){i++,t&&t(e),i==n&&a.fire("complete")})}),this}},{key:"show",value:function(t){var i=this;-1!=e.indexOf(e.flatten([i.field]),t)&&(this.data=this._trimGraphs(),this._setGroupsForYfield(this.data,t),e.each(this.groups,function(t,e){t.resetData(i.data[t.field].data)}))}},{key:"hide",value:function(t){var i=this,n=i.getGroupIndex(t);!this.groups.length||n<0||(this.groups.splice(n,1)[0].destroy(),this.data=this._trimGraphs(),e.each(this.groups,function(t,e){t.resetData(i.data[t.field].data)}))}},{key:"getGroupIndex",value:function(t){for(var e=-1,i=0,n=this.groups.length;i<n;i++)if(this.groups[i].field===t){e=i;break}return e}},{key:"getGroup",value:function(t){return this.groups[this.getGroupIndex(t)]}},{key:"_setGroupsForYfield",value:function(t,i,n){var a=this;!n&&(n={}),i&&(i=e.flatten([i]));var r=e.flatten([this.field]);e.each(t,function(t,s){if(!i||-1!=e.indexOf(i,s)){var o=a.app.getComponent({name:"coord"}).getFieldMapOf(s),l=e.indexOf(r,s),h=new ei(o,l,a._opt,a.ctx,a.height,a.width);h.draw({animation:a.animation&&!n.resize},t.data);for(var d=!1,u=0,c=a.groups.length;u<c;u++)if(l<a.groups[u].iGroup){a.groups.splice(u,0,h),d=!0,a.sprite.addChildAt(h.sprite,u);break}d||(a.groups.push(h),a.sprite.addChild(h.sprite))}})}},{key:"getNodesAt",value:function(t){var i=[];return e.each(this.groups,function(e){var n=e.getNodeInfoAt(t);n&&i.push(n)}),i}}]),i}()),ni=we.Shapes.Circle,ai=we.Shapes.Rect,ri=we.Shapes.Line,si=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.type="scat",a.field=null,a.groupField=null,a.node={shapeType:"circle",maxRadius:25,minRadius:5,radius:null,normalR:15,fillStyle:null,fillAlpha:.8,strokeStyle:null,lineWidth:0,lineAlpha:0,focus:{enabled:!0,lineWidth:6,lineAlpha:.2,fillAlpha:.8},select:{enabled:!0,lineWidth:8,lineAlpha:.4,fillAlpha:1}},a.line={enabled:!1,lineWidth:1,strokeStyle:"#ccc",lineType:"dashed"},a.label={enabled:!0,field:null,format:function(t,e){return t},fontSize:13,fontColor:"#888",strokeStyle:"#ffffff",lineWidth:0,align:"center",verticalAlign:"middle",position:"center",offsetX:0,offsetY:0},a.aniOrigin="default",e.extend(!0,a,t),a._rData=null,a._rMaxValue=null,a._rMinValue=null,a.init(),a}return Te(i,qe),ke(i,[{key:"init",value:function(){this._shapesp=new we.Display.Sprite({id:"shapesp"}),this._textsp=new we.Display.Sprite({id:"textsp"}),this._linesp=new we.Display.Sprite({id:"textsp"}),this.sprite.addChild(this._linesp),this.sprite.addChild(this._shapesp),this.sprite.addChild(this._textsp)}},{key:"draw",value:function(t){!t&&(t={}),e.extend(!0,this,t),this.data=this._trimGraphs(),this._widget(),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y;var i=this;return!this.animation||t.resize||i.inited?this.fire("complete"):this.grow(function(){i.fire("complete")}),this}},{key:"resetData",value:function(t,e){this.dataFrame=t,this.data=this._trimGraphs(),this._widget()}},{key:"getNodesAt",value:function(){return[]}},{key:"_trimGraphs",value:function(){var t=[],e=this.app.getComponent({name:"coord"}),i=this.dataFrame.length;this._rData=null,this._rMaxValue=null,this._rMinValue=null;for(var n=0;n<i;n++){var a=this.dataFrame.getRowDataAt(n),r=e.getFieldMapOf(this.field),s=e.getPoint({iNode:n,field:this.field,value:{y:a[this.field]}}),o={rowData:a,x:s.pos.x,y:s.pos.y,value:s.value,field:this.field,fieldColor:r.color,iNode:n,focused:!1,selected:!1,radius:null,fillStyle:null,color:null,strokeStyle:null,lineWidth:0,shapeType:null,label:null,nodeElement:null};this._setR(o),this._setFillStyle(o),this._setStrokeStyle(o),this._setLineWidth(o),this._setNodeType(o),this._setText(o),t.push(o)}return t}},{key:"_setR",value:function(t){var i=this.node.normalR,n=t.rowData;if(null!=this.node.radius){if(e.isString(this.node.radius)&&n[this.node.radius]){this._rData||this._rMaxValue||this._rMinValue||(this._rData=this.dataFrame.getFieldData(this.node.radius),this._rMaxValue=e.max(this._rData),this._rMinValue=e.min(this._rData));var a=n[this.node.radius];i=this._rMaxValue==this._rMinValue?this.node.minRadius+(this.node.maxRadius-this.node.minRadius)/2:this.node.minRadius+(a-this._rMinValue)/(this._rMaxValue-this._rMinValue)*(this.node.maxRadius-this.node.minRadius)}e.isFunction(this.node.radius)&&(i=this.node.radius(n)),isNaN(parseInt(this.node.radius))||(i=parseInt(this.node.radius))}return t.radius=i,this}},{key:"_setText",value:function(t){null!=this.label.field&&e.isString(this.label.field)&&t.rowData[this.label.field]&&(t.label=this.label.format(t.rowData[this.label.field],t))}},{key:"_setFillStyle",value:function(t){return t.color=t.fillStyle=this._getStyle(this.node.fillStyle,t),this}},{key:"_setStrokeStyle",value:function(t){return t.strokeStyle=this._getStyle(this.node.strokeStyle||this.node.fillStyle,t),this}},{key:"_getStyle",value:function(t,i){var n=t;return e.isArray(t)&&(n=t[i.iGroup]),e.isFunction(t)&&(n=t(i)),n||(n=i.fieldColor),n}},{key:"_setLineWidth",value:function(t){return t.lineWidth=this.node.lineWidth,this}},{key:"_setNodeType",value:function(t){var i=this.node.shapeType;return e.isArray(i)&&(i=i[t.iGroup]),e.isFunction(i)&&(i=i(t)),i||(i="circle"),t.shapeType=i,this}},{key:"_widget",value:function(){var t=this;if(t._shapesp.children.length>t.data.length)for(var i=t.data.length;i<t._shapesp.children.length;i++)t._shapesp.getChildAt(i--).destroy();if(t._textsp.children.length>t.data.length)for(i=t.data.length;i<t._textsp.children.length;i++)t._textsp.getChildAt(i--).destroy();if(t._linesp.children.length>t.data.length)for(i=t.data.length;i<t._linesp.children.length;i++)t._linesp.getChildAt(i--).destroy();e.each(t.data,function(i,n){var a=t._getNodeContext(i),r="circle"==i.shapeType?ni:ai,s=t._shapesp.getChildAt(n);if(s?s.animate(a):(s=new r({id:"shape_"+n,hoverClone:!1,context:a}),t._shapesp.addChild(s),s.on(z.get(),function(e){e.eventInfo={title:null,nodes:[this.nodeData]},this.nodeData.label&&(e.eventInfo.title=this.nodeData.label),t.app.fire(e.type,e),t.triggerEvent(t.node,e)})),s.nodeData=i,s.iNode=n,i.nodeElement=s,t.node.focus.enabled&&s.hover(function(e){t.focusAt(this.nodeData.iNode)},function(e){!this.nodeData.selected&&t.unfocusAt(this.nodeData.iNode)}),t.line.enabled){var o=t._linesp.getChildAt(n),l={start:{x:a.x,y:a.y+a.r},end:{x:a.x,y:0},lineWidth:t.line.lineWidth,strokeStyle:t.line.strokeStyle,lineType:t.line.lineType};o?o.animate(l):(o=new ri({context:l}),t._linesp.addChild(o)),s._line=o}if(i.label&&t.label.enabled){var h=t._textsp.getChildAt(n),d={};h?(h.resetText(i.label),d=t._getTextContext(h,a),h.animate(d)):(h=new we.Display.Text(i.label,{id:"scat_text_"+n,context:{}}),d=t._getTextContext(h,a),e.extend(h.context,d),t._textsp.addChild(h)),s.labelElement=h,h.nodeElement=s}})}},{key:"_getTextPosition",value:function(t,e){var i=0,n=0;switch(this.label.position){case"center":i=e.x,n=e.y;break;case"top":i=e.x,n=e.y-e.r;break;case"right":i=e.x+e.r,n=e.y;break;case"bottom":i=e.x,n=e.y+e.r;break;case"left":i=e.x-e.r,n=e.y;break;case"auto":i=e.x,n=e.y,t.getTextWidth()>2*e.r&&(n=e.y+e.r+.5*t.getTextHeight())}return{x:i+this.label.offsetX,y:n+this.label.offsetY}}},{key:"_getTextContext",value:function(t,e){var i=this._getTextPosition(t,e),n=this.label.fontSize;t.getTextWidth()>2*e.r&&(n-=2);var a={x:i.x,y:i.y,fillStyle:this.label.fontColor||e.fillStyle,fontSize:n,strokeStyle:this.label.strokeStyle||e.fillStyle,lineWidth:this.label.lineWidth,textAlign:this.label.align,textBaseline:this.label.verticalAlign};return this.animation&&!this.inited&&this._setCtxAniOrigin(a),a}},{key:"_setCtxAniOrigin",value:function(t){if("default"==this.aniOrigin&&(t.y=0),"origin"==this.aniOrigin){var e=this.app.getComponent({name:"coord"}).getOriginPos({field:this.field});t.x=e.x,t.y=e.y}"center"==this.aniOrigin&&(t.x=this.width/2,t.y=-this.height/2)}},{key:"_getNodeContext",value:function(t){if("circle"==t.shapeType)return this._getCircleContext(t)}},{key:"_getCircleContext",value:function(t){var e={x:t.x,y:t.y,r:t.radius,fillStyle:t.fillStyle,strokeStyle:t.strokeStyle,lineWidth:t.lineWidth,fillAlpha:this.node.fillAlpha,cursor:"pointer"};return this.animation&&!this.inited&&(this._setCtxAniOrigin(e),e.r=1),e}},{key:"grow",value:function(t){var i=0,n=this.data.length-1,a=this;e.each(this.data,function(e){e.nodeElement.animate({x:e.x,y:e.y,r:e.radius},{onUpdate:function(t){if(this.labelElement&&this.labelElement.context){var e=a._getTextPosition(this.labelElement,t);this.labelElement.context.x=e.x,this.labelElement.context.y=e.y}this._line&&this._line.context&&(this._line.context.start.y=t.y+t.r)},delay:Math.round(300*Math.random()),onComplete:function(){(i+=1)==n&&t&&t()}})})}},{key:"focusAt",value:function(t){var e=this.data[t];if(this.node.focus.enabled&&!e.focused){var i=e.nodeElement.context;i.lineWidth=this.node.focus.lineWidth,i.lineAlpha=this.node.focus.lineAlpha,i.fillAlpha=this.node.focus.fillAlpha,e.focused=!0}}},{key:"unfocusAt",value:function(t){var e=this.data[t];if(this.node.focus.enabled&&e.focused){var i=e.nodeElement.context;i.lineWidth=this.node.lineWidth,i.lineAlpha=this.node.lineAlpha,i.fillAlpha=this.node.fillAlpha,e.focused=!1}}},{key:"selectAt",value:function(t){var e=this.data[t];if(this.node.select.enabled&&!e.selected){var i=e.nodeElement.context;i.lineWidth=this.node.select.lineWidth,i.lineAlpha=this.node.select.lineAlpha,i.fillAlpha=this.node.select.fillAlpha,e.selected=!0}}},{key:"unselectAt",value:function(t){var e=this.data[t];if(this.node.select.enabled&&e.selected){var i=e.nodeElement.context;e.focused?(i.lineWidth=this.node.focus.lineWidth,i.lineAlpha=this.node.focus.lineAlpha,i.fillAlpha=this.node.focus.fillAlpha):(i.lineWidth=this.node.lineWidth,i.lineAlpha=this.node.lineAlpha,i.fillAlpha=this.node.fillAlpha),e.selected=!1}}}]),i}(),oi=we.Shapes.Sector,li=we.Shapes.Path,hi=(we.Shapes.Rect,we.AnimationFrame),di=function(t){function i(t,e){Ae(this,i);var n=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return n.width=0,n.height=0,n.origin={x:0,y:0},n._graphs=t,n.domContainer=t.app.canvax.domView,n.data=e,n.sprite=null,n.textSp=null,n.sectorsSp=null,n.selectedSp=null,n.init(),n.sectors=[],n.textMaxCount=15,n.textList=[],n.completed=!1,n}return Te(i,B),ke(i,[{key:"init",value:function(){this.sprite=new we.Display.Sprite,this.sectorsSp=new we.Display.Sprite,this.sprite.addChild(this.sectorsSp),this.selectedSp=new we.Display.Sprite,this.sprite.addChild(this.selectedSp),this._graphs.label.enabled&&(this.textSp=new we.Display.Sprite)}},{key:"draw",value:function(t){e.extend(!0,this,t),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this._widget()}},{key:"resetData",value:function(t){var e=this;this.data=t,e.destroyLabel();for(var i=0,n=0;n<e.sectors.length;n++){var a=e.sectors[n],r=this.data.list[n];a.animate({r:r.outRadius,startAngle:r.startAngle,endAngle:r.endAngle},{duration:280,onComplete:function(){++i==e.sectors.length&&e._graphs.label.enabled&&e._startWidgetLabel()}})}}},{key:"_widget",value:function(){var t=this,e=t.data.list,i=t.data.total;if(e.length>0&&i>0){t.textSp&&t.sprite.addChild(t.textSp);for(var n=0;n<e.length;n++){var a=e[n],r=new oi({hoverClone:!1,xyToInt:!1,context:{x:a.focused?a.outOffsetx:0,y:a.focused?a.outOffsety:0,r0:a.innerRadius,r:a.outRadius,startAngle:a.startAngle,endAngle:a.endAngle,fillStyle:a.fillStyle,cursor:"pointer"},id:"sector"+n});r.nodeData=a,a.focusEnabled&&r.hover(function(e){t.focusOf(this.nodeData)},function(e){!this.nodeData.selected&&t.unfocusOf(this.nodeData)}),r.on(z.get(),function(e){e.eventInfo={nodes:[this.nodeData]},t._graphs.app.fire(e.type,e),t._graphs.triggerEvent(t._graphs.node,e)}),t.sectorsSp.addChildAt(r,0),t.sectors.push(r)}t._graphs.label.enabled&&t._startWidgetLabel()}}},{key:"focusOf",value:function(t,e){if(!t.focused){this.sectors[t.iNode].animate({x:t.outOffsetx,y:t.outOffsety},{duration:100,onComplete:function(){e&&e()}}),t.focused=!0}}},{key:"unfocusOf",value:function(t,e){if(t.focused){this.sectors[t.iNode].animate({x:0,y:0},{duration:100,onComplete:function(){e&&e()}}),t.focused=!1}}},{key:"selectOf",value:function(t,e){var i=this;if(this.sectors.length&&t.selectEnabled){var n=this.sectors[t.iNode];t.selected||(t.focused?this.addCheckedSec(n):(t._focusTigger="select",this.focusOf(t,function(){i.addCheckedSec(n)})),t.selected=!0)}}},{key:"unselectOf",value:function(t,e){var i=this.sectors[t.iNode];if(t.selected&&t.selectEnabled){var n=this;n.cancelCheckedSec(i,function(){"select"==t._focusTigger&&n.unfocusOf(t)}),t.selected=!1}}},{key:"addCheckedSec",value:function(t,e){var i=t.context,n=t.nodeData;if(i){var a=new oi({xyToInt:!1,context:{x:i.x,y:i.y,r0:i.r-1,r:i.r+n.selectedR,startAngle:i.startAngle,endAngle:i.startAngle,fillStyle:i.fillStyle,globalAlpha:n.selectedAlpha},id:"selected_"+t.id});t._selectedSec=a,this.selectedSp.addChild(a),this.completed?a.animate({endAngle:i.endAngle},{duration:this._getAngleTime(i),onComplete:function(){e&&e()}}):a.context.endAngle=i.endAngle}}},{key:"cancelCheckedSec",value:function(t,e){var i=t._selectedSec;i.animate({startAngle:i.context.endAngle-.5},{duration:this._getAngleTime(t.context),onComplete:function(){delete t._selectedSec,i.destroy(),e&&e()}})}},{key:"_getAngleTime",value:function(t){return Math.abs(t.startAngle-t.endAngle)/360*500}},{key:"grow",value:function(t){var i=this;e.each(i.sectors,function(t,e){t.context&&(t.context.r0=0,t.context.r=0,t.context.startAngle=i._graphs.startAngle,t.context.endAngle=i._graphs.startAngle)}),i._hideGrowLabel(),hi.registTween({from:{process:0},to:{process:1},duration:500,onUpdate:function(t){for(var e=0;e<i.sectors.length;e++){var n=i.sectors[e],a=n.nodeData,r=n.context,s=a.startAngle,o=a.endAngle,l=a.outRadius,h=a.innerRadius;if(r){if(r.r=l*t.process,r.r0=h*t.process,0==e)r.startAngle=s,r.endAngle=s+(o-s)*t.process;else{var d=function(t){var e=t-1,n=i.sectors[e].context;return 0==e?n?n.endAngle:0:n?n.endAngle:arguments.callee(e)}(e);r.startAngle=d,r.endAngle=r.startAngle+(o-s)*t.process}n._selectedSec&&(n._selectedSec.context.r0=r.r-1,n._selectedSec.context.r=r.r+a.selectedR,n._selectedSec.context.startAngle=r.startAngle,n._selectedSec.context.endAngle=r.endAngle)}}},onComplete:function(){i._showGrowLabel(),i.completed=!0,t&&t()}})}},{key:"_widgetLabel",value:function(t,e,i,n,a,r){var s,o,l,h,d,u,c,f,p,g,y,v,x=this,_=0,m=x.data.list,b=2==t||3==t,w=3==t||4==t,S=b?i:n;e.length>0&&e.sort(function(t,e){return w?m[t].edgey-m[e].edgey:m[e].edgey-m[t].edgey});for(var A=0;A<e.length;A++){s=e[A];var k=m[s],C=k.outRadius+k.moveDis;if(!(!k.enabled||k.y<S||_>=x.textMaxCount)){_++,l=k.edgey,h=Math.abs(k.edgex),d=l-o,0!=A&&(Math.abs(d)<15||w&&d<0||!w&&d>0)&&(l=w?o+15:o-15,C-Math.abs(l)>0&&(h=Math.sqrt(Math.pow(C,2)-Math.pow(l,2))),(b&&-h>k.edgex||!b&&h<k.edgex)&&(h=Math.abs(k.edgex))),a&&(g=b?r.left:r.right,y=e.length-A,v=w?g-15*y:g+15*y,(w&&l>v||!w&&l<v)&&(l=v)),o=l,a||(b?r.left=o:r.right=o);var T=b?-h-5:h+5,P=T+x.origin.x,L=l+x.origin.y;if(P>x._graphs.app.width||L<0||L>x._graphs.app.height)return;var D="M"+k.centerx+","+k.centery;D+="Q"+k.outx+","+k.outy+","+T+","+l;var M=new li({context:{lineType:"solid",path:D,lineWidth:1,strokeStyle:k.fillStyle}}),O=k.labelText,I=document.createElement("div");switch(I.style.cssText=" ;position:absolute;left:-1000px;top:-1000px;color:"+k.fillStyle,I.innerHTML=O,x.domContainer.appendChild(I),u=I.offsetWidth,c=I.offsetHeight,f=b?-h:h,p=l,t){case 1:f+=5,p-=c/2;break;case 2:case 3:f-=u+5,p-=c/2;break;case 4:f+=5,p-=c/2}I.style.left=f+x.origin.x+"px",I.style.top=p+x.origin.y+"px",x.textSp.addChild(M),x.textList.push({width:u,height:c,x:f+x.origin.x,y:p+x.origin.y,data:k,textTxt:O,textEle:I})}}}},{key:"_startWidgetLabel",value:function(){for(var t,e,i=this,n=i.data.list,a=0,r=0,s=[],o=[{indexs:[],count:0},{indexs:[],count:0},{indexs:[],count:0},{indexs:[],count:0}],l={right:{startQuadrant:4,endQuadrant:1,clockwise:!0,indexs:[]},left:{startQuadrant:3,endQuadrant:2,clockwise:!1,indexs:[]}},h=0;h<n.length;h++){var d=n[h].quadrant;o[d-1].indexs.push(h),o[d-1].count++}o[0].count>1&&o[0].indexs.reverse(),o[2].count>1&&o[2].indexs.reverse(),o[0].count>o[3].count&&(l.right.startQuadrant=1,l.right.endQuadrant=4,l.right.clockwise=!1),o[1].count>o[2].count&&(l.left.startQuadrant=2,l.left.endQuadrant=3,l.left.clockwise=!0),l.right.indexs=o[l.right.startQuadrant-1].indexs.concat(o[l.right.endQuadrant-1].indexs),l.left.indexs=o[l.left.startQuadrant-1].indexs.concat(o[l.left.endQuadrant-1].indexs),l.right.indexs.length>i.textMaxCount&&((e=l.right.indexs.slice(0)).sort(function(t,e){return n[e].y-n[t].y}),t=e.slice(i.textMaxCount),n[t[0]].percentage,a=n[t[0]].y),l.left.indexs.length>i.textMaxCount&&((e=l.left.indexs.slice(0)).sort(function(t,e){return n[e].y-n[t].y}),t=e.slice(i.textMaxCount),n[t[0]].percentage,r=n[t[0]].y),s.push(l.right.startQuadrant),s.push(l.right.endQuadrant),s.push(l.left.startQuadrant),s.push(l.left.endQuadrant);var u={};for(h=0;h<s.length;h++){var c=1==h||3==h;i._widgetLabel(s[h],o[s[h]-1].indexs,r,a,c,u)}}},{key:"destroyLabel",value:function(){var t=this;this.textSp&&this.textSp.removeAllChildren(),e.each(this.textList,function(e){t.domContainer.removeChild(e.textEle)}),this.textList=[]}},{key:"_showGrowLabel",value:function(){this.textSp&&this.textSp.context&&(this.textSp.context.globalAlpha=1,e.each(this.textList,function(t){t.textEle.style.visibility="visible"}))}},{key:"_hideGrowLabel",value:function(){this.textSp&&this.textSp.context&&(this.textSp.context.globalAlpha=0,e.each(this.textList,function(t){t.textEle.style.visibility="hidden"}))}}]),i}(),ui=function(t){function i(t,e){Ae(this,i);var n=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e));return n.type="pie",n.field=null,n.sort=null,n.groupField=null,n.node={shapeType:"sector",radius:null,innerRadius:0,outRadius:null,minRadius:10,moveDis:15,fillStyle:null,focus:{enabled:!0},select:{enabled:!1,radius:5,alpha:.7}},n.label={field:null,enabled:!1,format:null},n.startAngle=-90,n.allAngles=360,n.init(t),n}return Te(i,qe),ke(i,[{key:"init",value:function(t){e.extend(!0,this,t),this.data=this._dataHandle()}},{key:"_computerProps",value:function(){var t=this.width,i=this.height;if(!this.node.outRadius){var n=Math.min(t,i)/2;this.label.enabled&&(n-=this.node.moveDis),this.node.outRadius=parseInt(n)}null!==this.node.radius&&e.isNumber(this.node.radius)&&(this.node.radius=Math.max(this.node.radius,this.node.minRadius),this.node.innerRadius=this.node.outRadius-this.node.radius),this.node.outRadius-this.node.innerRadius<this.node.minRadius&&(this.node.innerRadius=this.node.outRadius-this.node.minRadius),this.node.innerRadius<0&&(this.node.innerRadius=0)}},{key:"draw",value:function(t){!t&&(t={}),e.extend(!0,this,t),this._computerProps(),this._pie=new di(this,this._trimGraphs(this.data)),this._pie.draw(t);var i=this;this.animation&&!t.resize?this._pie.grow(function(){i.fire("complete")}):this.fire("complete"),this.sprite.addChild(this._pie.sprite)}},{key:"show",value:function(t){this._setEnabled(t,!0)}},{key:"hide",value:function(t){this._setEnabled(t,!1)}},{key:"_setEnabled",value:function(t,i){e.each(this.data,function(e){if(e.label===t)return e.enabled=i,!1}),this._pie.resetData(this._trimGraphs(this.data))}},{key:"_dataHandle",value:function(){for(var t=this,i=[],n=t.dataFrame,a=0,r=n.length;a<r;a++){var s=n.getRowDataAt(a),o=t.app.getTheme(a),l={rowData:s,focused:!1,focusEnabled:t.node.focus.enabled,selected:!1,selectEnabled:t.node.select.enabled,selectedR:t.node.select.radius,selectedAlpha:t.node.select.alpha,enabled:!0,fillStyle:o,color:o,value:s[t.field],label:s[t.groupField||t.label.field||t.field],labelText:null,iNode:a};if(e.isFunction(this.node.fillStyle)){var h=this.node.fontColor(l);h||(l.fillStyle=l.color=h)}i.push(l)}return i.length&&t.sort&&(i.sort(function(e,i){return"asc"==t.sort?e.value-i.value:i.value-e.value}),e.each(i,function(t,e){t.iNode=e})),i}},{key:"_trimGraphs",value:function(t){var i=this,n=0;i.currentAngle=0+i.startAngle%360;var a=i.allAngles+i.startAngle%i.allAngles,r=0,s=0;if(t.length){for(var o=0;o<t.length;o++)if(t[o].enabled&&(n+=t[o].value,i.node.radius&&e.isString(i.node.radius)&&i.node.radius in t[o].rowData)){var l=Number(t[o].rowData[i.node.radius]);r=Math.max(r,l),s=Math.min(s,l)}if(n>0)for(var h=0;h<t.length;h++){var d=t[h].value/n;t[h].enabled||(d=0);var u=+(100*d).toFixed(2),c=i.allAngles*d,f=i.currentAngle+c>a?a:i.currentAngle+c,p=Math.cos((i.currentAngle+c/2)/180*Math.PI),g=Math.sin((i.currentAngle+c/2)/180*Math.PI),y=i.currentAngle+c/2;p=p.toFixed(5),g=g.toFixed(5);var v=function(t){t>=a&&(t=a),t%=i.allAngles;var e=parseInt(t/90);if(t>=0)switch(e){case 0:return 1;case 1:return 2;case 2:return 3;case 3:case 4:return 4}else if(t<0)switch(e){case 0:return 4;case-1:return 3;case-2:return 2;case-3:case-4:return 1}}(y),x=i.node.outRadius;if(i.node.radius&&e.isString(i.node.radius)&&i.node.radius in t[h].rowData){var _=Number(t[h].rowData[i.node.radius]);x=parseInt((i.node.outRadius-i.node.innerRadius)*((_-s)/(r-s))+i.node.innerRadius)}var m=i.node.moveDis;e.extend(t[h],{outRadius:x,innerRadius:i.node.innerRadius,startAngle:i.currentAngle,endAngle:f,midAngle:y,moveDis:m,outOffsetx:.7*m*p,outOffsety:.7*m*g,centerx:x*p,centery:x*g,outx:(x+m)*p,outy:(x+m)*g,edgex:(x+m)*p,edgey:(x+m)*g,orginPercentage:d,percentage:u,quadrant:v,labelDirection:1==v||4==v?1:0,iNode:h}),t[h].labelText=i._getLabelText(t[h]),i.currentAngle+=c,i.currentAngle>a&&(i.currentAngle=a)}}return{list:t,total:n}}},{key:"_getLabelText",value:function(t){var i;if(this.label.enabled)if(this.label.format)e.isFunction(this.label.format)&&(i=this.label.format(t.label,t));else{var n=this.label.field||this.groupField;i=n?t.rowData[n]+""+t.percentage+"%":t.percentage+"%"}return i}},{key:"getList",value:function(){return this.data}},{key:"getLegendData",value:function(){var t=[];return e.each(this.data,function(e){t.push({name:e.label,color:e.fillStyle,enabled:e.enabled})}),t}},{key:"tipsPointerOf",value:function(t){}},{key:"tipsPointerHideOf",value:function(t){}},{key:"focusAt",value:function(t){var e=this._pie.data.list[t];this.node.focus.enabled&&this._pie.focusOf(e)}},{key:"unfocusAt",value:function(t){var e=this._pie.data.list[t];e.node.focus.enabled&&this._pie.unfocusOf(e)}},{key:"selectAt",value:function(t){var e=this._pie.data.list[t];this.node.select.enabled&&this._pie.selectOf(e)}},{key:"unselectAt",value:function(t){var e=this._pie.data.list[t];this.node.select.enabled&&this._pie.unselectOf(e)}}]),i}(),ci=we.Shapes.Polygon,fi=we.Shapes.Circle,pi=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.type="radar",a.field=null,a.enabledField=null,a.line={shapeType:"brokenLine",enabled:!0,lineWidth:2,strokeStyle:null},a.area={shapeType:"path",enabled:!0,fillStyle:null,fillAlpha:.1},a.node={enabled:!0,shapeType:"circle",radius:4,strokeStyle:"#ffffff",lineWidth:1},a.groups={},e.extend(!0,a,t),a.init(),a}return Te(i,qe),ke(i,[{key:"init",value:function(){}},{key:"draw",value:function(t){!t&&(t={}),e.extend(!0,this,t),this.data=this._trimGraphs(),this._widget(),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this.fire("complete")}},{key:"_widget",value:function(){var t=this,i=this.app.getComponent({name:"coord"}),n=0;e.each(this.data,function(a,r){var s={},o=[];e.each(a,function(t,e){o.push([t.point.x,t.point.y])});var l=i.getFieldMapOf(r),h=t._getStyle(t.line.strokeStyle,n,l.color,l),d={pointList:o,cursor:"pointer"};t.line.enabled&&(d.lineWidth=t.line.lineWidth,d.strokeStyle=h),t.area.enabled&&(d.fillStyle=t._getStyle(t.area.fillStyle,n,l.color,l),d.fillAlpha=t._getStyle(t.area.fillAlpha,n,1,l));var u=new ci({hoverClone:!1,context:d});if(s.area=u,t.sprite.addChild(u),u.on(z.get(),function(e){"mouseover"==e.type&&(this.context.fillAlpha+=.2),"mouseout"==e.type&&(this.context.fillAlpha-=.2),t.fire(e.type,e),t.app.fire(e.type,e)}),t.node.enabled){var c=[];e.each(a,function(e,i){o.push([e.point.x,e.point.y]);var n=new fi({context:{cursor:"pointer",x:e.point.x,y:e.point.y,r:t.node.radius,lineWidth:t.node.lineWidth,strokeStyle:t.node.strokeStyle,fillStyle:h}});t.sprite.addChild(n),n.iNode=i,n.nodeData=e,n._strokeStyle=h,n.on("panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(e){t.fire(e.type,e),e.aAxisInd=this.iNode,e.eventInfo={nodes:[this.nodeData]},t.app.fire(e.type,e)}),c.push(n)}),s.nodes=c}t.groups[r]=s,n++})}},{key:"tipsPointerOf",value:function(t){var i=this;i.tipsPointerHideOf(t),t.eventInfo&&t.eventInfo.nodes&&e.each(t.eventInfo.nodes,function(t){i.data[t.field]&&e.each(i.data[t.field],function(e,n){t.iNode==n&&i.focusOf(e)})})}},{key:"tipsPointerHideOf",value:function(t){var i=this;e.each(i.data,function(t,n){e.each(t,function(t){i.unfocusOf(t)})})}},{key:"focusOf",value:function(t){if(!t.focused){var e=this.groups[t.field].nodes[t.iNode];e.context.r+=1,e.context.fillStyle=this.node.strokeStyle,e.context.strokeStyle=e._strokeStyle,t.focused=!0}}},{key:"unfocusOf",value:function(t){if(t.focused){var e=this.groups[t.field].nodes[t.iNode];e.context.r-=1,e.context.fillStyle=e._strokeStyle,e.context.strokeStyle=this.node.strokeStyle,t.focused=!1}}},{key:"hide",value:function(t){var i=this.app.getComponent({name:"coord"});this.enabledField=i.filterEnabledFields(this.field);var n=this.groups[t];n&&(n.area.context.visible=!1,e.each(n.nodes,function(t){t.context.visible=!1}))}},{key:"show",value:function(t){var i=this.app.getComponent({name:"coord"});this.enabledField=i.filterEnabledFields(this.field);var n=this.groups[t];n&&(n.area.context.visible=!0,e.each(n.nodes,function(t){t.context.visible=!0}))}},{key:"_trimGraphs",value:function(){var t=this,i=this.app.getComponent({name:"coord"});this.enabledField=i.filterEnabledFields(this.field);var n={};return e.each(this.enabledField,function(a){var r=t.dataFrame.getFieldData(a),s=i.getFieldMapOf(a),o=[];e.each(i.aAxis.angleList,function(e,n){var l=Math.PI*e/180,h=i.getPointInRadianOfR(l,i.getROfNum(r[n]));o.push({field:a,iNode:n,rowData:t.dataFrame.getRowDataAt(n),focused:!1,value:r[n],point:h,color:s.color})}),n[a]=o}),n}},{key:"_getStyle",value:function(t,i,n,a){var r=n;return(e.isString(t)||e.isNumber(t))&&(r=t),e.isArray(t)&&(r=t[i]),e.isFunction(t)&&(r=t(i,a)),void 0!==r&&null!==r||(r=n),r}},{key:"getNodesAt",value:function(t){var i=this.data,n=[];return e.each(this.enabledField,function(a,r){if(e.isArray(a))e.each(a,function(e,a){var r=i[e][t];r&&n.push(r)});else{var s=i[a][t];s&&n.push(s)}}),n}}]),i}(),gi={value:function(){}};function yi(){for(var t,e=0,i=arguments.length,n={};e<i;++e){if(!(t=arguments[e]+"")||t in n)throw new Error("illegal type: "+t);n[t]=[]}return new vi(n)}function vi(t){this._=t}function xi(t,e){for(var i,n=0,a=t.length;n<a;++n)if((i=t[n]).name===e)return i.value}function _i(t,e,i){for(var n=0,a=t.length;n<a;++n)if(t[n].name===e){t[n]=gi,t=t.slice(0,n).concat(t.slice(n+1));break}return null!=i&&t.push({name:e,value:i}),t}vi.prototype=yi.prototype={constructor:vi,on:function(t,e){var i,n,a=this._,r=(n=a,(t+"").trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),s=-1,o=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=r[s]).type)a[i]=_i(a[i],t.name,e);else if(null==e)for(i in a)a[i]=_i(a[i],t.name,null);return this}for(;++s<o;)if((i=(t=r[s]).type)&&(i=xi(a[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new vi(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,n,a=new Array(i),r=0;r<i;++r)a[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=0,i=(n=this._[t]).length;r<i;++r)n[r].value.apply(e,a)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],a=0,r=n.length;a<r;++a)n[a].value.apply(e,i)}};var mi=Math.PI/180,bi=64,wi=2048,Si=function(){var t=[256,256],e=Ai,i=ki,n=Ti,a=Ci,r=Ci,s=Pi,o=Li,l=Ii,h=[],d=1/0,u=yi("word","end"),c=null,f=Math.random,p={},g=Ei;function y(e,i,n){t[0],t[1];for(var a,r,s,o,h,d=i.x,u=i.y,c=Math.sqrt(t[0]*t[0]+t[1]*t[1]),p=l(t),g=f()<.5?1:-1,y=-g;(a=p(y+=g))&&(r=~~a[0],s=~~a[1],!(Math.min(Math.abs(r),Math.abs(s))>=c));)if(i.x=d+r,i.y=u+s,!(i.x+i.x0<0||i.y+i.y0<0||i.x+i.x1>t[0]||i.y+i.y1>t[1]||n&&Mi(i,e,t[0])||n&&(h=n,!((o=i).x+o.x1>h[0].x&&o.x+o.x0<h[1].x&&o.y+o.y1>h[0].y&&o.y+o.y0<h[1].y)))){for(var v,x=i.sprite,_=i.width>>5,m=t[0]>>5,b=i.x-(_<<4),w=127&b,S=32-w,A=i.y1-i.y0,k=(i.y+i.y0)*m+(b>>5),C=0;C<A;C++){v=0;for(var T=0;T<=_;T++)e[k+T]|=v<<S|(T<_?(v=x[C*_+T])>>>w:0);k+=m}return delete i.sprite,!0}return!1}return p.canvas=function(t){return arguments.length?(g=Ri(t),p):g},p.start=function(){var l=function(t){t.width=t.height=1;var e=Math.sqrt(t.getContext("2d").getImageData(0,0,1,1).data.length>>2);t.width=(bi<<5)/e,t.height=wi/e;var i=t.getContext("2d");return i.fillStyle=i.strokeStyle="red",i.textAlign="center",{context:i,ratio:e}}(g()),v=function(t){var e=[],i=-1;for(;++i<t;)e[i]=0;return e}((t[0]>>5)*t[1]),x=null,_=h.length,m=-1,b=[],w=h.map(function(t,l){return t.text=e.call(this,t,l),t.font=i.call(this,t,l),t.style=a.call(this,t,l),t.weight=r.call(this,t,l),t.rotate=s.call(this,t,l),t.size=~~n.call(this,t,l),t.padding=o.call(this,t,l),t}).sort(function(t,e){return e.size-t.size});return c&&clearInterval(c),c=setInterval(S,0),S(),p;function S(){for(var e=Date.now();Date.now()-e<d&&++m<_&&c;){var i=w[m];i.x=t[0]*(f()+.5)>>1,i.y=t[1]*(f()+.5)>>1,Di(l,i,w,m),i.hasText&&y(v,i,x)&&(b.push(i),u.call("word",p,i),x?Oi(x,i):x=[{x:i.x+i.x0,y:i.y+i.y0},{x:i.x+i.x1,y:i.y+i.y1}],i.x-=t[0]>>1,i.y-=t[1]>>1)}m>=_&&(p.stop(),u.call("end",p,b,x))}},p.stop=function(){return c&&(clearInterval(c),c=null),p},p.timeInterval=function(t){return arguments.length?(d=null==t?1/0:t,p):d},p.words=function(t){return arguments.length?(h=t,p):h},p.size=function(e){return arguments.length?(t=[+e[0],+e[1]],p):t},p.font=function(t){return arguments.length?(i=Ri(t),p):i},p.fontStyle=function(t){return arguments.length?(a=Ri(t),p):a},p.fontWeight=function(t){return arguments.length?(r=Ri(t),p):r},p.rotate=function(t){return arguments.length?(s=Ri(t),p):s},p.text=function(t){return arguments.length?(e=Ri(t),p):e},p.spiral=function(t){return arguments.length?(l=Fi[t]||t,p):l},p.fontSize=function(t){return arguments.length?(n=Ri(t),p):n},p.padding=function(t){return arguments.length?(o=Ri(t),p):o},p.random=function(t){return arguments.length?(f=t,p):f},p.on=function(){var t=u.on.apply(u,arguments);return t===u?p:t},p};function Ai(t){return t.text}function ki(){return"serif"}function Ci(){return"normal"}function Ti(t){return Math.sqrt(t.value)}function Pi(){return 30*(~~(6*Math.random())-3)}function Li(){return 1}function Di(t,e,i,n){if(!e.sprite){var a=t.context,r=t.ratio;a.clearRect(0,0,(bi<<5)/r,wi/r);var s=0,o=0,l=0,h=i.length;for(--n;++n<h;){e=i[n],a.save(),a.font=e.style+" "+e.weight+" "+~~((e.size+1)/r)+"px "+e.font;var d=a.measureText(e.text+"m").width*r,u=e.size<<1;if(e.rotate){var c=Math.sin(e.rotate*mi),f=Math.cos(e.rotate*mi),p=d*f,g=d*c,y=u*f,v=u*c;d=Math.max(Math.abs(p+v),Math.abs(p-v))+31>>5<<5,u=~~Math.max(Math.abs(g+y),Math.abs(g-y))}else d=d+31>>5<<5;if(u>l&&(l=u),s+d>=bi<<5&&(s=0,o+=l,l=0),o+u>=wi)break;a.translate((s+(d>>1))/r,(o+(u>>1))/r),e.rotate&&a.rotate(e.rotate*mi),a.fillText(e.text,0,0),e.padding&&(a.lineWidth=2*e.padding,a.strokeText(e.text,0,0)),a.restore(),e.width=d,e.height=u,e.xoff=s,e.yoff=o,e.x1=d>>1,e.y1=u>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,s+=d}for(var x=a.getImageData(0,0,(bi<<5)/r,wi/r).data,_=[];--n>=0;)if((e=i[n]).hasText){for(var m=(d=e.width)>>5,b=(u=e.y1-e.y0,0);b<u*m;b++)_[b]=0;if(null==(s=e.xoff))return;o=e.yoff;for(var w=0,S=-1,A=0;A<u;A++){for(b=0;b<d;b++){var k=m*A+(b>>5),C=x[(o+A)*(bi<<5)+(s+b)<<2]?1<<31-b%32:0;_[k]|=C,w|=C}w?S=A:(e.y0++,u--,A--,o++)}e.y1=e.y0+S,e.sprite=_.slice(0,(e.y1-e.y0)*m)}}}function Mi(t,e,i){i>>=5;for(var n,a=t.sprite,r=t.width>>5,s=t.x-(r<<4),o=127&s,l=32-o,h=t.y1-t.y0,d=(t.y+t.y0)*i+(s>>5),u=0;u<h;u++){n=0;for(var c=0;c<=r;c++)if((n<<l|(c<r?(n=a[u*r+c])>>>o:0))&e[d+c])return!0;d+=i}return!1}function Oi(t,e){var i=t[0],n=t[1];e.x+e.x0<i.x&&(i.x=e.x+e.x0),e.y+e.y0<i.y&&(i.y=e.y+e.y0),e.x+e.x1>n.x&&(n.x=e.x+e.x1),e.y+e.y1>n.y&&(n.y=e.y+e.y1)}function Ii(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function Ei(){return document.createElement("canvas")}function Ri(t){return"function"==typeof t?t:function(){return t}}var Fi={archimedean:Ii,rectangular:function(t){var e=4*t[0]/t[1],i=0,n=0;return function(t){var a=t<0?-1:1;switch(Math.sqrt(1+4*a*t)-a&3){case 0:i+=e;break;case 1:n+=4;break;case 2:i-=e;break;default:n-=4}return[i,n]}}},Wi=we.Display.Text,Ni=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));a.type="cloud",a.field=null;var r=a;return a.node={fontFamily:"Impact",fontColor:function(t){return r.app.getTheme(t.iNode)},fontSize:function(){return this.minFontSize+Math.random()*this.maxFontSize},maxFontSize:30,_maxFontSizeVal:0,minFontSize:16,_minFontSizeVal:null,fontWeight:"normal",format:function(t,e){return t},padding:10,rotation:function(){return 30*(~~(6*Math.random())-3)},strokeStyle:null,focus:{enabled:!0},select:{enabled:!0,lineWidth:2,strokeStyle:"#666"}},e.extend(!0,a,t),a.init(),a}return Te(i,qe),ke(i,[{key:"init",value:function(){}},{key:"draw",value:function(t){!t&&(t={}),e.extend(!0,this,t),this._drawGraphs(),this.sprite.context.x=this.width/2,this.sprite.context.y=this.height/2,this.fire("complete")}},{key:"getDaraFrameIndOfVal",value:function(t){var i=this,n=this.dataFrame,a=e.find(n.data,function(t){return t.field==i.field});return e.indexOf(a.data,t)}},{key:"_getFontSize",value:function(t,i){var n=this.node.minFontSize;if(e.isFunction(this.node.fontSize)&&(n=this.node.fontSize(t)),e.isString(this.node.fontSize)&&this.node.fontSize in t){i=Number(t[this.node.fontSize]);isNaN(i)||(n=this.node.minFontSize+(this.node.maxFontSize-this.node.minFontSize)/(this.node._maxFontSizeVal-this.node._minFontSizeVal)*(i-this.node._minFontSizeVal))}return e.isNumber(this.node.fontSize)&&(n=this.node.fontSize),n}},{key:"_getRotate",value:function(t,i){var n=this.node.rotation;return e.isFunction(this.node.rotation)&&(n=this.node.rotation(t,i)||0),n}},{key:"_getFontColor",value:function(t){var i;return e.isString(this.node.fontColor)&&(i=this.node.fontColor),e.isFunction(this.node.fontColor)&&(i=this.node.fontColor(t)),void 0!==i&&null!==i||(i="#ccc"),i}},{key:"_drawGraphs",value:function(){var t=this;e.isString(this.node.fontSize)&&e.each(t.dataFrame.getFieldData(this.node.fontSize),function(e){t.node._maxFontSizeVal=Math.max(t.node._maxFontSizeVal,e),t.node._minFontSizeVal=Math.min(t.node._minFontSizeVal,e)}),Si().size([t.width,t.height]).words(t.dataFrame.getFieldData(t.field).map(function(e,i){var n=t.app.dataFrame.getRowDataAt(t.getDaraFrameIndOfVal(e)),a={rowData:n,field:t.field,value:e,text:null,size:t._getFontSize(n,e),iNode:i,color:null};return a.fontColor=t._getFontColor(a),a.text=t.node.format(e,a)||e,a})).padding(t.node.padding).rotate(function(e,i){return t._getRotate(e,i)}).font(t.node.fontFamily).fontSize(function(t){return t.size}).on("end",function(i,n){t.data=i,t.sprite.removeAllChildren(),e.each(i,function(e,n){e.iNode=n,e.dataLen=i.length,e.focused=!1,e.selected=!1;var a=new Wi(e.text,{context:{x:e.x,y:e.y,fontSize:e.size,fontFamily:e.font,rotation:e.rotate,textBaseline:"middle",textAlign:"center",cursor:"pointer",fontWeight:t.node.fontWeight,fillStyle:e.fontColor}});t.sprite.addChild(a),t.node.focus.enabled&&a.hover(function(e){t.focusAt(this.nodeData.iNode)},function(e){!this.nodeData.selected&&t.unfocusAt(this.nodeData.iNode)}),a.nodeData=e,e._node=a,a.on(z.get(),function(e){e.eventInfo={title:null,nodes:[this.nodeData]},this.nodeData.text&&(e.eventInfo.title=this.nodeData.text),t.app.fire(e.type,e),t.triggerEvent(t.node,e)})})}).start()}},{key:"focusAt",value:function(t){var e=this.data[t];this.node.focus.enabled&&!e.focused&&(e._node.context.fontSize+=3,e.focused=!0)}},{key:"unfocusAt",value:function(t){var e=this.data[t];this.node.focus.enabled&&e.focused&&(e._node.context.fontSize-=3,e.focused=!1)}},{key:"selectAt",value:function(t){var e=this.data[t];if(this.node.select.enabled&&!e.selected){var i=e._node.context;i.lineWidth=this.node.select.lineWidth,i.lineAlpha=this.node.select.lineAlpha,i.strokeStyle=this.node.select.strokeStyle,e.selected=!0}}},{key:"unselectAt",value:function(t){var e=this.data[t];this.node.select.enabled&&e.selected&&(e._node.context.strokeStyle=this.node.strokeStyle,e.selected=!1)}}]),i}(),zi=(we.Display.Text,we.Shapes.Circle),Gi=function(){function t(i,n,a){Ae(this,t),this._opt=i,this.dataFrame=n,this._graphs=a,this.app=a.app,this.field=null,this.iGroup=0,this.groupLen=1,this.rRange={start:0,to:0},this.width=0,this.height=0,this.node={shapeType:"circle",maxR:30,minR:5,lineWidth:1,strokeStyle:"#fff",fillStyle:"#f2fbfb",lineAlpha:.6,radius:15,focus:{enabled:!0,lineAlpha:.7,lineWidth:2,strokeStyle:"#fff"},select:{enabled:!1,lineAlpha:1,lineWidth:2,strokeStyle:"#fff",triggerEventType:"click"}},this.label={enabled:!0,fontColor:"#666",fontSize:13,align:"center",verticalAlign:"middle",position:"center",offsetX:0,offsetY:0},this.sort="desc",this.sortField=null,this.layoutType="radian",this.pit={radius:30},this.planets=[],this.maxRingNum=0,this.ringNum=0,e.extend(!0,this,i),this.node.maxR>this.pit.radius&&(this.pit.radius=this.node.maxR),this.init()}return ke(t,[{key:"init",value:function(){var t=this.app.getComponent({name:"coord"});this.sprite=new we.Display.Sprite({id:"group_"+this.iGroup,context:{x:t.origin.x,y:t.origin.y}}),this._trimGraphs(),this.draw()}},{key:"_trimGraphs",value:function(){var t=this,i=this.app.getComponent({name:"coord"});(i.maxR-this.rRange.to)/(2*this.pit.radius)<this.groupLen-1-this.iGroup&&(this.rRange.to=i.maxR-(this.groupLen-1-this.iGroup)*this.pit.radius*2),this.rRange.to-this.rRange.start<2*this.pit.radius&&(this.rRange.to=this.rRange.start+2*this.pit.radius),this.maxRingNum||(this.maxRingNum=parseInt((this.rRange.to-this.rRange.start)/(2*this.pit.radius),10),this.ringNum=this.maxRingNum),this.rRange.to=this.rRange.start+this.ringNum*this.pit.radius*2;for(var n=[],a=this.dataFrame.length,r=0;r<a;r++){var s=this.dataFrame.getRowDataAt(r),o={groupLen:this.groupLen,iGroup:t.iGroup,iNode:r,nodeElement:null,labelElement:null,rowData:s,iRing:null,iPlanet:null,fillStyle:null,color:null,strokeStyle:null,pit:null,ringInd:-1,field:t.field,label:s[t.field],focused:!1,selected:!!~e.indexOf(this.selectInds,s.__index__)};n.push(o)}t.sortField&&(n=n.sort(function(e,i){var n=t.sortField;return"desc"==t.sort?i.rowData[n]-e.rowData[n]:e.rowData[n]-i.rowData[n]}),e.each(n,function(t,e){t.iNode=e})),this._rings=this["_setRings_"+this.layoutType+"Range"](n),this.planets=n}},{key:"_setRings_radianRange",value:function(t){for(var i=this,n=[],a=this.app.getComponent({name:"coord"}),r=0,s=this.ringNum;r<s;r++){var o=r*this.pit.radius*2+this.pit.radius+this.rRange.start;i._graphs.center.enabled||(o=r*this.pit.radius*2+this.rRange.start);var l=a.getRadiansAtR(o,i.width,i.height);Math.atan(this.pit.radius/o);n.push({arcs:l,pits:[],planets:[],radius:o,max:0})}var h=0;e.each(n,function(t,n){var a=2*Math.asin(i.pit.radius/t.radius);0==t.radius&&(a=2*Math.PI);var r=0;e.each(t.arcs,function(e){var n=i._getDiffRadian(e[0].radian,e[1].radian);if(n>=a){var s=parseInt(n/a,10);r+=s;for(var o=0;o<s;o++){var l={hasRadish:!1,start:(e[0].radian+a*o+2*Math.PI)%(2*Math.PI)};l.middle=(l.start+a/2+2*Math.PI)%(2*Math.PI),l.to=(l.start+a+2*Math.PI)%(2*Math.PI),t.pits.push(l)}}}),t.max=r,h+=r,t.pits=e.shuffle(t.pits)});var d=0;return e.each(n,function(i,a){if(d>=t.length)return!1;var r=Math.ceil(i.max/h*t.length);r=Math.min(i.max,r),i.planets=t.slice(d,d+r),a==n.length-1&&(i.planets=t.slice(d)),d+=r,e.each(i.planets,function(t,n){if(!(n>=i.pits.length)){var a=e.filter(i.pits,function(t){return!t.hasRadish}),r=a[parseInt(Math.random()*a.length)];r.hasRadish=!0,t.pit=r}})}),n}},{key:"_getDiffRadian",value:function(t,e){var i=e-t;return e<t&&(i=(e+2*Math.PI-t)%(2*Math.PI)),i}},{key:"_setRings_indexRange",value:function(t){}},{key:"_setRings_valRange",value:function(t){}},{key:"draw",value:function(){var t=this,i=this.app.getComponent({name:"coord"});e.each(this._rings,function(n,a){var r={rotation:0};1==n.arcs.length&&0==n.arcs[0][0].radian&&n.arcs[0][1].radian==2*Math.PI&&(r.rotation=parseInt(360*Math.random()));var s=new we.Display.Sprite({context:r});e.each(n.planets,function(o,l){if(o.pit){var h=i.getPointInRadianOfR(o.pit.middle,n.radius),d=t._getRProp(t.node.radius,a,l,o),u=t.node.maxR-d,c=parseInt(Math.random()*u),f=parseInt(360*Math.random())*Math.PI/180;0!=c&&(h.x+=Math.sin(f)*c,h.y+=Math.cos(f)*c);var p=t.node;o.selected&&(p=t.node.select);var g=t._getProp(t.node.fillStyle,o),y=t._getProp(p.strokeStyle,o),v=t._getProp(p.lineAlpha,o),x=t._getProp(p.lineWidth,o),_={x:h.x,y:h.y,r:d,fillStyle:g,lineWidth:x,strokeStyle:y,lineAlpha:v,cursor:"pointer"};o.color=o.fillStyle=g,o.strokeStyle=y,o.iRing=a,o.iPlanet=l;var m=new zi({hoverClone:!1,context:_});m.on(z.get(),function(e){e.eventInfo={title:null,nodes:[this.nodeData]},this.nodeData.label&&(e.eventInfo.title=this.nodeData.label),t.node.focus.enabled&&("mouseover"==e.type&&t.focusAt(this.nodeData),"mouseout"==e.type&&t.unfocusAt(this.nodeData)),t.app.fire(e.type,e),t.node.select.enabled&&e.type==t.node.select.triggerEventType&&(this.nodeData.selected?t.unselectAt(this.nodeData):t.selectAt(this.nodeData)),t._graphs.triggerEvent(t.node,e)}),m.nodeData=o,o.nodeElement=m,m.ringInd=a,m.planetIndInRing=l,s.addChild(m);var b={x:h.x,y:h.y,fontSize:t.label.fontSize,textAlign:t.label.align,textBaseline:t.label.verticalAlign,fillStyle:t.label.fontColor,rotation:-r.rotation,rotateOrigin:{x:0,y:0}},w=new we.Display.Text(o.label,{context:b}),S=w.getTextWidth(),A=w.getTextHeight();if(S>2*d&&(b.fontSize=t.label.fontSize-3),e.isFunction(t.label.position)){var k=t.label.position({node:m,circleR:d,circleCenter:{x:h.x,y:h.y},textWidth:S,textHeight:A});b.rotation=-r.rotation,b.rotateOrigin={x:-(k.x-b.x),y:-(k.y-b.y)},b.x=k.x,b.y=k.y}"auto"==t.label.position&&S>2*d&&C(),"bottom"==t.label.position&&C(),b.x+=t.label.offsetX,b.y+=t.label.offsetY,w=new we.Display.Text(o.label,{context:b}),m.labelElement=w,w.nodeData=o,o.labelElement=w,s.addChild(w)}function C(){b.y=h.y+d+3,b.rotation=-r.rotation,b.rotateOrigin={x:0,y:-(d+.7*A)}}}),t.sprite.addChild(s)})}},{key:"_getRProp",value:function(t,i,n,a){var r=this;if(e.isString(t)&&e.indexOf(r.dataFrame.fields,t)>-1){void 0==this.__rValMax&&void 0==this.__rValMax&&(this.__rValMax=0,this.__rValMin=0,e.each(r.planets,function(e){r.__rValMax=Math.max(r.__rValMax,e.rowData[t]),r.__rValMin=Math.min(r.__rValMin,e.rowData[t])}));var s=a.rowData[t];return r.node.minR+(s-this.__rValMin)/(this.__rValMax-this.__rValMin)*(r.node.maxR-r.node.minR)}return r._getProp(t,a)}},{key:"_getProp",value:function(t,i){var n=this.iGroup;return e.isFunction(t)?t.apply(this,[i,n]):t}},{key:"getPlanetAt",value:function(t){var i=t;return e.isNumber(t)&&e.each(this.planets,function(e){if(e.rowData.__index__==t)return i=e,!1}),i}},{key:"selectAt",value:function(t){if(this.node.select.enabled){var e=this.getPlanetAt(t);e.selected=!0,e.nodeElement&&(e.nodeElement.context.lineWidth=this._getProp(this.node.select.lineWidth,e),e.nodeElement.context.strokeStyle=this._getProp(this.node.select.strokeStyle,e),e.nodeElement.context.lineAlpha=this._getProp(this.node.select.lineAlpha,e));for(var i=0;i<this.selectInds.length;i++)if(t===this.selectInds[i]){this.selectInds.splice(i--,1);break}}}},{key:"unselectAt",value:function(t){if(this.node.select.enabled){var e=this.getPlanetAt(t);e.selected=!1,e.nodeElement&&(e.nodeElement.context.lineWidth=this._getProp(this.node.lineWidth,e),e.nodeElement.context.lineAlpha=this._getProp(this.node.lineAlpha,e)),this.selectInds.push(t)}}},{key:"getSelectedNodes",value:function(){return e.filter(this.planets,function(t){return t.selected})}},{key:"focusAt",value:function(t){if(this.node.focus.enabled){var e=this.getPlanetAt(t);e.selected||(e.focused=!0,e.nodeElement&&(e.nodeElement.context.lineWidth=this._getProp(this.node.focus.lineWidth,e),e.nodeElement.context.strokeStyle=this._getProp(this.node.focus.strokeStyle,e),e.nodeElement.context.lineAlpha=this._getProp(this.node.focus.lineAlpha,e)))}}},{key:"unfocusAt",value:function(t){if(this.node.focus.enabled){var e=this.getPlanetAt(t);e.selected||(e.focused=!1,e.nodeElement&&(e.nodeElement.context.lineWidth=this._getProp(this.node.lineWidth,e),e.nodeElement.context.lineAlpha=this._getProp(this.node.lineAlpha,e)))}}}]),t}(),Bi=we.Display.Text,Hi=we.Shapes.Circle,ji=we.Shapes.Line,Vi=we.Shapes.Rect,Yi=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.type="planet",a.field=null,a.center={enabled:!0,text:"center",radius:30,fillStyle:"#70629e",fontSize:15,fontColor:"#ffffff",margin:20},a.groupDataFrames=[],a.groupField=null,a._ringGroups=[],a.grid={rings:{fillStyle:null,strokeStyle:null,lineWidth:1,section:[],count:3},rays:{count:0,lineWidth:1,strokeStyle:"#10519D",globalAlpha:.4}},a.selectInds=[],e.extend(!0,a,t),0!=a.center.radius&&a.center.enabled||(a.center.radius=0,a.center.margin=0,a.center.enabled=!1),a.init(),a}return Te(i,qe),ke(i,[{key:"init",value:function(){this.gridSp=new we.Display.Sprite({id:"gridSp"}),this.sprite.addChild(this.gridSp),this._dataGroupHandle()}},{key:"draw",value:function(t){!t&&(t={}),e.extend(!0,this,t),this._drawGroups(),this._drawCenter(),this.fire("complete")}},{key:"_getMaxR",value:function(){var t;try{t=this.graphs.group.circle.maxR}catch(t){}return void 0==t&&(t=30),t}},{key:"_drawGroups",value:function(){var t=this,i=this.center.radius+this.center.margin,n=t.app.getComponent({name:"coord"}).maxR-t.center.radius-t.center.margin,a=this._getMaxR();e.each(this.groupDataFrames,function(r,s){var o=i+n*(r.length/t.dataFrame.length),l=new Gi(e.extend(!0,{iGroup:s,groupLen:t.groupDataFrames.length,rRange:{start:i,to:o},width:t.width-2*a,height:t.height-2*a,selectInds:t.selectInds},t._opt),r,t);i=l.rRange.to,t._ringGroups.push(l),t.grid.rings.section.push({radius:l.rRange.to})}),t._drawBack(),e.each(t._ringGroups,function(e){t.sprite.addChild(e.sprite)})}},{key:"_drawCenter",value:function(){this.center.enabled&&(this._center=new Hi({context:{x:this.origin.x,y:this.origin.y,fillStyle:this.center.fillStyle,r:this.center.radius}}),this._centerTxt=new Bi(this.center.text,{context:{x:this.origin.x,y:this.origin.y,fontSize:this.center.fontSize,textAlign:"center",textBaseline:"middle",fillStyle:this.center.fontColor}}),this.sprite.addChild(this._center),this.sprite.addChild(this._centerTxt))}},{key:"_drawBack",value:function(){var t=this,e=this.app.getComponent({name:"coord"});if(1==t.grid.rings.section.length){var i=(t.grid.rings.section[0].radius-t.center.radius)/t.grid.rings.count;t.grid.rings.section=[];for(var n=0;n<t.grid.rings.count;n++)t.grid.rings.section.push({radius:t.center.radius+i*(n+1)})}else t.grid.rings.count=t.grid.rings.section.length;for(n=t.grid.rings.section.length-1;n>=0;n--){var a=t.grid.rings.section[n];t.gridSp.addChild(new Hi({context:{x:e.origin.x,y:e.origin.y,r:a.radius,lineWidth:t._getBackProp(t.grid.rings.lineWidth,n),strokeStyle:t._getBackProp(t.grid.rings.strokeStyle,n),fillStyle:t._getBackProp(t.grid.rings.fillStyle,n)}}))}if(t.grid.rays.count>1){var r=e.origin.x,s=e.origin.y,o=360/t.grid.rays.count,l=e.maxR;t.grid.rings.section.length&&(l=t.grid.rings.section.slice(-1)[0].radius);n=0;for(var h=t.grid.rays.count;n<h;n++){var d=o*n/180*Math.PI,u=r+l*Math.cos(d),c=s+l*Math.sin(d);t.gridSp.addChild(new ji({context:{start:{x:r,y:s},end:{x:u,y:c},lineWidth:t._getBackProp(t.grid.rays.lineWidth,n),strokeStyle:t._getBackProp(t.grid.rays.strokeStyle,n),globalAlpha:t.grid.rays.globalAlpha}}))}}var f=new Vi({name:"clipRect",context:{x:e.origin.x-t.app.width/2,y:e.origin.y-t.height/2,width:t.app.width,height:t.height}});t.gridSp.clipTo(f),t.sprite.addChild(f)}},{key:"_getBackProp",value:function(t,i){var n=null;return e.isFunction(t)&&(n=t.apply(this,[{scaleInd:i,count:this.grid.rings.section.length,groups:this._ringGroups,graphs:this}])),(e.isString(t)||e.isNumber(t))&&(n=t),e.isArray(t)&&(n=t[i]),n}},{key:"_dataGroupHandle",value:function(){var t=e.indexOf(this.dataFrame.fields,this.groupField);if(t>=0){var i=this.dataFrame.org[0],n={};for(var a in e.each(this.dataFrame.org,function(a,r){r&&(n[a[t]]||(n[a[t]]=[e.clone(i)]),n[a[t]].push(a))}),n)this.groupDataFrames.push(D(n[a]))}else this.groupDataFrames.push(this.dataFrame)}},{key:"show",value:function(t,e){this.getAgreeNodeData(e,function(t){t.nodeElement&&(t.nodeElement.context.visible=!0),t.labelElement&&(t.labelElement.context.visible=!0)})}},{key:"hide",value:function(t,e){this.getAgreeNodeData(e,function(t){t.nodeElement&&(t.nodeElement.context.visible=!1),t.labelElement&&(t.labelElement.context.visible=!1)})}},{key:"getAgreeNodeData",value:function(t,i){e.each(this._ringGroups,function(n){e.each(n._rings,function(n,a){e.each(n.planets,function(e,n){var a=e.rowData;t.params.name==a[t.params.field]&&i&&i(e)})})})}},{key:"getLayoutNodes",value:function(){var t=[];return e.each(this._ringGroups,function(i){e.each(i.planets,function(e){e.pit&&t.push(e)})}),t}},{key:"getInvalidNodes",value:function(){var t=[];return e.each(this._ringGroups,function(i){e.each(i.planets,function(e){e.pit||t.push(e)})}),t}},{key:"selectAt",value:function(t){e.each(this._ringGroups,function(e){e.selectAt(t)})}},{key:"selectAll",value:function(){var t=this;e.each(t.dataFrame.getFieldData("__index__"),function(e){t.selectAt(e)})}},{key:"unselectAt",value:function(t){e.each(this._ringGroups,function(e){e.unselectAt(t)})}},{key:"unselectAll",value:function(t){var i=this;e.each(i.dataFrame.getFieldData("__index__"),function(t){i.unselectAt(t)})}},{key:"getSelectedNodes",value:function(){var t=[];return e.each(this._ringGroups,function(e){t=t.concat(e.getSelectedNodes())}),t}},{key:"getSelectedRowList",value:function(){var t=[];return e.each(this._ringGroups,function(i){var n=[];e.each(i.getSelectedNodes(),function(t){n.push(t.rowData)}),t=t.concat(n)}),t}}]),i}(),$i=we.Display.Text,qi=we.Shapes.Polygon,Xi=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.type="funnel",a.field=null,a.dataOrg=[],a.data=[],a.sort=null,a.invert=!1,a._maxVal=null,a._minVal=null,a.maxNodeWidth=null,a.minNodeWidth=0,a.minVal=0,a.node={shapeType:"polygon",height:0,fillStyle:null,lineWidth:0,strokeStyle:null,focus:{enabled:!0},select:{enabled:!0,lineWidth:2,strokeStyle:"#666"}},a.label={enabled:!0,align:"center",format:function(t){return Oe(t)},fontColor:"#ffffff",fontSize:13,textBaseline:"middle"},e.extend(!0,a,t),a.init(),a}return Te(i,qe),ke(i,[{key:"init",value:function(){}},{key:"_computerAttr",value:function(){this.field&&(this.dataOrg=this.dataFrame.getFieldData(this.field)),this._maxVal=e.max(this.dataOrg),this._minVal=e.min(this.dataOrg),this.maxNodeWidth||(this.maxNodeWidth=.7*this.width),this.node.height||(this.node.height=this.height/this.dataOrg.length),"asc"==this.sort&&(this.invert=!0),"desc"==this.sort&&(this.invert=!1)}},{key:"draw",value:function(t){!t&&(t={}),e.extend(!0,this,t);this.animation&&t.resize;this._computerAttr(),this.data=this._trimGraphs(),this._drawGraphs(),this.sprite.context.x=this.origin.x+this.width/2,this.sprite.context.y=this.origin.y}},{key:"_trimGraphs",value:function(){if(this.field){var t=this,i=[];return e.each(this.dataOrg,function(e,n){var a={type:"funnel",field:t.field,rowData:t.dataFrame.getRowDataAt(n),value:e,width:t._getNodeWidth(e),color:t.app.getTheme(n),cursor:"pointer",label:"",middlePoint:null,iNode:-1,points:[]};i.push(a)}),this.sort&&(i=i.sort(function(e,i){return"desc"==t.sort?i.value-e.value:e.value-i.value})),e.each(i,function(e,i){e.iNode=i,e.label=t.label.format(e.value,e)}),e.each(i,function(e,n){e.points=t._getPoints(e,i[n+1],i[n-1]),e.middlePoint={x:0,y:(e.iNode+.5)*t.node.height}}),i}}},{key:"_getNodeWidth",value:function(t){var e=this.minNodeWidth+(this.maxNodeWidth-this.minNodeWidth)/(this._maxVal-this.minVal)*(t-this.minVal);return parseInt(e)}},{key:"_getPoints",value:function(t,e,i){var n=[],a=t.iNode*this.node.height,r=a+this.node.height;if(this.invert){var s=this.minNodeWidth;i&&(s=i.width),n.push([-s/2,a]),n.push([s/2,a]),n.push([t.width/2,r]),n.push([-t.width/2,r])}else{n.push([-t.width/2,a]),n.push([t.width/2,a]);var o=this.minNodeWidth;e&&(o=e.width),n.push([o/2,r]),n.push([-o/2,r])}return n}},{key:"_drawGraphs",value:function(){var t=this;e.each(this.data,function(e){var i=new qi({context:{pointList:e.points,fillStyle:e.color,cursor:e.cursor}});t.sprite.addChild(i),i.nodeData=e,i.on(z.get(),function(e){e.eventInfo={title:t.field,nodes:[this.nodeData]},t.app.fire(e.type,e),t.triggerEvent(t.node,e)});var n="center",a={x:e.middlePoint.x,y:e.middlePoint.y};"left"==t.label.align&&(a.x=e.points[0][0]-(e.points[0][0]-e.points[3][0])/2,a.x-=15,n="right"),"right"==t.label.align&&(a.x=e.points[1][0]-(e.points[1][0]-e.points[2][0])/2,a.x+=15,n="left");var r=new $i(e.label,{context:{x:a.x,y:a.y,fontSize:t.label.fontSize,fillStyle:"center"==t.label.align?t.label.fontColor:e.color,textAlign:n,textBaseline:t.label.textBaseline}});t.sprite.addChild(r)})}}]),i}();function Ui(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=0;return e}function Zi(t,e){return Ui(t).map(function(){return Ui(e)})}function Qi(t,e){for(var i=0,n=0;n<t.length;++n)i+=t[n]*e[n];return i}function Ji(t){return Math.sqrt(Qi(t,t))}function Ki(t,e,i){for(var n=0;n<e.length;++n)t[n]=e[n]*i}function tn(t,e,i,n,a){for(var r=0;r<t.length;++r)t[r]=e*i[r]+n*a[r]}function en(t,e,i){var n,a=(i=i||{}).maxIterations||200*e.length,r=i.nonZeroDelta||1.05,s=i.zeroDelta||.001,o=i.minErrorDelta||1e-6,l=i.minErrorDelta||1e-5,h=void 0!==i.rho?i.rho:1,d=void 0!==i.chi?i.chi:2,u=void 0!==i.psi?i.psi:-.5,c=void 0!==i.sigma?i.sigma:.5,f=e.length,p=new Array(f+1);p[0]=e,p[0].fx=t(e),p[0].id=0;for(var g=0;g<f;++g){var y=e.slice();y[g]=y[g]?y[g]*r:s,p[g+1]=y,p[g+1].fx=t(y),p[g+1].id=g+1}function v(t){for(var e=0;e<t.length;e++)p[f][e]=t[e];p[f].fx=t.fx}for(var x=function(t,e){return t.fx-e.fx},_=e.slice(),m=e.slice(),b=e.slice(),w=e.slice(),S=0;S<a;++S){if(p.sort(x),i.history){var A=p.map(function(t){var e=t.slice();return e.fx=t.fx,e.id=t.id,e});A.sort(function(t,e){return t.id-e.id}),i.history.push({x:p[0].slice(),fx:p[0].fx,simplex:A})}for(n=0,g=0;g<f;++g)n=Math.max(n,Math.abs(p[0][g]-p[1][g]));if(Math.abs(p[0].fx-p[f].fx)<o&&n<l)break;for(g=0;g<f;++g){_[g]=0;for(var k=0;k<f;++k)_[g]+=p[k][g];_[g]/=f}var C=p[f];if(tn(m,1+h,_,-h,C),m.fx=t(m),m.fx<p[0].fx)tn(w,1+d,_,-d,C),w.fx=t(w),w.fx<m.fx?v(w):v(m);else if(m.fx>=p[f-1].fx){var T=!1;if(m.fx>C.fx?(tn(b,1+u,_,-u,C),b.fx=t(b),b.fx<C.fx?v(b):T=!0):(tn(b,1-u*h,_,u*h,C),b.fx=t(b),b.fx<m.fx?v(b):T=!0),T){if(c>=1)break;for(g=1;g<p.length;++g)tn(p[g],1-c,p[0],c,p[g]),p[g].fx=t(p[g])}}else v(m)}return p.sort(x),{fx:p[0].fx,x:p[0]}}function nn(t,e,i,n,a,r,s){var o=i.fx,l=Qi(i.fxprime,e),h=o,d=o,u=l,c=0;function f(d,c,f){for(var p=0;p<16;++p)if(a=(d+c)/2,tn(n.x,1,i.x,a,e),h=n.fx=t(n.x,n.fxprime),u=Qi(n.fxprime,e),h>o+r*a*l||h>=f)c=a;else{if(Math.abs(u)<=-s*l)return a;u*(c-d)>=0&&(c=d),d=a,f=h}return 0}a=a||1,r=r||1e-6,s=s||.1;for(var p=0;p<10;++p){if(tn(n.x,1,i.x,a,e),h=n.fx=t(n.x,n.fxprime),u=Qi(n.fxprime,e),h>o+r*a*l||p&&h>=d)return f(c,a,d);if(Math.abs(u)<=-s*l)return a;if(u>=0)return f(a,c,h);d=h,c=a,a*=2}return a}function an(t,e,i){var n,a,r,s={x:e.slice(),fx:0,fxprime:e.slice()},o={x:e.slice(),fx:0,fxprime:e.slice()},l=e.slice(),h=1;r=(i=i||{}).maxIterations||20*e.length,s.fx=t(s.x,s.fxprime),Ki(n=s.fxprime.slice(),s.fxprime,-1);for(var d=0;d<r;++d){if(h=nn(t,n,s,o,h),i.history&&i.history.push({x:s.x.slice(),fx:s.fx,fxprime:s.fxprime.slice(),alpha:h}),h){tn(l,1,o.fxprime,-1,s.fxprime);var u=Qi(s.fxprime,s.fxprime);tn(n,Math.max(0,Qi(l,o.fxprime)/u),n,-1,o.fxprime),a=s,s=o,o=a}else Ki(n,s.fxprime,-1);if(Ji(s.fxprime)<=1e-5)break}return i.history&&i.history.push({x:s.x.slice(),fx:s.fx,fxprime:s.fxprime.slice(),alpha:h}),s}var rn=1e-10;function sn(t,e){var i,n=function(t){for(var e=[],i=0;i<t.length;++i)for(var n=i+1;n<t.length;++n)for(var a=dn(t[i],t[n]),r=0;r<a.length;++r){var s=a[r];s.parentIndex=[i,n],e.push(s)}return e}(t),a=n.filter(function(e){return function(t,e){for(var i=0;i<e.length;++i)if(ln(t,e[i])>e[i].radius+rn)return!1;return!0}(e,t)}),r=0,s=0,o=[];if(a.length>1){var l=un(a);for(i=0;i<a.length;++i){var h=a[i];h.angle=Math.atan2(h.x-l.x,h.y-l.y)}a.sort(function(t,e){return e.angle-t.angle});var d=a[a.length-1];for(i=0;i<a.length;++i){var u=a[i];s+=(d.x+u.x)*(u.y-d.y);for(var c={x:(u.x+d.x)/2,y:(u.y+d.y)/2},f=null,p=0;p<u.parentIndex.length;++p)if(d.parentIndex.indexOf(u.parentIndex[p])>-1){var g=t[u.parentIndex[p]],y=Math.atan2(u.x-g.x,u.y-g.y),v=Math.atan2(d.x-g.x,d.y-g.y),x=v-y;x<0&&(x+=2*Math.PI);var _=v-x/2,m=ln(c,{x:g.x+g.radius*Math.sin(_),y:g.y+g.radius*Math.cos(_)});m>2*g.radius&&(m=2*g.radius),(null===f||f.width>m)&&(f={circle:g,width:m,p1:u,p2:d})}null!==f&&(o.push(f),r+=on(f.circle.radius,f.width),d=u)}}else{var b=t[0];for(i=1;i<t.length;++i)t[i].radius<b.radius&&(b=t[i]);var w=!1;for(i=0;i<t.length;++i)if(ln(t[i],b)>Math.abs(b.radius-t[i].radius)){w=!0;break}w?r=s=0:(r=b.radius*b.radius*Math.PI,o.push({circle:b,p1:{x:b.x,y:b.y+b.radius},p2:{x:b.x-rn,y:b.y+b.radius},width:2*b.radius}))}return s/=2,e&&(e.area=r+s,e.arcArea=r,e.polygonArea=s,e.arcs=o,e.innerPoints=a,e.intersectionPoints=n),r+s}function on(t,e){return t*t*Math.acos(1-e/t)-(t-e)*Math.sqrt(e*(2*t-e))}function ln(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function hn(t,e,i){if(i>=t+e)return 0;if(i<=Math.abs(t-e))return Math.PI*Math.min(t,e)*Math.min(t,e);var n=e-(i*i-t*t+e*e)/(2*i);return on(t,t-(i*i-e*e+t*t)/(2*i))+on(e,n)}function dn(t,e){var i=ln(t,e),n=t.radius,a=e.radius;if(i>=n+a||i<=Math.abs(n-a))return[];var r=(n*n-a*a+i*i)/(2*i),s=Math.sqrt(n*n-r*r),o=t.x+r*(e.x-t.x)/i,l=t.y+r*(e.y-t.y)/i,h=-(e.y-t.y)*(s/i),d=-(e.x-t.x)*(s/i);return[{x:o+h,y:l-d},{x:o-h,y:l+d}]}function un(t){for(var e={x:0,y:0},i=0;i<t.length;++i)e.x+=t[i].x,e.y+=t[i].y;return e.x/=t.length,e.y/=t.length,e}function cn(t,e){(e=e||{}).maxIterations=e.maxIterations||500;var i,n=e.initialLayout||gn,a=e.lossFunction||yn,r=n(t=function(t){t=t.slice();var e,i,n,a,r=[],s={};for(e=0;e<t.length;++e){var o=t[e];1==o.sets.length?r.push(o.sets[0]):2==o.sets.length&&(n=o.sets[0],a=o.sets[1],s[[n,a]]=!0,s[[a,n]]=!0)}for(r.sort(function(t,e){return t>e}),e=0;e<r.length;++e)for(n=r[e],i=e+1;i<r.length;++i)a=r[i],[n,a]in s||t.push({sets:[n,a],size:0});return t}(t),e),s=[],o=[];for(i in r)r.hasOwnProperty(i)&&(s.push(r[i].x),s.push(r[i].y),o.push(i));for(var l=en(function(e){for(var i={},n=0;n<o.length;++n){var s=o[n];i[s]={x:e[2*n],y:e[2*n+1],radius:r[s].radius}}return a(i,t)},s,e).x,h=0;h<o.length;++h)i=o[h],r[i].x=l[2*h],r[i].y=l[2*h+1];return r}var fn=1e-10;function pn(t,e,i){return Math.min(t,e)*Math.min(t,e)*Math.PI<=i+fn?Math.abs(t-e):function(t,e,i,n){var a=(n=n||{}).maxIterations||100,r=n.tolerance||1e-10,s=t(e),o=t(i),l=i-e;if(s*o>0)throw"Initial bisect points must have opposite signs";if(0===s)return e;if(0===o)return i;for(var h=0;h<a;++h){var d=e+(l/=2),u=t(d);if(u*s>=0&&(e=d),Math.abs(l)<r||0===u)return d}return e+l}(function(n){return hn(t,e,n)-i},0,t+e)}function gn(t,e){var i=function(t,e){for(var i,n=e&&e.lossFunction?e.lossFunction:yn,a={},r={},s=0;s<t.length;++s){var o=t[s];1==o.sets.length&&(i=o.sets[0],a[i]={x:1e10,y:1e10,rowid:a.length,size:o.size,radius:Math.sqrt(o.size/Math.PI)},r[i]=[])}for(t=t.filter(function(t){return 2==t.sets.length}),s=0;s<t.length;++s){var l=t[s],h=l.hasOwnProperty("weight")?l.weight:1,d=l.sets[0],u=l.sets[1];l.size+fn>=Math.min(a[d].size,a[u].size)&&(h=0),r[d].push({set:u,size:l.size,weight:h}),r[u].push({set:d,size:l.size,weight:h})}var c=[];for(i in r)if(r.hasOwnProperty(i)){var f=0;for(s=0;s<r[i].length;++s)f+=r[i][s].size*r[i][s].weight;c.push({set:i,size:f})}function p(t,e){return e.size-t.size}c.sort(p);var g={};function y(t){return t.set in g}function v(t,e){a[e].x=t.x,a[e].y=t.y,g[e]=!0}for(v({x:0,y:0},c[0].set),s=1;s<c.length;++s){var x=c[s].set,_=r[x].filter(y);if(i=a[x],_.sort(p),0===_.length)throw"ERROR: missing pairwise overlap information";for(var m=[],b=0;b<_.length;++b){var w=a[_[b].set],S=pn(i.radius,w.radius,_[b].size);m.push({x:w.x+S,y:w.y}),m.push({x:w.x-S,y:w.y}),m.push({y:w.y+S,x:w.x}),m.push({y:w.y-S,x:w.x});for(var A=b+1;A<_.length;++A)for(var k=a[_[A].set],C=pn(i.radius,k.radius,_[A].size),T=dn({x:w.x,y:w.y,radius:S},{x:k.x,y:k.y,radius:C}),P=0;P<T.length;++P)m.push(T[P])}var L=1e50,D=m[0];for(b=0;b<m.length;++b){a[x].x=m[b].x,a[x].y=m[b].y;var M=n(a,t);M<L&&(L=M,D=m[b])}v(D,x)}return a}(t,e),n=e.lossFunction||yn;if(t.length>=8){var a=function(t,e){var i,n=(e=e||{}).restarts||10,a=[],r={};for(i=0;i<t.length;++i){var s=t[i];1==s.sets.length&&(r[s.sets[0]]=a.length,a.push(s))}var o=function(t,e,i){var n=Zi(e.length,e.length),a=Zi(e.length,e.length);return t.filter(function(t){return 2==t.sets.length}).map(function(t){var r=i[t.sets[0]],s=i[t.sets[1]],o=pn(Math.sqrt(e[r].size/Math.PI),Math.sqrt(e[s].size/Math.PI),t.size);n[r][s]=n[s][r]=o;var l=0;t.size+1e-10>=Math.min(e[r].size,e[s].size)?l=1:t.size<=1e-10&&(l=-1),a[r][s]=a[s][r]=l}),{distances:n,constraints:a}}(t,a,r),l=o.distances,h=o.constraints,d=Ji(l.map(Ji))/l.length;l=l.map(function(t){return t.map(function(t){return t/d})});var u,c,f=function(t,e){return function(t,e,i,n){var a,r=0;for(a=0;a<e.length;++a)e[a]=0;for(a=0;a<i.length;++a)for(var s=t[2*a],o=t[2*a+1],l=a+1;l<i.length;++l){var h=t[2*l],d=t[2*l+1],u=i[a][l],c=n[a][l],f=(h-s)*(h-s)+(d-o)*(d-o),p=Math.sqrt(f),g=f-u*u;c>0&&p<=u||c<0&&p>=u||(r+=2*g*g,e[2*a]+=4*g*(s-h),e[2*a+1]+=4*g*(o-d),e[2*l]+=4*g*(h-s),e[2*l+1]+=4*g*(d-o))}return r}(t,e,l,h)};for(i=0;i<n;++i){var p=Ui(2*l.length).map(Math.random);c=an(f,p,e),(!u||c.fx<u.fx)&&(u=c)}var g=u.x,y={};for(i=0;i<a.length;++i){var v=a[i];y[v.sets[0]]={x:g[2*i]*d,y:g[2*i+1]*d,radius:Math.sqrt(v.size/Math.PI)}}if(e.history)for(i=0;i<e.history.length;++i)Ki(e.history[i].x,d);return y}(t,e);n(a,t)+1e-8<n(i,t)&&(i=a)}return i}function yn(t,e){var i=0;for(var n=0;n<e.length;++n){var a,r=e[n];if(1!=r.sets.length){if(2==r.sets.length){var s=t[r.sets[0]],o=t[r.sets[1]];a=hn(s.radius,o.radius,ln(s,o))}else a=sn(r.sets.map(function(e){return t[e]}));i+=(r.hasOwnProperty("weight")?r.weight:1)*(a-r.size)*(a-r.size)}}return i}function vn(t,e,i){var n;if(null===i?t.sort(function(t,e){return e.radius-t.radius}):t.sort(i),t.length>0){var a=t[0].x,r=t[0].y;for(n=0;n<t.length;++n)t[n].x-=a,t[n].y-=r}2==t.length&&(ln(t[0],t[1])<Math.abs(t[1].radius-t[0].radius)&&(t[1].x=t[0].x+t[0].radius-t[1].radius-1e-10,t[1].y=t[0].y));if(t.length>1){var s,o,l=Math.atan2(t[1].x,t[1].y)-e,h=Math.cos(l),d=Math.sin(l);for(n=0;n<t.length;++n)s=t[n].x,o=t[n].y,t[n].x=h*s-d*o,t[n].y=d*s+h*o}if(t.length>2){for(var u=Math.atan2(t[2].x,t[2].y)-e;u<0;)u+=2*Math.PI;for(;u>2*Math.PI;)u-=2*Math.PI;if(u>Math.PI){var c=t[1].y/(1e-10+t[1].x);for(n=0;n<t.length;++n){var f=(t[n].x+c*t[n].y)/(1+c*c);t[n].x=2*f-t[n].x,t[n].y=2*f*c-t[n].y}}}}function xn(t){var e=function(e){return{max:Math.max.apply(null,t.map(function(t){return t[e]+t.radius})),min:Math.min.apply(null,t.map(function(t){return t[e]-t.radius}))}};return{xRange:e("x"),yRange:e("y")}}function _n(t,e,i){null===e&&(e=Math.PI/2);var n,a,r=[];for(a in t)if(t.hasOwnProperty(a)){var s=t[a];r.push({x:s.x,y:s.y,radius:s.radius,setid:a})}var o=function(t){function e(t){return t.parent!==t&&(t.parent=e(t.parent)),t.parent}t.map(function(t){t.parent=t});for(var i=0;i<t.length;++i)for(var n=i+1;n<t.length;++n){var a=t[i].radius+t[n].radius;ln(t[i],t[n])+1e-10<a&&(r=t[n],s=t[i],o=void 0,o=e(r),l=e(s),o.parent=l)}var r,s,o,l,h,d={};for(i=0;i<t.length;++i)(h=e(t[i]).parent.setid)in d||(d[h]=[]),d[h].push(t[i]);t.map(function(t){delete t.parent});var u=[];for(h in d)d.hasOwnProperty(h)&&u.push(d[h]);return u}(r);for(n=0;n<o.length;++n){vn(o[n],e,i);var l=xn(o[n]);o[n].size=(l.xRange.max-l.xRange.min)*(l.yRange.max-l.yRange.min),o[n].bounds=l}o.sort(function(t,e){return e.size-t.size});var h=(r=o[0]).bounds,d=(h.xRange.max-h.xRange.min)/50;function u(t,e,i){if(t){var n,a,s,o=t.bounds;e?n=h.xRange.max-o.xRange.min+d:(n=h.xRange.max-o.xRange.max,(s=(o.xRange.max-o.xRange.min)/2-(h.xRange.max-h.xRange.min)/2)<0&&(n+=s)),i?a=h.yRange.max-o.yRange.min+d:(a=h.yRange.max-o.yRange.max,(s=(o.yRange.max-o.yRange.min)/2-(h.yRange.max-h.yRange.min)/2)<0&&(a+=s));for(var l=0;l<t.length;++l)t[l].x+=n,t[l].y+=a,r.push(t[l])}}for(var c=1;c<o.length;)u(o[c],!0,!1),u(o[c+1],!1,!0),u(o[c+2],!0,!0),c+=3,h=xn(r);var f={};for(n=0;n<r.length;++n)f[r[n].setid]=r[n];return f}var mn=we.Display.Text,bn=we.Shapes.Path,wn=we.Shapes.Circle,Sn=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.type="venn",a.keyField=null,a.valueField=null,a.node={strokeStyle:null,lineWidth:2,lineAlpha:0,fillStyle:null,fillAlpha:.25,focus:{enabled:!0,lineAlpha:.3},select:{enabled:!0,lineWidth:2,strokeStyle:"#666"}},a.label={field:null,fontSize:14,fontColor:null,fontWeight:"normal",showInter:!0},a.vennData=null,e.extend(!0,a,t),a._dataCircleLen=0,a._dataLabelLen=0,a._dataPathLen=0,a.init(),a}return Te(i,qe),ke(i,[{key:"init",value:function(){this.venn_circles=new we.Display.Sprite({id:"venn_circles"}),this.sprite.addChild(this.venn_circles),this.venn_paths=new we.Display.Sprite({id:"venn_paths"}),this.sprite.addChild(this.venn_paths),this.venn_labels=new we.Display.Sprite({id:"venn_labels"}),this.sprite.addChild(this.venn_labels)}},{key:"draw",value:function(t){!t&&(t={}),e.extend(!0,this,t),this.data=this._trimGraphs(),this._widget(),this.sprite.context.x=this.app.padding.left,this.sprite.context.y=this.app.padding.top,this.fire("complete")}},{key:"resetData",value:function(t,e){this.dataFrame=t,this.data=this._trimGraphs(),this._widget()}},{key:"_trimGraphs",value:function(){var t=this,i=t._vennData(),n=cn,a=yn,r=Math.PI/2,s={},o={};if(this._dataCircleLen=0,this._dataLabelLen=0,this._dataPathLen=0,i.length>0){var l=n(i,{lossFunction:a});l=_n(l,r,null),s=function(t,e,i,n){var a=[],r=[];for(var s in t)t.hasOwnProperty(s)&&(r.push(s),a.push(t[s]));e-=2*n,i-=2*n;var o=xn(a),l=o.xRange,h=o.yRange;if(l.max==l.min||h.max==h.min)return console.log("not scaling solution: zero size detected"),t;for(var d=e/(l.max-l.min),u=i/(h.max-h.min),c=Math.min(u,d),f=(e-(l.max-l.min)*c)/2,p=(i-(h.max-h.min)*c)/2,g={},y=0;y<a.length;++y){var v=a[y];g[r[y]]={radius:c*v.radius,x:n+f+(v.x-l.min)*c,y:n+p+(v.y-h.min)*c}}return g}(l,this.width,this.height,0),o=function(t,e){for(var i={},n=function(t){var e={},i=[];for(var n in t)i.push(n),e[n]=[];for(var a=0;a<i.length;a++)for(var r=t[i[a]],s=a+1;s<i.length;++s){var o=t[i[s]],l=ln(r,o);l+o.radius<=r.radius+1e-10?e[i[s]].push(i[a]):l+r.radius<=o.radius+1e-10&&e[i[a]].push(i[s])}return e}(t),a=0;a<e.length;++a){for(var r=e[a].sets,s={},o={},l=0;l<r.length;++l){s[r[l]]=!0;for(var h=n[r[l]],d=0;d<h.length;++d)o[h[d]]=!0}var u=[],c=[];for(var f in t)f in s?u.push(t[f]):f in o||c.push(t[f]);var p=An(u,c);i[r]=p,p.disjoint&&e[a].size>0&&console.log("WARNING: area "+r+" not represented on screen")}return i}(s,i)}var h=0,d=0;return e.each(i,function(i,n){if(i.label&&(i.sets.length>1&&!t.label.showInter||(i.labelPosition=o[i.nodeId],t._dataLabelLen++)),i.sets.length>1){var a=function(t){var e={};sn(t,e);var i=e.arcs;if(0===i.length)return"M 0 0";if(1==i.length){var n=i[0].circle;return function(t,e,i){var n=[];return n.push("\nM",t,e),n.push("\nm",-i,0),n.push("\na",i,i,0,1,0,2*i,0),n.push("\na",i,i,0,1,0,2*-i,0),n.join(" ")}(n.x,n.y,n.radius)}for(var a=["\nM",i[0].p2.x,i[0].p2.y],r=0;r<i.length;++r){var s=i[r],o=s.circle.radius,l=s.width>o;a.push("\nA",o,o,0,l?1:0,1,s.p1.x,s.p1.y)}return a.join(" ")+" z"}(i.sets.map(function(t){return s[t]}));i.shape={type:"path",path:a,pathInd:d++},t._dataPathLen++}else 1==i.sets.length&&(i.shape=e.extend({type:"circle",circleInd:h++},s[i.nodeId]),t._dataCircleLen++)}),i}},{key:"_vennData",value:function(){for(var t=[],i=0,n=this.dataFrame.length;i<n;i++){var a=this.dataFrame.getRowDataAt(i),r={iNode:i,nodeId:null,rowData:a,sets:null,size:null,value:null,fillStyle:null,strokeStyle:null,label:null,labelPosition:null};for(var s in a){var o=a[s];s==this.keyField?(e.isArray(o)||(o=o.split(/[,|]/)),r.sets=o,r.nodeId=o.join()):s==this.valueField?(r.size=o,r.value=o):s==this.label.field&&(r.label=o)}t.push(r)}return t}},{key:"_getStyle",value:function(t,i,n,a){var r;return e.isString(t)&&(r=t),e.isFunction(t)&&(r=t(n)),r||void 0==i||(r=this.app.getTheme(i)),r||void 0==a||(r=a),r}},{key:"_widget",value:function(){var t=this;if(t.venn_circles.children.length>t._dataCircleLen)for(var i=t._dataCircleLen;i<t.venn_circles.children.length;i++)t.venn_circles.getChildAt(i--).destroy();if(t.venn_paths.children.length>t._dataPathLen)for(i=t._dataPathLen;i<t.venn_paths.children.length;i++)t.venn_paths.getChildAt(i--).destroy();if(t.venn_labels.children.length>t._dataLabelLen)for(i=t._dataLabelLen;i<t.venn_labels.children.length;i++)t.venn_labels.getChildAt(i--).destroy();var n=0,a=0,r=0;e.each(this.data,function(e,i){var s,o=e.shape,l=!0;if(o){var h;if("circle"==o.type){var d=t._getStyle(t.node.fillStyle,o.circleInd,e),u=t._getStyle(t.node.strokeStyle,o.circleInd,e);e.fillStyle=d,e.strokeStyle=u,h={x:o.x,y:o.y,r:o.radius,fillStyle:d,fillAlpha:t.node.fillAlpha,lineWidth:t.node.lineWidth,strokeStyle:u,lineAlpha:t.node.lineAlpha},(s=t.venn_circles.getChildAt(n++))?(l=!1,s.animate(h)):(s=new wn({pointChkPriority:!1,hoverClone:!1,context:h}),t.venn_circles.addChild(s))}"path"==e.shape.type&&(h={path:o.path,fillStyle:"#ffffff",fillAlpha:0,lineWidth:t.node.lineWidth,strokeStyle:"#ffffff",lineAlpha:0},(s=t.venn_paths.getChildAt(a++))?(l=!1,s.context.path=o.path):(s=new bn({pointChkPriority:!1,context:h}),t.venn_paths.addChild(s))),s.nodeData=e,e._node=s,t.node.focus.enabled&&s.hover(function(e){t.focusAt(this.nodeData.iNode)},function(e){!this.nodeData.selected&&t.unfocusAt(this.nodeData.iNode)}),l&&s.on(z.get(),function(e){e.eventInfo={title:null,nodes:[this.nodeData]},t.app.fire(e.type,e),t.triggerEvent(t.node,e)})}if(e.label&&t.label.enabled){var c=t._getStyle(t.label.fontColor,o.circleInd,e,"#999"),f=t.label.fontSize;if(e.sets.length>1&&(t.label.showInter?f-=2:f=0),f){var p={x:e.labelPosition.x,y:e.labelPosition.y,fontSize:f,textBaseline:"middle",textAlign:"center",fontWeight:t.label.fontWeight,fillStyle:c},g=t.venn_labels.getChildAt(r++);g?(g.resetText(e.label),g.animate(p)):(g=new mn(e.label,{context:p}),t.venn_labels.addChild(g))}}})}},{key:"focusAt",value:function(t){var e=this.data[t];if(this.node.focus.enabled&&!e.focused){var i=e._node.context;e.sets.length>1?i.lineAlpha=1:i.lineAlpha=this.node.focus.lineAlpha,e.focused=!0}}},{key:"unfocusAt",value:function(t){var e=this.data[t];this.node.focus.enabled&&e.focused&&(e._node.context.lineAlpha=this.node.lineAlpha,e.focused=!1)}},{key:"selectAt",value:function(t){var e=this.data[t];if(this.node.select.enabled&&!e.selected){var i=e._node.context;i.lineWidth=this.node.select.lineWidth,i.lineAlpha=this.node.select.lineAlpha,i.strokeStyle=this.node.select.strokeStyle,e.selected=!0}}},{key:"unselectAt",value:function(t){var e=this.data[t];this.node.select.enabled&&e.selected&&(e._node.context.strokeStyle=this.node.strokeStyle,e.selected=!1)}}]),i}();function An(t,e){var i,n=[];for(i=0;i<t.length;++i){var a=t[i];n.push({x:a.x,y:a.y}),n.push({x:a.x+a.radius/2,y:a.y}),n.push({x:a.x-a.radius/2,y:a.y}),n.push({x:a.x,y:a.y+a.radius/2}),n.push({x:a.x,y:a.y-a.radius/2})}var r=n[0],s=kn(n[0],t,e);for(i=1;i<n.length;++i){var o=kn(n[i],t,e);o>=s&&(r=n[i],s=o)}var l=en(function(i){return-1*kn({x:i[0],y:i[1]},t,e)},[r.x,r.y],{maxIterations:500,minErrorDelta:1e-10}).x,h={x:l[0],y:l[1]},d=!0;for(i=0;i<t.length;++i)if(ln(h,t[i])>t[i].radius){d=!1;break}for(i=0;i<e.length;++i)if(ln(h,e[i])<e[i].radius){d=!1;break}if(!d)if(1==t.length)h={x:t[0].x,y:t[0].y};else{var u={};sn(t,u),h=0===u.arcs.length?{x:0,y:-1e3,disjoint:!0}:1==u.arcs.length?{x:u.arcs[0].circle.x,y:u.arcs[0].circle.y}:e.length?An(t,[]):un(u.arcs.map(function(t){return t.p1}))}return h}function kn(t,e,i){var n,a,r=e[0].radius-ln(e[0],t);for(n=1;n<e.length;++n)(a=e[n].radius-ln(e[n],t))<=r&&(r=a);for(n=0;n<i.length;++n)(a=ln(i[n],t)-i[n].radius)<=r&&(r=a);return r}function Cn(t,e,i){return function(){var n=i.apply(e,arguments);return n===e?t:n}}var Tn={merge:function(t){for(var e,i,n,a=t.length,r=-1,s=0;++r<a;)s+=t[r].length;for(i=new Array(s);--a>=0;)for(e=(n=t[a]).length;--e>=0;)i[--s]=n[e];return i}},Pn=function(){var t=On,e=Dn,i=Mn;function n(a){var r,s=[a],o=[];for(a.depth=0;null!=(r=s.pop());)if(o.push(r),(h=e.call(n,r,r.depth))&&(l=h.length)){for(var l,h,d;--l>=0;)s.push(d=h[l]),d.parent=r,d.depth=r.depth+1;var u=+i.call(n,r,r.depth);u&&!isNaN(u)&&(r._value=u),i&&(r.value=0),r.children=h}else i&&(r.value=+i.call(n,r,r.depth)||0),delete r.children;return Ln(a,function(e){var n,a;t&&(n=e.children)&&n.sort(t),i&&(a=e.parent)&&(a.value+=e.value),e._value&&e._value>e.value&&(e.value=e._value),delete e._value}),o}return n.sort=function(e){return arguments.length?(t=e,n):t},n.children=function(t){return arguments.length?(e=t,n):e},n.value=function(t){return arguments.length?(i=t,n):i},n.revalue=function(t){return i&&(!function(t,e){var i=[t];for(;null!=(t=i.pop());)if(e(t),(a=t.children)&&(n=a.length))for(var n,a;--n>=0;)i.push(a[n])}(t,function(t){t.children&&(t.value=0)}),Ln(t,function(t){var e;t.children||(t.value=+i.call(n,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value),t._value&&t._value>t.value&&(t.value=t._value),delete t._value})),t},n};function Ln(t,e){for(var i=[t],n=[];null!=(t=i.pop());)if(n.push(t),(r=t.children)&&(a=r.length))for(var a,r,s=-1;++s<a;)i.push(r[s]);for(;null!=(t=n.pop());)e(t)}function Dn(t){return t.children}function Mn(t){return t.value}function On(t,e){return e.value-t.value}function In(t){return Tn.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function En(){var t=Pn(),e=[1,1];function i(i,n){var a=t.call(this,i,n);return function t(e,i,n,a){var r=e.children;if(e.x=i,e.y=e.depth*a,e.dx=n,e.dy=a,r&&(s=r.length)){var s,o,l,h=-1;for(n=e.value?n/e.value:0;++h<s;)t(o=r[h],i,l=o.value*n,a),i+=l}}(a[0],0,e[0],e[1]/function t(e){var i=e.children,n=0;if(i&&(a=i.length))for(var a,r=-1;++r<a;)n=Math.max(n,t(i[r]));return 1+n}(a[0])),a}return i.size=function(t){return arguments.length?(e=t,i):e},Pn.layout_hierarchyRebind(i,t)}Pn.layout_hierarchyRebind=function(t,e){return function(t,e){for(var i,n=1,a=arguments.length;++n<a;)t[i=arguments[n]]=Cn(t,e,e[i])}(t,e,"sort","children","value"),t.nodes=t,t.links=In,t};var Rn=we.Shapes.Sector,Fn=(we.Shapes.Circle,function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.type="sunburst",a.keyField="name",a.valueField="value",a.parentField="parent",a.node={strokeStyle:"#fff",lineWidth:1,lineAlpha:1,fillStyle:null,fillAlpha:1,blurAlpha:.4,focus:{enabled:!0,lineAlpha:1}},e.extend(!0,a,t),a.data=[],a.dataGroup=[],a.init(),a}return Te(i,qe),ke(i,[{key:"init",value:function(){}},{key:"draw",value:function(t){!t&&(t={}),e.extend(!0,this,t),this.data=this._trimGraphs(),this.dataGroup=this._getDataGroupOfDepth(),this._widget(),this.sprite.context.x=this.width/2+this.origin.x,this.sprite.context.y=this.height/2+this.origin.y,this.fire("complete")}},{key:"_trimGraphs",value:function(){var t=this,e=parseInt(Math.min(this.width,this.height)/2),i=En().sort(null).size([2*Math.PI,e*e]).value(function(e){return e[t.valueField]}),n=this._tansTreeData();return this.data=i(n,0),this.data}},{key:"_getDataGroupOfDepth",value:function(){var t={};e.each(this.data,function(e){t[e.depth]=[]}),e.each(this.data,function(e){t[e.depth].push(e)});var i=[];for(var n in t)i.push(t[n]);return i}},{key:"_tansTreeData",value:function(){var t=this.dataFrame,i={},n=t.getFieldData(this.keyField),a=t.getFieldData(this.valueField),r=t.getFieldData(this.parentField);return function t(i,s,o){for(var l=s?s.name:void 0,h=o||0;h<r.length;h++){var d=r[h];if(d||0===d||(d=void 0),l===d){i.name=n[h],i.iNode=h;var u=a[h];(u||0===u)&&(i.value=u),e.each(r,function(e,n){if(e===i.name){i.children||(i.children=[]);var a={};t(a,i,n),i.children.push(a)}});break}}}(i),i}},{key:"_widget",value:function(){var t=this;e.each(this.dataGroup,function(i,n){e.each(i,function(e,a){if(e.depth){var r=Math.sqrt(e.y+e.dy),s={r0:Math.sqrt(e.y),r:Math.sqrt(e.y)+2,startAngle:180*e.x/Math.PI,endAngle:180*(e.x+e.dx)/Math.PI,fillStyle:e.color||t.app.getTheme(e.iNode),strokeStyle:t.node.strokeStyle,lineWidth:t.node.lineWidth,globalAlpha:0},o=new Rn({id:"sector_"+n+"_"+a,context:s});o.layoutData=e,e.sector=o,e.group=i,t.sprite.addChild(o),o.hover(function(n){t._focus(e,i)},function(n){t._unfocus(e,i)}),o.on(z.get(),function(i){i.eventInfo={iNode:e.iNode},t.app.fire(i.type,i),t.triggerEvent(t.node,i)}),n<=1?(o.context.r=r,o.context.globalAlpha=1):setTimeout(function(){o.context&&(o.context.globalAlpha=1,o.animate({r:r},{duration:350}))},350*(n-1))}})})}},{key:"getNodesAt",value:function(t){var i=[];if(void 0!==t){var n=e.find(this.data,function(e){return e.iNode==t});n&&i.push(n)}return i}},{key:"_focus",value:function(t,i){var n=this;e.each(i,function(e){e!==t&&(e.sector.context.globalAlpha=n.node.blurAlpha,n._focusChildren(e,function(t){t.sector.context.globalAlpha=n.node.blurAlpha}))}),n._focusParent(t)}},{key:"_unfocus",value:function(t,i){e.each(this.data,function(t){t.sector&&(t.sector.context.globalAlpha=1)})}},{key:"_focusChildren",value:function(t,i){var n=this;t.children&&t.children.length&&e.each(t.children,function(t){i(t),n._focusChildren(t,i)})}},{key:"_focusParent",value:function(t){var i=this;t.parent&&t.parent.sector&&t.parent.group&&e.each(t.parent.group,function(e){e===t.parent?(e.sector.context.globalAlpha=1,i._focusParent(t.parent)):e.sector.context.globalAlpha=i.node.blurAlpha})}}]),i}());function Wn(){var t={},e=24,i=8,n=[1,1],a=[],r=[];function s(t,e){var i,n=0,a=t.length,r=-1;if(1===arguments.length)for(;++r<a;)isNaN(i=+t[r])||(n+=i);else for(;++r<a;)isNaN(i=+e.call(t,t[r],r))||(n+=i);return n}t.nodeWidth=function(i){return arguments.length?(e=+i,t):e},t.nodePadding=function(e){return arguments.length?(i=+e,t):i},t.nodes=function(e){return arguments.length?(a=e,t):a},t.links=function(e){return arguments.length?(r=e,t):r},t.size=function(e){return arguments.length?(n=e,t):n},t.layout=function(l){return a.forEach(function(t){t.sourceLinks=[],t.targetLinks=[]}),r.forEach(function(t){var e=t.source,i=t.target;"number"==typeof e&&(e=t.source=a[t.source]),"number"==typeof i&&(i=t.target=a[t.target]),e.sourceLinks.push(t),i.targetLinks.push(t)}),a.forEach(function(t){t.value=Math.max(s(t.sourceLinks,v),s(t.targetLinks,v))}),function(){var t,i=a,r=0;for(;i.length;)t=[],i.forEach(function(i){i.x=r,i.dx=e,i.sourceLinks.forEach(function(e){t.indexOf(e.target)<0&&t.push(e.target)})}),i=t,++r;(function(t){a.forEach(function(e){e.sourceLinks.length||(e.x=t-1)})})(r),s=(n[0]-e)/(r-1),a.forEach(function(t){t.x*=s});var s}(),function(t){var e=o().key(function(t){return t.x}).sortKeys(p).entries(a).map(function(t){return t.values});l=function(t,e){var i,n,a=-1,r=t.length;if(1===arguments.length){for(;++a<r&&(null==(i=t[a])||i!=i);)i=void 0;for(;++a<r;)null!=(n=t[a])&&i>n&&(i=n)}else{for(;++a<r&&(null==(i=e.call(t,t[a],a))||i!=i);)i=void 0;for(;++a<r;)null!=(n=e.call(t,t[a],a))&&i>n&&(i=n)}return i}(e,function(t){return(n[1]-(t.length-1)*i)/s(t,v)}),e.forEach(function(t){t.forEach(function(t,e){t.y=e,t.dy=t.value*l})}),r.forEach(function(t){t.dy=t.value*l}),c();var l;for(var h=1;t>0;--t)u(h*=.99),c(),d(h),c();function d(t){function i(t){return y(t.source)*t.value}e.forEach(function(e,n){e.forEach(function(e){if(e.targetLinks.length){var n=s(e.targetLinks,i)/s(e.targetLinks,v);e.y+=(n-y(e))*t}})})}function u(t){function i(t){return y(t.target)*t.value}e.slice().reverse().forEach(function(e){e.forEach(function(e){if(e.sourceLinks.length){var n=s(e.sourceLinks,i)/s(e.sourceLinks,v);e.y+=(n-y(e))*t}})})}function c(){e.forEach(function(t){var e,a,r,s=0,o=t.length;for(t.sort(f),r=0;r<o;++r)e=t[r],(a=s-e.y)>0&&(e.y+=a),s=e.y+e.dy+i;if((a=s-i-n[1])>0)for(s=e.y-=a,r=o-2;r>=0;--r)e=t[r],(a=e.y+e.dy+i-s)>0&&(e.y-=a),s=e.y})}function f(t,e){return t.y-e.y}}(l),g(),t},t.relayout=function(){return g(),t},t.link=function(){var t=.5;function e(e){var i,n,a=e.source.x+e.source.dx,r=e.target.x,s=(i=+(i=a),n=+(n=r),function(t){return i*(1-t)+n*t}),o=s(t),l=s(1-t),h=e.source.y+e.sy,d=e.target.y+e.ty,u=e.dy;u<1&&(u=1);var c="M"+a+","+h+"C"+o+","+h+" "+l+","+d+" "+r+","+d;return c+="v"+u,c+="C"+l+","+(d+u)+" "+o+","+(h+u)+" "+a+","+(h+u),c+="v"+-u+"z"}return e.curvature=function(i){return arguments.length?(t=+i,e):t},e};var o=function(){var t,e,i={},n=[],a=[];function r(a,s,o){if(o>=n.length)return e?e.call(i,s):t?s.sort(t):s;for(var l,d,u,c,f=-1,p=s.length,g=n[o++],y=new h;++f<p;)(c=y.get(l=g(d=s[f])))?c.push(d):y.set(l,[d]);return a?(d=a(),u=function(t,e){d.set(t,r(a,e,o))}):(d={},u=function(t,e){d[t]=r(a,e,o)}),y.forEach(u),d}return i.map=function(t,e){return r(e,t,0)},i.entries=function(t){return function t(e,i){if(i>=n.length)return e;var r=[],s=a[i++];return e.forEach(function(e,n){r.push({key:e,values:t(n,i)})}),s?r.sort(function(t,e){return s(t.key,e.key)}):r}(r(l,t,0),0)},i.key=function(t){return n.push(t),i},i.sortKeys=function(t){return a[n.length-1]=t,i},i.sortValues=function(e){return t=e,i},i.rollup=function(t){return e=t,i},i},l=function(t,e){var i=new h;if(t instanceof h)t.forEach(function(t,e){i.set(t,e)});else if(Array.isArray(t)){var n,a=-1,r=t.length;if(1===arguments.length)for(;++a<r;)i.set(a,t[a]);else for(;++a<r;)i.set(e.call(t,n=t[a],a),n)}else for(var s in t)i.set(s,t[s]);return i};function h(){this._=Object.create(null)}var d="__proto__",u="\0";function c(t){return(t+="")===d||t[0]===u?u+t:t}function f(t){return(t+="")[0]===u?t.slice(1):t}function p(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function g(){function t(t,e){return t.source.y-e.source.y}function e(t,e){return t.target.y-e.target.y}a.forEach(function(i){i.sourceLinks.sort(e),i.targetLinks.sort(t)}),a.forEach(function(t){var e=0,i=0;t.sourceLinks.forEach(function(t){t.sy=e,e+=t.dy}),t.targetLinks.forEach(function(t){t.ty=i,i+=t.dy})})}function y(t){return t.y+t.dy/2}function v(t){return t.value}return function(t,e){if(Object.defineProperty)for(var i in e)Object.defineProperty(t.prototype,i,{value:e[i],enumerable:!1});else _.extend(t.prototype,e)}(h,{has:function(t){return c(t)in this._},get:function(t){return this._[c(t)]},set:function(t,e){return this._[c(t)]=e},remove:function(t){return(t=c(t))in this._&&delete this._[t]},keys:function(){var t=[];for(var e in this._)t.push(f(e));return t},values:function(){var t=[];for(var e in this._)t.push(this._[e]);return t},entries:function(){var t=[];for(var e in this._)t.push({key:f(e),value:this._[e]});return t},size:function(){var t=0;for(var e in this._)++t;return t},empty:function(){for(var t in this._)return!1;return!0},forEach:function(t){for(var e in this._)t.call(this,f(e),this._[e])}}),t}var Nn=we.Shapes.Path,zn=we.Shapes.Rect,Gn=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.type="sankey",a.keyField=null,a.valueField="value",a.parentField=null,a.node={width:18,padding:10,fillStyle:null,fillAlpha:1,blurAlpha:.4,focus:{enabled:!0,lineAlpha:1}},a.line={strokeStyle:"blue",lineWidth:1,lineAlpha:1,blurAlpha:.4,focus:{enabled:!0,lineAlpha:1}},a.label={fontColor:"#666",fontSize:12,align:"left",verticalAlign:"middle",position:"right",offsetX:0,offsetY:0},e.extend(!0,a,t),a.init(),a}return Te(i,qe),ke(i,[{key:"init",value:function(){this._links=new we.Display.Sprite,this._nodes=new we.Display.Sprite,this._labels=new we.Display.Sprite,this.sprite.addChild(this._links),this.sprite.addChild(this._nodes),this.sprite.addChild(this._labels)}},{key:"draw",value:function(t){!t&&(t={}),e.extend(!0,this,t),this.data=this._trimGraphs(),this._widget(),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this.fire("complete")}},{key:"_trimGraphs",value:function(){var t=this,i=[],n=[],a=t.dataFrame.getFieldData(t.keyField),r=t.dataFrame.getFieldData(t.valueField),s=t.dataFrame.getFieldData(t.parentField),o={};return e.each(a,function(n,a){var r=[];t.parentField&&r.push(s[a]),r=r.concat(n.split(/[,|]/)),e.each(r,function(t){void 0===o[t]&&(o[t]=i.length,i.push({name:t}))})}),e.each(a,function(e,i){var a=[];t.parentField&&a.push(s[i]),2==(a=a.concat(e.split(/[,|]/))).length&&n.push({source:o[a[0]],target:o[a[1]],value:r[i]})}),Wn().nodeWidth(this.node.width).nodePadding(this.node.padding).size([this.width,this.height]).nodes(i).links(n).layout(16)}},{key:"_widget",value:function(){this._drawNodes(),this._drawLinks(),this._drawLabels()}},{key:"_getColor",value:function(t,i,n){var a=t;return e.isArray(a)&&(a=a[n]),e.isFunction(a)&&(a=a(i)),a||(a=this.app.getTheme(n)),a}},{key:"_drawNodes",value:function(){var t=this.data.nodes(),i=this;e.each(t,function(t,e){var n=i._getColor(i.node.fillStyle,t,e),a=new zn({xyToInt:!1,context:{x:t.x,y:t.y,width:i.data.nodeWidth(),height:Math.max(t.dy,1),fillStyle:n}});a.data=t,i._nodes.addChild(a)})}},{key:"_drawLinks",value:function(){var t=this.data.links(),i=this;e.each(t,function(t,e){var n=i._getColor(i.line.strokeStyle,t,e),a=i.data.link()(t),r=new Nn({xyToInt:!1,context:{path:a,fillStyle:n,globalAlpha:.3,cursor:"pointer"}});r.link=t,r.on(z.get(),function(t){"mouseover"==t.type&&(this.context.globalAlpha+=.2),"mouseout"==t.type&&(this.context.globalAlpha-=.2);var e=this.link;t.eventInfo={title:e.source.name+" --<span style='position:relative;top:-0.5px;font-size:16px;left:-3px;'>></span> "+e.target.name,nodes:[e]},i.app.fire(t.type,t),i.triggerEvent(i.node,t)}),i._links.addChild(r)})}},{key:"_drawLabels",value:function(){var t=this.data.nodes(),i=this;e.each(t,function(t){var e=i.label.align,n=t.x+i.data.nodeWidth()+4,a=t.y+Math.max(t.dy/2,1),r=new we.Display.Text(t.name,{context:{x:n,y:a,fillStyle:i.label.fontColor,fontSize:i.label.fontSize,textAlign:e,textBaseline:i.label.verticalAlign}});i._labels.addChild(r),r.getTextWidth()+n>i.width&&(r.context.x=t.x-4,r.context.textAlign="right")})}}]),i}(),Bn=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ae(this,t),this.comp=e,this.params=i},Hn=we.Shapes.Circle,jn=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.name="legend",a.data=a._getLegendData(t),a.field=null,a.icon={height:26,width:"auto",shapeType:"circle",radius:5,lineWidth:1,fillStyle:"#999",onChecked:function(){},onUnChecked:function(){}},a.label={textAlign:"left",textBaseline:"middle",fillStyle:"#333",cursor:"pointer",format:function(t,e){return t}},a._labelColor="#999",a.position="top",a.direction="h",e.extend(!0,a,{icon:{onChecked:function(t){n.show(t.name,new Bn(this,t))},onUnChecked:function(t){n.hide(t.name,new Bn(this,t))}}},t),!t.direction&&t.position&&("left"==a.position||"right"==a.position?a.direction="v":a.direction="h"),a.sprite=new we.Display.Sprite({id:"LegendSprite",context:{x:a.pos.x,y:a.pos.y}}),a.app.stage.addChild(a.sprite),a.widget(),a.layout(),a}return Te(i,De),ke(i,[{key:"_getLegendData",value:function(t){var i=t.data;return i?(e.each(i,function(t,e){t.enabled=!0,t.ind=e}),delete t.data):i=this.app.getLegendData(),i||[]}},{key:"layout",value:function(){var t=this.app;"h"==this.direction?t.padding[this.position]+=this.height+this.margin.top+this.margin.bottom:t.padding[this.position]+=this.width+this.margin.left+this.margin.right;var e={x:t.width-t.padding.right+this.margin.left,y:t.padding.top+this.margin.top};"left"==this.position&&(e.x=t.padding.left-this.width+this.margin.left),"top"==this.position&&(e.x=t.padding.left+this.margin.left,e.y=t.padding.top-this.height-this.margin.top),"bottom"==this.position&&(e.x=t.padding.left+this.margin.left,e.y=t.height-t.padding.bottom+this.margin.bottom),this.pos=e}},{key:"draw",value:function(){var t=this.app.getComponent({name:"coord"});t&&"rect"==t.type&&("top"!=this.position&&"bottom"!=this.position||(this.pos.x=t.getSizeAndOrigin().origin.x+this.icon.radius)),this.setPosition()}},{key:"widget",value:function(){var t=this,i=this.app.width-this.app.padding.left-this.app.padding.right,n=this.app.height-this.app.padding.top-this.app.padding.bottom,a=0,r=0,s=0,o=0,l=0,h=1,d=!1;e.each(this.data,function(u,c){if(!d){var f=new Hn({id:"legend_field_icon_"+c,context:{x:0,y:t.icon.height/3,fillStyle:u.enabled?u.color||t._labelColor:"#ccc",r:t.icon.radius,cursor:"pointer"}});f.hover(function(e){e.eventInfo=t._getInfoHandler(e,u)},function(t){delete t.eventInfo}),f.on("mousemove",function(e){e.eventInfo=t._getInfoHandler(e,u)}),f.on("click",function(){});var p=new we.Display.Text(t.label.format(u.name,u),{id:"legend_field_txt_"+c,context:{x:t.icon.radius+3,y:t.icon.height/3,textAlign:t.label.textAlign,textBaseline:t.label.textBaseline,fillStyle:t.label.fillStyle,cursor:t.label.cursor}});p.hover(function(e){e.eventInfo=t._getInfoHandler(e,u)},function(t){delete t.eventInfo}),p.on("mousemove",function(e){e.eventInfo=t._getInfoHandler(e,u)}),p.on("click",function(){});var g=p.getTextWidth()+2*t.icon.radius+20;a=Math.max(a,g);var y={height:t.icon.height};if("v"==t.direction){if(l+t.icon.height>n){if(o>.3*i)return void(d=!0);o+=a,l=0}y.x=o,y.y=l,l+=t.icon.height,s=Math.max(s,l)}else{if(o+g>i){if(t.icon.height*(h+1)>.3*n)return void(d=!0);r=Math.max(r,o),o=0,h++}y.x=o,y.y=t.icon.height*(h-1),o+=g}var v=new we.Display.Sprite({id:"legend_field_"+c,context:y});v.addChild(f),v.addChild(p),v.context.width=g,t.sprite.addChild(v),v.on("click",function(i){1==e.filter(t.data,function(t){return t.enabled}).length&&u.enabled||(u.enabled=!u.enabled,f.context.fillStyle=u.enabled?u.color||t._labelColor:"#ccc",u.enabled?t.icon.onChecked(u):t.icon.onUnChecked(u))})}}),"h"==this.direction?(t.width=t.sprite.context.width=r,t.height=t.sprite.context.height=t.icon.height*h):(t.width=t.sprite.context.width=o+a,t.height=t.sprite.context.height=s)}},{key:"_getInfoHandler",value:function(t,e){return{type:"legend",nodes:[{name:e.name,fillStyle:e.color}]}}}]),i}(),Vn=we.Shapes.Line,Yn=we.Shapes.Rect,$n={height:26,width:100,range:{start:0,end:null,max:null,min:1},color:"#008ae6",left:{eventEnabled:!0,fillStyle:null},right:{eventEnabled:!0,fillStyle:null},btnOut:6,btnHeight:20,btnWidth:8,center:{eventEnabled:!0,fillStyle:"#000000",alpha:.015},bg:{enabled:!0,fillStyle:"",strokeStyle:"#e6e6e6",lineWidth:1},underline:{enabled:!0,strokeStyle:null,lineWidth:2},position:"bottom",direction:"h"},qn=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.name="dataZoom",a._cloneChart=null,a.count=1,a.dataLen=1,a.axisLayoutType=null,a.dragIng=function(){},a.dragEnd=function(){},a.disPart={},a._btnLeft=null,a._btnRight=null,a._underline=null,a.sprite=new we.Display.Sprite({id:"dataZoom",context:{x:a.pos.x,y:a.pos.y}}),a.sprite.noSkip=!0,a.dataZoomBg=new we.Display.Sprite({id:"dataZoomBg"}),a.dataZoomBtns=new we.Display.Sprite({id:"dataZoomBtns"}),a.sprite.addChild(a.dataZoomBg),a.sprite.addChild(a.dataZoomBtns),n.stage.addChild(a.sprite),e.extend(!0,a,$n,t),a.layout(),a}return Te(i,De),ke(i,[{key:"layout",value:function(){var t=this.app;"bottom"==this.position&&(this.pos.y=t.height-(this.height+t.padding.bottom+this.margin.bottom),t.padding.bottom+=this.height+this.margin.top+this.margin.bottom),"top"==this.position&&(this.pos.y=t.padding.top+this.margin.top,t.padding.top+=this.height+this.margin.top+this.margin.bottom)}},{key:"_getCloneChart",value:function(){var t=this.app,i=t.constructor,n=t.el.cloneNode();n.innerHTML="",n.id=t.el.id+"_currclone",n.style.position="absolute",n.style.width=t.el.offsetWidth+"px",n.style.height=t.el.offsetHeight+"px",n.style.top="10000px",document.body.appendChild(n);var a=[];e.each(t.getComponents({name:"graphs"}),function(t){var i=t.enabledField||t.field;if(e.flatten([i]).length){var n=e.extend(!0,{},t._opt);n.field=i,"bar"==t.type&&e.extend(!0,n,{node:{fillStyle:"#ececec",radius:0},animation:!1,eventEnabled:!1,label:{enabled:!1}}),"line"==t.type&&e.extend(!0,n,{line:{strokeStyle:"#ececec"},node:{enabled:!1},area:{alpha:1,fillStyle:"#ececec"},animation:!1,eventEnabled:!1,label:{enabled:!1}}),"scat"==t.type&&e.extend(!0,n,{node:{fillStyle:"#ececec"}}),a.push(n)}});var r={coord:t._opt.coord,graphs:a};r.coord.horizontal&&delete r.coord.horizontal;var s=new i(n,t._data,r,t.componentModules);return s.draw(),{thumbChart:s,cloneEl:n}}},{key:"_setDataZoomOpt",value:function(){var t=this.app,i=t.getComponent({name:"coord"}).getSizeAndOrigin(),n=this;e.extend(!0,this,{width:parseInt(i.width),pos:{x:i.origin.x},dragIng:function(i){var a=new Bn(n,{left:t.dataFrame.range.start-i.start,right:i.end-t.dataFrame.range.end});e.extend(t.dataFrame.range,i),t.resetData(null,a),t.fire("dataZoomDragIng")},dragEnd:function(e){t.updateChecked&&t.updateChecked(),t.fire("dataZoomDragEnd")}})}},{key:"draw",value:function(){this._setDataZoomOpt(),this._cloneChart=this._getCloneChart(),this.axisLayoutType=this._cloneChart.thumbChart.getComponent({name:"coord"})._xAxis.layoutType,this._computeAttrs(),this.widget(),this._setLines(),this.setZoomBg(),this.setPosition()}},{key:"destroy",value:function(){this.sprite.destroy()}},{key:"reset",value:function(t,i){!t&&(t={});var n=this.count,a=this.range.start,r=this.range.end;t&&e.extend(!0,this,t),this._cloneChart=this._getCloneChart(),this._computeAttrs(t),(n!=this.count||t.range&&(t.range.start!=a||t.range.end!=r))&&(this.widget(),this._setLines()),this.setZoomBg()}},{key:"_computeAttrs",value:function(){var t=this._cloneChart.thumbChart;this.dataLen=t.dataFrame.length,this.count="rule"==this.axisLayoutType?this.dataLen-1:this.dataLen,(!this.range.max||this.range.max>this.count)&&(this.range.max=this.count),(!this.range.end||this.range.end>this.dataLen-1)&&(this.range.end=this.dataLen-1),!this.direction&&this.position&&("left"==this.position||"right"==this.position?this.direction="v":this.direction="h"),this.disPart=this._getDisPart(),this.btnHeight=this.height-this.btnOut}},{key:"_getRangeEnd",value:function(t){return void 0===t&&(t=this.range.end),"peak"==this.axisLayoutType&&(t+=1),t}},{key:"widget",value:function(){var t=this,e=function(){t._setLines.apply(t,arguments)};if(t.bg.enabled){var i={x:0,y:0,width:t.width,height:t.btnHeight,lineWidth:t.bg.lineWidth,strokeStyle:t.bg.strokeStyle,fillStyle:t.bg.fillStyle};t._bgRect?t._bgRect.animate(i,{onUpdate:e}):(t._bgRect=new Yn({context:i}),t.dataZoomBg.addChild(t._bgRect))}if(t.underline.enabled){var n={start:{x:t.range.start/t.count*t.width+t.btnWidth/2,y:t.btnHeight},end:{x:t._getRangeEnd()/t.count*t.width-t.btnWidth/2,y:t.btnHeight},lineWidth:t.underline.lineWidth,strokeStyle:t.underline.strokeStyle||t.color};t._underline?t._underline.animate(n,{onUpdate:e}):(t._underline=t._addLine(n),t.dataZoomBg.addChild(t._underline))}var a={x:t.range.start/t.count*t.width,y:-t.btnOut/2+1,width:t.btnWidth,height:t.btnHeight+t.btnOut,fillStyle:t.left.fillStyle||t.color,cursor:t.left.eventEnabled&&"move"};t._btnLeft?t._btnLeft.animate(a,{onUpdate:e}):(t._btnLeft=new Yn({id:"btnLeft",dragEnabled:t.left.eventEnabled,context:a}),t._btnLeft.on("draging",function(e){this.context.y=-t.btnOut/2+1,this.context.x<0&&(this.context.x=0),this.context.x>t._btnRight.context.x-t.btnWidth-2&&(this.context.x=t._btnRight.context.x-t.btnWidth-2),t._btnRight.context.x+t.btnWidth-this.context.x>t.disPart.max&&(this.context.x=t._btnRight.context.x+t.btnWidth-t.disPart.max),t._btnRight.context.x+t.btnWidth-this.context.x<t.disPart.min&&(this.context.x=t._btnRight.context.x+t.btnWidth-t.disPart.min),t.rangeRect.context.width=t._btnRight.context.x-this.context.x-t.btnWidth,t.rangeRect.context.x=this.context.x+t.btnWidth,t._setRange()}),t._btnLeft.on("dragend",function(e){t.dragEnd(t.range)}),this.dataZoomBtns.addChild(this._btnLeft));var r={x:t._getRangeEnd()/t.count*t.width-t.btnWidth,y:-t.btnOut/2+1,width:t.btnWidth,height:t.btnHeight+t.btnOut,fillStyle:t.right.fillStyle||t.color,cursor:t.right.eventEnabled&&"move"};t._btnRight?t._btnRight.animate(r,{onUpdate:e}):(t._btnRight=new Yn({id:"btnRight",dragEnabled:t.right.eventEnabled,context:r}),t._btnRight.on("draging",function(e){this.context.y=-t.btnOut/2+1,this.context.x>t.width-t.btnWidth&&(this.context.x=t.width-t.btnWidth),this.context.x+t.btnWidth-t._btnLeft.context.x>t.disPart.max&&(this.context.x=t.disPart.max-(t.btnWidth-t._btnLeft.context.x)),this.context.x+t.btnWidth-t._btnLeft.context.x<t.disPart.min&&(this.context.x=t.disPart.min-t.btnWidth+t._btnLeft.context.x),t.rangeRect.context.width=this.context.x-t._btnLeft.context.x-t.btnWidth,t._setRange()}),t._btnRight.on("dragend",function(e){t.dragEnd(t.range)}),this.dataZoomBtns.addChild(this._btnRight));var s={x:a.x+t.btnWidth,y:1,width:r.x-a.x-t.btnWidth,height:this.btnHeight-1,fillStyle:t.center.fillStyle,fillAlpha:t.center.alpha,cursor:"move"};this.rangeRect?this.rangeRect.animate(s,{onUpdate:e}):(this.rangeRect=new Yn({id:"btnCenter",dragEnabled:!0,context:s}),this.rangeRect.on("draging",function(e){this.context.y=1,this.context.x<t.btnWidth&&(this.context.x=t.btnWidth),this.context.x>t.width-this.context.width-t.btnWidth&&(this.context.x=t.width-this.context.width-t.btnWidth),t._btnLeft.context.x=this.context.x-t.btnWidth,t._btnRight.context.x=this.context.x+this.context.width,t._setRange("btnCenter")}),this.rangeRect.on("dragend",function(e){t.dragEnd(t.range)}),this.dataZoomBtns.addChild(this.rangeRect)),this.linesLeft||(this.linesLeft=new we.Display.Sprite({id:"linesLeft"}),this.left.eventEnabled&&this._addLines({sprite:this.linesLeft}),this.dataZoomBtns.addChild(this.linesLeft)),this.linesRight||(this.linesRight=new we.Display.Sprite({id:"linesRight"}),this.right.eventEnabled&&this._addLines({sprite:this.linesRight}),this.dataZoomBtns.addChild(this.linesRight)),this.linesCenter||(this.linesCenter=new we.Display.Sprite({id:"linesCenter"}),this._addLines({count:3,sprite:this.linesCenter,strokeStyle:this.color}),this.dataZoomBtns.addChild(this.linesCenter))}},{key:"_getDisPart",value:function(){var t=this,e=Math.max(parseInt(t.range.min/2/t.count*t.width),23);return"peak"==this.axisLayoutType&&(e=Math.max(parseInt(t.range.min/t.count*t.width),23)),{min:e,max:parseInt(t.range.max/t.count*t.width)}}},{key:"_setRange",value:function(t){var e=this,i=e._getRangeEnd(),n=i-e.range.start,a=e._btnLeft.context.x/e.width*e.count,r=(e._btnRight.context.x+e.btnWidth)/e.width*e.count;"peak"==this.axisLayoutType?(a=Math.round(a),r=Math.round(r)):(a=parseInt(a),r=parseInt(r)),"btnCenter"==t&&r-a!=n&&(r=a+n),a==e.range.start&&r==i||(e.range.start=a,"peak"==e.axisLayoutType&&(r-=1),e.range.end=r,e.dragIng(e.range)),e._setLines()}},{key:"_setLines",value:function(){var t=this,e=this.linesLeft,i=this.linesRight,n=this.linesCenter,a=this._btnLeft,r=this._btnRight,s=this.rangeRect;e.context.x=a.context.x+(a.context.width-e.context.width)/2,e.context.y=a.context.y+(a.context.height-e.context.height)/2,i.context.x=r.context.x+(r.context.width-i.context.width)/2,i.context.y=r.context.y+(r.context.height-i.context.height)/2,n.context.x=s.context.x+(s.context.width-n.context.width)/2,n.context.y=s.context.y+(s.context.height-n.context.height)/2,t.underline.enabled&&(t._underline.context.start.x=e.context.x+t.btnWidth/2,t._underline.context.end.x=i.context.x+t.btnWidth/2)}},{key:"_addLines",value:function(t){for(var e=t.count||2,i=t.sprite,n=t.dis||2,a=0,r=e;a<r;a++)i.addChild(this._addLine({x:a*n,strokeStyle:t.strokeStyle||""}));i.context.width=a*n-1,i.context.height=6}},{key:"_addLine",value:function(t){var e=t||{};return new Vn({id:e.id||"",context:{x:e.x||0,y:e.y||0,start:{x:e.start?e.start.x:0,y:e.start?e.start.y:0},end:{x:e.end?e.end.x:0,y:e.end?e.end.y:6},lineWidth:e.lineWidth||1,strokeStyle:e.strokeStyle||"#ffffff"}})}},{key:"setZoomBg",value:function(){this.__graphssp&&this.__graphssp.destroy();var t=this._cloneChart.thumbChart.graphsSprite,e=this._cloneChart.thumbChart.getComponent({name:"coord"});t.id=t.id+"_datazoomthumbChartbg",t.context.x=-e.origin.x,t.context.y=-2,t.context.scaleY=this.btnHeight/e.height,t.context.scaleX=this.width/e.width,this.dataZoomBg.addChild(t,0),this.__graphssp=t,this._cloneChart.thumbChart.destroy(),this._cloneChart.cloneEl.parentNode.removeChild(this._cloneChart.cloneEl)}}]),i}(),Xn=we.Shapes.BrokenLine,Un=we.Display.Sprite,Zn=we.Display.Text,Qn=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.name="markLine",a._yAxis=null,a.field=null,a.markTo=null,a.yVal=0,a.line={y:0,list:[],strokeStyle:"#999",lineWidth:1,smooth:!1,lineType:"dashed"},a.label={enabled:!1,fillStyle:"#999999",fontSize:12,text:null,lineType:"dashed",lineWidth:1,strokeStyle:"white",format:null},a._txt=null,a._line=null,a.sprite=new Un,a.app.graphsSprite.addChild(a.sprite),t&&e.extend(!0,a,t),a}return Te(i,De),ke(i,[{key:"draw",value:function(){this._calculateProps(),this.setPosition(),this.widget()}},{key:"_calculateProps",value:function(){var t=this._opt,i=t.markTo,n=this.app.getComponent({name:"coord"});if(!i||-1!=e.indexOf(this.app.dataFrame.fields,i)){var a,r=n._yAxis[0];i&&e.each(n._yAxis,function(t,n){var a=e.flatten([t.field]);e.indexOf(a,i)>=0&&(r=t)}),t.yAxisAlign&&(r=n._yAxis["left"==t.yAxisAlign?0:1]),a=void 0!==t.y&&null!==t.y?Number(t.y):function(){var t=this.app.dataFrame.getFieldData(i),n=0;return e.each(t,function(t){Number(t)&&(n+=t)}),n/t.length},isNaN(a)||(r.setWaterLine(a),r.draw());var s="#777",o=n.getFieldMapOf(i);o&&(s=o.color);var l=t.line&&t.line.strokeStyle||s,h=t.label&&t.label.fillStyle||s;this._yAxis=r,this.width=n.width,this.height=n.height,this.yVal=a,this.pos={x:n.origin.x,y:n.origin.y},this.line.list=[[0,0],[this.width,0]],this.label.fillStyle=h,this.field=i,l&&(this.line.strokeStyle=l)}}},{key:"widget",value:function(){var t=this,e=this._getYPos(),i=new Xn({id:"line",context:{y:e,pointList:t.line.list,strokeStyle:t.line.strokeStyle,lineWidth:t.line.lineWidth,lineType:t.line.lineType}});if(t.sprite.addChild(i),t._line=i,t.label.enabled){var n=new Zn(t._getLabel(),{context:t.label});this._txt=n,t.sprite.addChild(n),t._setTxtPos(e)}this.line.y=e}},{key:"reset",value:function(t){t&&e.extend(!0,this,t);var i=this,n=this._getYPos();n!=this.line.y&&this._line.animate({y:n},{duration:300,onUpdate:function(t){i.label.enabled&&(i._txt.resetText(i._getLabel()),i._setTxtPos(t.y))}}),this._line.context.strokeStyle=this.line.strokeStyle,this.line.y=n}},{key:"_setTxtPos",value:function(t){var i=this._txt;"left"==this._yAxis.align?i.context.x=5:i.context.x=this.width-i.getTextWidth()-5,e.isNumber(this.label.y)?i.context.y=this.label.y:i.context.y=t-i.getTextHeight()}},{key:"_getYVal",value:function(t){var i=t=t||this.yVal;return e.isFunction(t)&&(i=t.apply(this)),i}},{key:"_getYPos",value:function(){return-this._yAxis.getPosOfVal(this._getYVal())}},{key:"_getLabel",value:function(){var t=this._getYVal();return e.isFunction(this.label.format)?this.label.format(t,this):e.isString(this.label.text)?this.label.text:t}}]),i}(),Jn=we.Shapes.Rect,Kn=we.Shapes.Line,ta=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));a.name="tips",a.tipDomContainer=a.app.canvax.domView,a.cW=0,a.cH=0,a.dW=0,a.dH=0,a.borderRadius="5px",a.sprite=null,a.content=null,a.fillStyle="rgba(255,255,255,0.95)",a.fontColor="#999",a.strokeStyle="#ccc",a.position="right",a._tipDom=null,a.offsetX=10,a.offsetY=10,a.eventInfo=null,a.positionInRange=!0,a.enabled=!0,a.pointer="line",a.pointerAnim=!0,a._tipsPointer=null,a.sprite=new we.Display.Sprite({id:"TipSprite"}),a.app.stage.addChild(a.sprite);var r=a;return a.sprite.on("destroy",function(){r._tipDom=null}),e.extend(!0,a,t),a}return Te(i,De),ke(i,[{key:"show",value:function(t){if(this.enabled){if(t.eventInfo){this.eventInfo=t.eventInfo;var e=t.target.getStage();e?(this.cW=e.context.width,this.cH=e.context.height):"canvax"==t.target.type&&(this.cW=t.target.width,this.cH=t.target.height),this._setContent(t)?(this._setPosition(t),this.sprite.toFront()):this.hide()}this._tipsPointerShow(t)}}},{key:"move",value:function(t){if(this.enabled){if(t.eventInfo)this.eventInfo=t.eventInfo,this._setContent(t)?this._setPosition(t):this._hideDialogTips();this._tipsPointerMove(t)}}},{key:"hide",value:function(){this.enabled&&(this._hideDialogTips(),this._tipsPointerHide())}},{key:"_hideDialogTips",value:function(){this.eventInfo&&(this.eventInfo=null,this.sprite.removeAllChildren(),this._removeContent())}},{key:"_setPosition",value:function(t){if(this.enabled&&this._tipDom){var e=t.pos||t.target.localToGlobal(t.point),i=this._checkX(e.x+this.offsetX),n=this._checkY(e.y+this.offsetY);this._tipDom.style.cssText+=";visibility:visible;left:"+i+"px;top:"+n+"px;-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;","left"==this.position&&(this._tipDom.style.left=this._checkX(e.x-this.offsetX-this._tipDom.offsetWidth)+"px")}}},{key:"_creatTipDom",value:function(t){this._tipDom=document.createElement("div"),this._tipDom.className="chart-tips",this._tipDom.style.cssText+="-moz-border-radius:"+this.borderRadius+"; -webkit-border-radius:"+this.borderRadius+"; border-radius:"+this.borderRadius+";background:"+this.fillStyle+";border:1px solid "+this.strokeStyle+";visibility:hidden;position:absolute;enabled:inline-block;*enabled:inline;*zoom:1;padding:6px;color:"+this.fontColor+";line-height:1.5",this._tipDom.style.cssText+="; -moz-box-shadow:1px 1px 3px "+this.strokeStyle+"; -webkit-box-shadow:1px 1px 3px "+this.strokeStyle+"; box-shadow:1px 1px 3px "+this.strokeStyle+";",this._tipDom.style.cssText+="; border:none;white-space:nowrap;word-wrap:normal;",this._tipDom.style.cssText+="; text-align:left;",this.tipDomContainer.appendChild(this._tipDom)}},{key:"_removeContent",value:function(){this._tipDom&&(this.tipDomContainer.removeChild(this._tipDom),this._tipDom=null)}},{key:"_setContent",value:function(t){var e=this._getContent(t);if(e||0===e)return this._tipDom||this._creatTipDom(t),this._tipDom.innerHTML=e,this.dW=this._tipDom.offsetWidth,this.dH=this._tipDom.offsetHeight,e}},{key:"_getContent",value:function(t){return this.content?e.isFunction(this.content)?this.content(t.eventInfo):this.content:this._getDefaultContent(t.eventInfo)}},{key:"_getDefaultContent",value:function(t){var i="";return t.nodes.length?(void 0!==t.title&&null!==t.title&&""!==t.title&&(i+="<div style='font-size:14px;border-bottom:1px solid #f0f0f0;padding:4px;margin-bottom:6px;'>"+t.title+"</div>"),e.each(t.nodes,function(t,e){if(t.value||0===t.value){var n=t.color||t.fillStyle||t.strokeStyle,a=t.name||t.field,r="object"==Se(t.value)?JSON.stringify(t.value):Oe(t.value);i+="<div style='line-height:1.5;font-size:12px;padding:0 4px;'>",n&&(i+="<span style='background:"+n+";margin-right:8px;margin-top:7px;float:left;width:8px;height:8px;border-radius:4px;overflow:hidden;font-size:0;'></span>"),a&&(i+="<span style='margin-right:5px;'>"+a+"</span>"),i+=r+"</div>"}}),i):i}},{key:"_checkX",value:function(t){if(this.positionInRange){var e=this.dW+2;t<0&&(t=0),t+e>this.cW&&(t=this.cW-e)}return t}},{key:"_checkY",value:function(t){if(this.positionInRange){var e=this.dH+2;t<0&&(t=0),t+e>this.cH&&(t=this.cH-e)}return t}},{key:"_tipsPointerShow",value:function(t){var e=this.app.getComponent({name:"coord"});if(e&&"rect"==e.type&&this.pointer){var i=this._tipsPointer,n=e.origin.y-e.height,a=0;if("line"==this.pointer&&(a=e.origin.x+t.eventInfo.xAxis.x),"region"==this.pointer){var r=e._xAxis.getCellLengthOfPos(t.eventInfo.xAxis.x);a=e.origin.x+t.eventInfo.xAxis.x-r/2,t.eventInfo.xAxis.ind<0&&(a=e.origin.x)}if(i)this.pointerAnim&&"proportion"!=e._xAxis.layoutType?(i.__animation&&i.__animation.stop(),i.__animation=i.animate({x:a,y:n},{duration:200})):(i.context.x=a,i.context.y=n);else{if("line"==this.pointer&&(i=new Kn({context:{x:a,y:n,start:{x:0,y:0},end:{x:0,y:e.height},lineWidth:1,strokeStyle:"#cccccc"}})),"region"==this.pointer){r=e._xAxis.getCellLengthOfPos(a);i=new Jn({context:{width:r,height:e.height,x:a,y:n,fillStyle:"#cccccc",globalAlpha:.3}})}this.app.graphsSprite.addChild(i,0),this._tipsPointer=i}}}},{key:"_tipsPointerHide",value:function(){var t=this.app.getComponent({name:"coord"});t&&"rect"==t.type&&this.pointer&&this._tipsPointer&&(this._tipsPointer.destroy(),this._tipsPointer=null)}},{key:"_tipsPointerMove",value:function(t){var e=this.app.getComponent({name:"coord"});if(e&&"rect"==e.type&&this.pointer&&this._tipsPointer){var i=this._tipsPointer,n=e.origin.x+t.eventInfo.xAxis.x;if("region"==this.pointer){var a=e._xAxis.getCellLengthOfPos(t.eventInfo.xAxis.x);n=e.origin.x+t.eventInfo.xAxis.x-a/2,t.eventInfo.xAxis.ind<0&&(n=e.origin.x)}var r=e.origin.y-e.height;n!=i.__targetX&&(this.pointerAnim&&"proportion"!=e._xAxis.layoutType?(i.__animation&&i.__animation.stop(),i.__targetX=n,i.__animation=i.animate({x:n,y:r},{duration:200,onComplete:function(){delete i.__targetX,delete i.__animation}})):(i.context.x=n,i.context.y=r))}}}]),i}(),ea=we.Shapes.Line,ia=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.name="barTgi",a.field=null,a.barField=null,a.data=null,a.barDatas=null,a._yAxis=null,a.yAxisAlign="left",a.sprite=null,a.standardVal=100,a.pos={x:0,y:0},a.line={lineWidth:3,strokeStyle:function(t,e){return t>=this.standardVal?"#43cbb5":"#ff6060"}},e.extend(!0,a,t),a._yAxis=a.app.getComponent({name:"coord"})._yAxis["left"==a.yAxisAlign?0:1],a.sprite=new we.Display.Sprite,a.app.graphsSprite.addChild(a.sprite),a}return Te(i,De),ke(i,[{key:"reset",value:function(t){e.extend(!0,this,t),this.barDatas=null,this.data=null,this.sprite.removeAllChildren(),this.draw()}},{key:"draw",value:function(){var t=this,i=this.app.getComponent({name:"coord"});this.pos={x:i.origin.x,y:i.origin.y},this.setPosition(),e.each(t.app.getComponents({name:"graphs"}),function(e){if("bar"==e.type&&e.data[t.barField])return t.barDatas=e.data[t.barField],!1}),this.data=e.flatten(t.app.dataFrame.getDataOrg(t.field)),this.barDatas&&e.each(this.data,function(e,i){var n=-t._yAxis.getPosOfVal(e),a=t.barDatas[i],r=new ea({context:{start:{x:a.x,y:n},end:{x:a.x+a.width,y:n},lineWidth:2,strokeStyle:t._getProp(t.line.strokeStyle,e,i)}});t.sprite.addChild(r)})}},{key:"_getProp",value:function(t,i,n){var a=t;return e.isFunction(t)&&(a=t.apply(this,[i,n])),a}}]),i}(),na=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.name="barGuide",a.field=null,a.barField=null,a.data=null,a.barDatas=null,a._yAxis=null,a.yAxisAlign="left",a.sprite=null,a.node=Ce({lineWidth:3,shapeType:"circle",radius:6,fillStyle:"#19dea1",strokeStyle:"#fff"},"lineWidth",2),a.label={fontSize:12,fontColor:"#19dea1",verticalAlign:"bottom",align:"center",strokeStyle:"#fff",lineWidth:0,format:function(t,e){return t}},e.extend(!0,a,t),a._yAxis=a.app.getComponent({name:"coord"})._yAxis["left"==a.yAxisAlign?0:1],a.sprite=new we.Display.Sprite,a.app.graphsSprite.addChild(a.sprite),a}return Te(i,De),ke(i,[{key:"reset",value:function(t){e.extend(!0,this,t),this.barDatas=null,this.data=null,this.sprite.removeAllChildren(),this.draw()}},{key:"draw",value:function(){var t=this,i=this.app.getComponent({name:"coord"});this.pos={x:i.origin.x,y:i.origin.y},this.setPosition(),e.each(t.app.getComponents({name:"graphs"}),function(e){if("bar"==e.type&&e.data[t.barField])return t.barDatas=e.data[t.barField],!1}),this.data=e.flatten(t.app.dataFrame.getDataOrg(t.field)),this.barDatas&&e.each(this.data,function(e,i){var n=-t._yAxis.getPosOfVal(e),a=t.barDatas[i],r=new we.Shapes.Circle({context:{x:a.x+a.width/2,y:n,r:t.node.radius,fillStyle:t.node.fillStyle,strokeStyle:t.node.strokeStyle,lineWidth:t.node.lineWidth}}),s=new we.Display.Text(t.label.format(e,a),{context:{x:a.x+a.width/2,y:n-t.node.radius-1,fillStyle:t.label.fontColor,lineWidth:t.label.lineWidth,strokeStyle:t.label.strokeStyle,fontSize:t.label.fontSize,textAlign:t.label.align,textBaseline:t.label.verticalAlign}});t.sprite.addChild(r),t.sprite.addChild(s)})}},{key:"_getProp",value:function(t,i,n){var a=t;return e.isFunction(t)&&(a=t.apply(this,[i,n])),a}}]),i}(),aa=function(t){function i(t,e){Ae(this,i);var n=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e));return n.name="theme",n.colors=t||[],n}return Te(i,De),ke(i,[{key:"set",value:function(t){return this.colors=t,this.colors}},{key:"get",value:function(t){var i=this.colors;return e.isArray(i)||(i=[i]),i}},{key:"mergeTo",value:function(t){t||(t=[]);for(var e=0,i=this.colors.length;e<i;e++)t[e]?t[e]=this.colors[e]:t.push(this.colors[e]);return t}}]),i}(),ra=(we.Display.Text,function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.name="waterMark",a.width=a.app.width,a.height=a.app.height,a.text="chartx",a.fontSize=20,a.fontColor="#ccc",a.strokeStyle="#ccc",a.lineWidth=0,a.alpha=.2,a.rotation=45,e.extend(!0,a,t),a.spripte=new we.Display.Sprite({id:"watermark"}),a.app.stage.addChild(a.spripte),a.draw(),a}return Te(i,De),ke(i,[{key:"draw",value:function(){for(var t=new we.Display.Text(this.text,{context:{fontSize:this.fontSize,fillStyle:this.fontColor}}),e=t.getTextWidth(),i=t.getTextHeight(),n=parseInt(this.height/(5*i))+1,a=parseInt(this.width/(1.5*e))+1,r=0;r<n;r++)for(var s=0;s<a;s++){var o=new we.Display.Text(this.text,{context:{rotation:this.rotation,fontSize:this.fontSize,strokeStyle:this.strokeStyle,lineWidth:this.lineWidth,fillStyle:this.fontColor,globalAlpha:this.alpha}});o.context.x=1.5*e*s+.25*e,o.context.y=5*i*r,this.spripte.addChild(o)}}}]),i}()),sa=we.Shapes.Line,oa=(we.Display.Sprite,we.Display.Text,function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.name="cross",a.width=t.width||0,a.height=t.height||0,a.x=null,a.y=null,a.aimPoint={x:0,y:0},a.line={y:0,strokeStyle:"#cccccc",lineWidth:1,smooth:!1,lineType:"solid"},a.node={enabled:!1,shapeType:"circle",radius:1,fillStyle:"#999"},a.label={enabled:!1,fillStyle:"#999999",fontSize:12,value:null,lineType:"dashed",lineWidth:1,strokeStyle:"white"},a._txt=null,a._node=null,a._hLine=null,a._vLine=null,t&&e.extend(!0,a,t),a._yAxis=a.app.getComponent({name:"coord"})._yAxis["left"==a.yAxisAlign?0:1],a.sprite=new we.Display.Sprite,a.app.graphsSprite.addChild(a.sprite),a}return Te(i,De),ke(i,[{key:"draw",value:function(){var t=this,e=this.app.getComponent({name:"coord"});this.pos={x:e.origin.x,y:e.origin.y},this.width=e.width,this.height=e.height,this.aimPoint={x:this.width/2,y:this.height/2},this.setPosition(),t._hLine=new sa({context:{start:{x:0,y:-this.aimPoint.y},end:{x:t.width,y:-this.aimPoint.y},strokeStyle:t.line.strokeStyle,lineWidth:t.line.lineWidth,lineType:t.line.lineType}}),t.sprite.addChild(t._hLine),t._vLine=new sa({context:{start:{x:this.aimPoint.x,y:0},end:{x:this.aimPoint.x,y:-t.height},strokeStyle:t.line.strokeStyle,lineWidth:t.line.lineWidth,lineType:t.line.lineType}}),t.sprite.addChild(t._vLine)}}]),i}()),la=function(t){function i(t,n){Ae(this,i);var a=Pe(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return a.name="lineSchedu",a.data=null,a.lineDatas=null,a.lineField=null,a.style="#3995ff",a.fillStyle="#fff",a.lineWidth=2,a.radius=6,a.timeFontSize=14,a.timeFontColor="#606060",a.listFontSize=12,a.listFontColor=null,e.extend(!0,a,t),a.sprite=new we.Display.Sprite,a.app.graphsSprite.addChild(a.sprite),a}return Te(i,De),ke(i,[{key:"reset",value:function(t){e.extend(!0,this,t),this.lineDatas=null,this.data=null,this.sprite.removeAllChildren(),this.draw()}},{key:"draw",value:function(){var t=this,i=this.app.getComponent({name:"coord"});this.pos={x:i.origin.x,y:i.origin.y},this.setPosition();var n=t.app.getComponent({name:"graphs",type:"line",field:t.lineField});t.lineDatas=n.data[t.lineField].data;var a=this.app.getComponent({name:"coord"}).getAxis({type:"xAxis"}).getIndexOfVal(this.time),r=this.lineDatas[a];if(void 0!=r.y){var s=t._getNodeY(r,i),o=r.x,l=new we.Display.Sprite({context:{x:o-20}});this.sprite.addChild(l);var h=0,d=new we.Display.Text(t.time,{context:{fillStyle:this.timeFontColor||this.style,fontSize:this.timeFontSize}});l.addChild(d);h=d.getTextHeight();var u=d.getTextWidth(),c=new we.Display.Text(e.flatten([t.list]).join("\n"),{context:{y:h,fillStyle:this.listFontColor||this.style,fontSize:this.listFontSize}});l.addChild(c),h+=c.getTextHeight(),(u=Math.max(u,c.getTextWidth()))+o-20>i.width+t.app.padding.right&&(l.context.x=i.width+t.app.padding.right,d.context.textAlign="right",c.context.textAlign="right");var f=0;"online"==t.status?(f=s-(this.radius+3)-h,Math.abs(f)>i.origin.y&&(f=-i.origin.y,s=-(i.origin.y-(this.radius+3)-h))):(f=s+(this.radius+3))+h>0&&(f=-h,s=-(this.radius+3)-h),l.context.y=f;var p=new we.Shapes.BrokenLine({context:{pointList:[[o,s],[o,r.y]],strokeStyle:t.style,lineWidth:t.lineWidth}});t.sprite.addChild(p);var g=new we.Shapes.Circle({context:{x:o,y:s,r:t.radius,fillStyle:t.fillStyle,strokeStyle:t.style,lineWidth:t.lineWidth}});t.sprite.addChild(g)}}},{key:"_getNodeY",value:function(t,e){var i=this.app.height,n=(e.height,t.y);return"online"==this.status?n-=Math.min(50,.3*(i-Math.abs(n))):n+=Math.min(50,.3*Math.abs(n)),n}}]),i}();R.registerComponent(Le,"chart"),R.registerComponent(Be,"coord","rect"),R.registerComponent($e,"coord","polar"),R.registerComponent(Ze,"graphs","bar"),R.registerComponent(ii,"graphs","line"),R.registerComponent(si,"graphs","scat"),R.registerComponent(ui,"graphs","pie"),R.registerComponent(pi,"graphs","radar"),R.registerComponent(Ni,"graphs","cloud"),R.registerComponent(Yi,"graphs","planet"),R.registerComponent(Xi,"graphs","funnel"),R.registerComponent(Sn,"graphs","venn"),R.registerComponent(Fn,"graphs","sunburst"),R.registerComponent(Gn,"graphs","sankey"),R.registerComponent(aa,"theme"),R.registerComponent(jn,"legend"),R.registerComponent(qn,"dataZoom"),R.registerComponent(Qn,"markLine"),R.registerComponent(ta,"tips"),R.registerComponent(ia,"barTgi"),R.registerComponent(na,"barGuide"),R.registerComponent(ra,"waterMark"),R.registerComponent(oa,"cross"),R.registerComponent(la,"lineSchedu");var ha=[];ha&&ha.length&&R.setGlobalTheme(ha);var da={options:{}};for(var ua in R)da[ua]=R[ua];return da}();
