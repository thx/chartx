define("chartx/chart/original/flowall",["chartx/chart/index","chartx/chart/original/flowall/dataformat","chartx/chart/original/flowall/layout","canvax/shape/Rect","canvax/shape/Path","chartx/components/tips/tip"],function(a,b,c,d,e,f){var g=a.Canvax;return a.extend({init:function(a,b,d){this.padding={top:10,right:10,bottom:10,left:10},this.graphs={w:this.width-this.padding.left-this.padding.right,h:this.height-this.padding.top-this.padding.bottom,node:{text:{format:function(a){},formatVal:function(a){return a},fillStyle:"white",fontSize:12,valFontSize:18}},edge:{}},_.deepExtend(this,d),this.layout=c(this._initData(b,d),this.graphs)},draw:function(){this._initModule(),this._widget()},_initModule:function(){this.edgeSprite=new g.Display.Sprite({id:"edgeSprite",context:{x:this.padding.left,y:this.padding.top}}),this.stage.addChild(this.edgeSprite),this.nodeSprite=new g.Display.Sprite({id:"nodeSprite",context:{x:this.padding.left,y:this.padding.top}}),this.stage.addChild(this.nodeSprite),this.txtSprite=new g.Display.Sprite({id:"txtSprite",context:{x:this.padding.left,y:this.padding.top}}),this.stage.addChild(this.txtSprite),this.stageTip=new g.Display.Sprite({id:"tip"}),this.stage.addChild(this.stageTip),this._tip=new f(this.tips,this.canvax.getDomContainer()),this._tip._getDefaultContent=this._getTipDefaultContent,this.stageTip.addChild(this._tip.sprite)},_getTipDefaultContent:function(a){var b=a.node;if(b){var c=b.label||b.node;return c+"总人数</br><span style='color:"+b.fillStyle+"'>"+b.value+"</span>"}var d=a.edge;if(d){var c=d.to.label||d.to.node;return c+"转化人数</br><span style='color:"+d.to.fillStyle+"'>"+d.to.flowin+"</span>("+parseInt(d.to.flowin/d.to.value*100)+"%)"}},_initData:b,_widget:function(){var a=this;_.each(a.layout.nodes,function(b){var c=new d({id:b.node,hoverClone:!1,context:{x:b.pos.x,y:b.pos.y,width:b.w,height:b.h,fillStyle:b.fillStyle,cursor:"pointer",radius:[2]}});c.node=b,c.hover(function(b){this.context.r++,a._setEventInfo(b,this),a._tip.show(b)},function(){this.context.r--,a._tip.hide()}),c.on("mousemove",function(b){a._setEventInfo(b,this),a._tip.move(b)}),c.on("click",function(b){b.node=this.node,a.fire("click",b)}),a.nodeSprite.addChild(c);var e=a.graphs.node.text,f=e.format(b.node)||b.label||b.node,h=new g.Display.Text(f,{context:{x:b.pos.x+10,y:b.pos.y+b.h/2,fillStyle:e.fillStyle,fontSize:e.fontSize,textAlign:"left",textBaseline:"middle"}});if(b.h>30){h.context.textBaseline="top",h.context.y=b.pos.y+3,h.context.fontSize=12;var i=new g.Display.Text(e.formatVal(b.value),{context:{x:b.pos.x+10,y:b.pos.y+Math.max(2*b.h/3,28),fillStyle:e.fillStyle,fontSize:e.valFontSize,textAlign:"left",textBaseline:"middle"}});a.txtSprite.addChild(i)}b.h<h.getTextHeight()&&(h.context.y=b.pos.y+b.h+2,h.context.textBaseline="top",h.context.fillStyle="#999"),a.txtSprite.addChild(h)}),_.each(a.layout.edges,function(b,c){var d=new e({id:c,context:{path:b.path,fillStyle:b.to.fillStyle,globalAlpha:.3}});d.edge=b,d.on("mouseover",function(b){a._setEventInfo(b,this),a._tip.show(b)}),d.on("mousemove",function(b){a._setEventInfo(b,this),a._tip.move(b)}),d.on("mouseout",function(b){a._tip.hide(b)}),a.edgeSprite.addChild(d)})},_setEventInfo:function(a,b){a.eventInfo={el:b,node:b.node,edge:b.edge}}})});